import{k as g}from"./index-C9sUxlHS.js";var b=Object.getOwnPropertyNames,p=(_,s)=>function(){return s||(0,_[b(_)[0]])((s={exports:{}}).exports,s),s.exports},u=p({"<stdin>"(_){(function(s,i){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],i):typeof _=="object"&&_!==null&&typeof _.nodeType!="number"?i(_,g.KaitaiStream):i(s.AndroidImg||(s.AndroidImg={}),s.KaitaiStream)})(typeof self<"u"?self:_,function(s,i){var n=(function(){function t(e,o,r){this._io=e,this._parent=o,this._root=r||this,this._debug={},this._read()}t.prototype._read=function(){if(this._debug.magic={start:this._io.pos,ioOffset:this._io.byteOffset},this.magic=this._io.readBytes(8),this._debug.magic.end=this._io.pos,i.byteArrayCompare(this.magic,new Uint8Array([65,78,68,82,79,73,68,33]))!=0){var e=new i.ValidationNotEqualError(new Uint8Array([65,78,68,82,79,73,68,33]),this.magic,this._io,"/seq/0");throw this._debug.magic.validationError=e,e}this._debug.kernel={start:this._io.pos,ioOffset:this._io.byteOffset},this.kernel=new h(this._io,this,this._root),this._debug.kernel.end=this._io.pos,this._debug.ramdisk={start:this._io.pos,ioOffset:this._io.byteOffset},this.ramdisk=new h(this._io,this,this._root),this._debug.ramdisk.end=this._io.pos,this._debug.second={start:this._io.pos,ioOffset:this._io.byteOffset},this.second=new h(this._io,this,this._root),this._debug.second.end=this._io.pos,this._debug.tagsLoad={start:this._io.pos,ioOffset:this._io.byteOffset},this.tagsLoad=this._io.readU4le(),this._debug.tagsLoad.end=this._io.pos,this._debug.pageSize={start:this._io.pos,ioOffset:this._io.byteOffset},this.pageSize=this._io.readU4le(),this._debug.pageSize.end=this._io.pos,this._debug.headerVersion={start:this._io.pos,ioOffset:this._io.byteOffset},this.headerVersion=this._io.readU4le(),this._debug.headerVersion.end=this._io.pos,this._debug.osVersion={start:this._io.pos,ioOffset:this._io.byteOffset},this.osVersion=new f(this._io,this,this._root),this._debug.osVersion.end=this._io.pos,this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=i.bytesToStr(i.bytesTerminate(this._io.readBytes(16),0,!1),"ASCII"),this._debug.name.end=this._io.pos,this._debug.cmdline={start:this._io.pos,ioOffset:this._io.byteOffset},this.cmdline=i.bytesToStr(i.bytesTerminate(this._io.readBytes(512),0,!1),"ASCII"),this._debug.cmdline.end=this._io.pos,this._debug.sha={start:this._io.pos,ioOffset:this._io.byteOffset},this.sha=this._io.readBytes(32),this._debug.sha.end=this._io.pos,this._debug.extraCmdline={start:this._io.pos,ioOffset:this._io.byteOffset},this.extraCmdline=i.bytesToStr(i.bytesTerminate(this._io.readBytes(1024),0,!1),"ASCII"),this._debug.extraCmdline.end=this._io.pos,this.headerVersion>0&&(this._debug.recoveryDtbo={start:this._io.pos,ioOffset:this._io.byteOffset},this.recoveryDtbo=new m(this._io,this,this._root),this._debug.recoveryDtbo.end=this._io.pos),this.headerVersion>0&&(this._debug.bootHeaderSize={start:this._io.pos,ioOffset:this._io.byteOffset},this.bootHeaderSize=this._io.readU4le(),this._debug.bootHeaderSize.end=this._io.pos),this.headerVersion>1&&(this._debug.dtb={start:this._io.pos,ioOffset:this._io.byteOffset},this.dtb=new a(this._io,this,this._root),this._debug.dtb.end=this._io.pos)};var h=t.Load=(function(){function e(o,r,d){this._io=o,this._parent=r,this._root=d,this._debug={},this._read()}return e.prototype._read=function(){this._debug.size={start:this._io.pos,ioOffset:this._io.byteOffset},this.size=this._io.readU4le(),this._debug.size.end=this._io.pos,this._debug.addr={start:this._io.pos,ioOffset:this._io.byteOffset},this.addr=this._io.readU4le(),this._debug.addr.end=this._io.pos},e})(),a=t.LoadLong=(function(){function e(o,r,d){this._io=o,this._parent=r,this._root=d,this._debug={},this._read()}return e.prototype._read=function(){this._debug.size={start:this._io.pos,ioOffset:this._io.byteOffset},this.size=this._io.readU4le(),this._debug.size.end=this._io.pos,this._debug.addr={start:this._io.pos,ioOffset:this._io.byteOffset},this.addr=this._io.readU8le(),this._debug.addr.end=this._io.pos},e})(),f=t.OsVersion=(function(){function e(o,r,d){this._io=o,this._parent=r,this._root=d,this._debug={},this._read()}return e.prototype._read=function(){this._debug.version={start:this._io.pos,ioOffset:this._io.byteOffset},this.version=this._io.readU4le(),this._debug.version.end=this._io.pos},Object.defineProperty(e.prototype,"major",{get:function(){return this._m_major!==void 0?this._m_major:(this._debug._m_major={},this._m_major=this.version>>>25&127,this._m_major)}}),Object.defineProperty(e.prototype,"minor",{get:function(){return this._m_minor!==void 0?this._m_minor:(this._debug._m_minor={},this._m_minor=this.version>>>18&127,this._m_minor)}}),Object.defineProperty(e.prototype,"month",{get:function(){return this._m_month!==void 0?this._m_month:(this._debug._m_month={},this._m_month=this.version&15,this._m_month)}}),Object.defineProperty(e.prototype,"patch",{get:function(){return this._m_patch!==void 0?this._m_patch:(this._debug._m_patch={},this._m_patch=this.version>>>11&127,this._m_patch)}}),Object.defineProperty(e.prototype,"year",{get:function(){return this._m_year!==void 0?this._m_year:(this._debug._m_year={},this._m_year=(this.version>>>4&127)+2e3,this._m_year)}}),e})(),m=t.SizeOffset=(function(){function e(o,r,d){this._io=o,this._parent=r,this._root=d,this._debug={},this._read()}return e.prototype._read=function(){this._debug.size={start:this._io.pos,ioOffset:this._io.byteOffset},this.size=this._io.readU4le(),this._debug.size.end=this._io.pos,this._debug.offset={start:this._io.pos,ioOffset:this._io.byteOffset},this.offset=this._io.readU8le(),this._debug.offset.end=this._io.pos},e})();return Object.defineProperty(t.prototype,"base",{get:function(){return this._m_base!==void 0?this._m_base:(this._debug._m_base={},this._m_base=this.kernel.addr-32768,this._m_base)}}),Object.defineProperty(t.prototype,"dtbImg",{get:function(){if(this._m_dtbImg!==void 0)return this._m_dtbImg;if(this.headerVersion>1&&this.dtb.size>0){var e=this._io.pos;this._io.seek(Math.floor((this.pageSize+this.kernel.size+this.ramdisk.size+this.second.size+this.recoveryDtbo.size+this.pageSize-1)/this.pageSize)*this.pageSize),this._debug._m_dtbImg={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_dtbImg=this._io.readBytes(this.dtb.size),this._debug._m_dtbImg.end=this._io.pos,this._io.seek(e)}return this._m_dtbImg}}),Object.defineProperty(t.prototype,"dtbOffset",{get:function(){return this._m_dtbOffset!==void 0?this._m_dtbOffset:(this.headerVersion>1&&(this._debug._m_dtbOffset={},this._m_dtbOffset=this.dtb.addr>0?this.dtb.addr-this.base:0),this._m_dtbOffset)}}),Object.defineProperty(t.prototype,"kernelImg",{get:function(){if(this._m_kernelImg!==void 0)return this._m_kernelImg;var e=this._io.pos;return this._io.seek(this.pageSize),this._debug._m_kernelImg={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_kernelImg=this._io.readBytes(this.kernel.size),this._debug._m_kernelImg.end=this._io.pos,this._io.seek(e),this._m_kernelImg}}),Object.defineProperty(t.prototype,"kernelOffset",{get:function(){return this._m_kernelOffset!==void 0?this._m_kernelOffset:(this._debug._m_kernelOffset={},this._m_kernelOffset=this.kernel.addr-this.base,this._m_kernelOffset)}}),Object.defineProperty(t.prototype,"ramdiskImg",{get:function(){if(this._m_ramdiskImg!==void 0)return this._m_ramdiskImg;if(this.ramdisk.size>0){var e=this._io.pos;this._io.seek(Math.floor((this.pageSize+this.kernel.size+this.pageSize-1)/this.pageSize)*this.pageSize),this._debug._m_ramdiskImg={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_ramdiskImg=this._io.readBytes(this.ramdisk.size),this._debug._m_ramdiskImg.end=this._io.pos,this._io.seek(e)}return this._m_ramdiskImg}}),Object.defineProperty(t.prototype,"ramdiskOffset",{get:function(){return this._m_ramdiskOffset!==void 0?this._m_ramdiskOffset:(this._debug._m_ramdiskOffset={},this._m_ramdiskOffset=this.ramdisk.addr>0?this.ramdisk.addr-this.base:0,this._m_ramdiskOffset)}}),Object.defineProperty(t.prototype,"recoveryDtboImg",{get:function(){if(this._m_recoveryDtboImg!==void 0)return this._m_recoveryDtboImg;if(this.headerVersion>0&&this.recoveryDtbo.size>0){var e=this._io.pos;this._io.seek(this.recoveryDtbo.offset),this._debug._m_recoveryDtboImg={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_recoveryDtboImg=this._io.readBytes(this.recoveryDtbo.size),this._debug._m_recoveryDtboImg.end=this._io.pos,this._io.seek(e)}return this._m_recoveryDtboImg}}),Object.defineProperty(t.prototype,"secondImg",{get:function(){if(this._m_secondImg!==void 0)return this._m_secondImg;if(this.second.size>0){var e=this._io.pos;this._io.seek(Math.floor((this.pageSize+this.kernel.size+this.ramdisk.size+this.pageSize-1)/this.pageSize)*this.pageSize),this._debug._m_secondImg={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_secondImg=this._io.readBytes(this.second.size),this._debug._m_secondImg.end=this._io.pos,this._io.seek(e)}return this._m_secondImg}}),Object.defineProperty(t.prototype,"secondOffset",{get:function(){return this._m_secondOffset!==void 0?this._m_secondOffset:(this._debug._m_secondOffset={},this._m_secondOffset=this.second.addr>0?this.second.addr-this.base:0,this._m_secondOffset)}}),Object.defineProperty(t.prototype,"tagsOffset",{get:function(){return this._m_tagsOffset!==void 0?this._m_tagsOffset:(this._debug._m_tagsOffset={},this._m_tagsOffset=this.tagsLoad-this.base,this._m_tagsOffset)}}),t})();s.AndroidImg=n})}});const y=u(),O={id:"android_img",title:"Android Boot Image",ksy:{meta:{id:"android_img",title:"Android Boot Image","file-extension":"img",tags:["archive","android"],license:"CC0-1.0",endian:"le"},"doc-ref":"https://source.android.com/docs/core/architecture/bootloader/boot-image-header",seq:[{id:"magic",contents:"ANDROID!"},{id:"kernel",type:"load"},{id:"ramdisk",type:"load"},{id:"second",type:"load"},{id:"tags_load",type:"u4"},{id:"page_size",type:"u4"},{id:"header_version",type:"u4"},{id:"os_version",type:"os_version"},{id:"name",type:"strz",size:16,encoding:"ASCII"},{id:"cmdline",type:"strz",size:512,encoding:"ASCII"},{id:"sha",size:32},{id:"extra_cmdline",type:"strz",size:1024,encoding:"ASCII"},{id:"recovery_dtbo",type:"size_offset",if:"header_version > 0"},{id:"boot_header_size",type:"u4",if:"header_version > 0"},{id:"dtb",type:"load_long",if:"header_version > 1"}],instances:{base:{value:"kernel.addr - 0x00008000",doc:"base loading address"},kernel_offset:{value:"kernel.addr - base",doc:"kernel offset from base"},ramdisk_offset:{value:"ramdisk.addr > 0 ? ramdisk.addr - base : 0",doc:"ramdisk offset from base"},second_offset:{value:"second.addr > 0 ? second.addr - base : 0",doc:"2nd bootloader offset from base"},tags_offset:{value:"tags_load - base",doc:"tags offset from base"},dtb_offset:{value:"dtb.addr > 0 ? dtb.addr - base : 0",if:"header_version > 1",doc:"dtb offset from base"},kernel_img:{pos:"page_size",size:"kernel.size"},ramdisk_img:{pos:"((page_size + kernel.size + page_size - 1) / page_size) * page_size",size:"ramdisk.size",if:"ramdisk.size > 0"},second_img:{pos:"((page_size + kernel.size + ramdisk.size + page_size - 1) / page_size) * page_size",size:"second.size",if:"second.size > 0"},recovery_dtbo_img:{pos:"recovery_dtbo.offset",size:"recovery_dtbo.size",if:"header_version > 0 and recovery_dtbo.size > 0"},dtb_img:{pos:"((page_size + kernel.size + ramdisk.size + second.size + recovery_dtbo.size + page_size - 1) / page_size) * page_size",size:"dtb.size",if:"header_version > 1 and dtb.size > 0"}},types:{load:{seq:[{id:"size",type:"u4"},{id:"addr",type:"u4"}]},load_long:{seq:[{id:"size",type:"u4"},{id:"addr",type:"u8"}]},size_offset:{seq:[{id:"size",type:"u4"},{id:"offset",type:"u8"}]},os_version:{seq:[{id:"version",type:"u4"}],instances:{major:{value:"(version >> 25) & 0x7f"},minor:{value:"(version >> 18) & 0x7f"},patch:{value:"(version >> 11) & 0x7f"},year:{value:"((version >> 4) & 0x7f) + 2000"},month:{value:"version & 0xf"}}}}}};export{y as default,O as spec};
