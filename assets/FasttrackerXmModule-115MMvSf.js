import{k as v}from"./index-C9sUxlHS.js";var w=Object.getOwnPropertyNames,P=(u,_)=>function(){return _||(0,u[w(u)[0]])((_={exports:{}}).exports,_),_.exports},T=P({"<stdin>"(u){(function(_,a){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],a):typeof u=="object"&&u!==null&&typeof u.nodeType!="number"?a(u,v.KaitaiStream):a(_.FasttrackerXmModule||(_.FasttrackerXmModule={}),_.KaitaiStream)})(typeof self<"u"?self:u,function(_,a){var l=(function(){function f(o,t,i){this._io=o,this._parent=t,this._root=i||this,this._debug={},this._read()}f.prototype._read=function(){this._debug.preheader={start:this._io.pos,ioOffset:this._io.byteOffset},this.preheader=new O(this._io,this,this._root),this._debug.preheader.end=this._io.pos,this._debug.header={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_header=this._io.readBytes(this.preheader.headerSize-4);var o=new a(this._raw_header);this.header=new g(o,this,this._root),this._debug.header.end=this._io.pos,this._debug.patterns={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.patterns.arr=[],this.patterns=[];for(var t=0;t<this.header.numPatterns;t++)this._debug.patterns.arr[t]={start:this._io.pos,ioOffset:this._io.byteOffset},this.patterns.push(new c(this._io,this,this._root)),this._debug.patterns.arr[t].end=this._io.pos;this._debug.patterns.end=this._io.pos,this._debug.instruments={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.instruments.arr=[],this.instruments=[];for(var t=0;t<this.header.numInstruments;t++)this._debug.instruments.arr[t]={start:this._io.pos,ioOffset:this._io.byteOffset},this.instruments.push(new y(this._io,this,this._root)),this._debug.instruments.arr[t].end=this._io.pos;this._debug.instruments.end=this._io.pos};var m=f.Flags=(function(){function o(t,i,n){this._io=t,this._parent=i,this._root=n,this._debug={},this._read()}return o.prototype._read=function(){this._debug.reserved={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved=this._io.readBitsIntBe(15),this._debug.reserved.end=this._io.pos,this._debug.freqTableType={start:this._io.pos,ioOffset:this._io.byteOffset},this.freqTableType=this._io.readBitsIntBe(1)!=0,this._debug.freqTableType.end=this._io.pos},o})(),g=f.Header=(function(){function o(t,i,n){this._io=t,this._parent=i,this._root=n,this._debug={},this._read()}return o.prototype._read=function(){this._debug.songLength={start:this._io.pos,ioOffset:this._io.byteOffset},this.songLength=this._io.readU2le(),this._debug.songLength.end=this._io.pos,this._debug.restartPosition={start:this._io.pos,ioOffset:this._io.byteOffset},this.restartPosition=this._io.readU2le(),this._debug.restartPosition.end=this._io.pos,this._debug.numChannels={start:this._io.pos,ioOffset:this._io.byteOffset},this.numChannels=this._io.readU2le(),this._debug.numChannels.end=this._io.pos,this._debug.numPatterns={start:this._io.pos,ioOffset:this._io.byteOffset},this.numPatterns=this._io.readU2le(),this._debug.numPatterns.end=this._io.pos,this._debug.numInstruments={start:this._io.pos,ioOffset:this._io.byteOffset},this.numInstruments=this._io.readU2le(),this._debug.numInstruments.end=this._io.pos,this._debug.flags={start:this._io.pos,ioOffset:this._io.byteOffset},this.flags=new m(this._io,this,this._root),this._debug.flags.end=this._io.pos,this._debug.defaultTempo={start:this._io.pos,ioOffset:this._io.byteOffset},this.defaultTempo=this._io.readU2le(),this._debug.defaultTempo.end=this._io.pos,this._debug.defaultBpm={start:this._io.pos,ioOffset:this._io.byteOffset},this.defaultBpm=this._io.readU2le(),this._debug.defaultBpm.end=this._io.pos,this._debug.patternOrderTable={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.patternOrderTable.arr=[],this.patternOrderTable=[];for(var t=0;t<256;t++)this._debug.patternOrderTable.arr[t]={start:this._io.pos,ioOffset:this._io.byteOffset},this.patternOrderTable.push(this._io.readU1()),this._debug.patternOrderTable.arr[t].end=this._io.pos;this._debug.patternOrderTable.end=this._io.pos},o})(),y=f.Instrument=(function(){function o(r,s,e){this._io=r,this._parent=s,this._root=e,this._debug={},this._read()}o.prototype._read=function(){this._debug.headerSize={start:this._io.pos,ioOffset:this._io.byteOffset},this.headerSize=this._io.readU4le(),this._debug.headerSize.end=this._io.pos,this._debug.header={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_header=this._io.readBytes(this.headerSize-4);var r=new a(this._raw_header);this.header=new i(r,this,this._root),this._debug.header.end=this._io.pos,this._debug.samplesHeaders={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.samplesHeaders.arr=[],this.samplesHeaders=[];for(var s=0;s<this.header.numSamples;s++)this._debug.samplesHeaders.arr[s]={start:this._io.pos,ioOffset:this._io.byteOffset},this.samplesHeaders.push(new n(this._io,this,this._root)),this._debug.samplesHeaders.arr[s].end=this._io.pos;this._debug.samplesHeaders.end=this._io.pos,this._debug.samples={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.samples.arr=[],this.samples=[];for(var s=0;s<this.header.numSamples;s++)this._debug.samples.arr[s]={start:this._io.pos,ioOffset:this._io.byteOffset},this.samples.push(new h(this._io,this,this._root,this.samplesHeaders[s])),this._debug.samples.arr[s].end=this._io.pos;this._debug.samples.end=this._io.pos};var t=o.ExtraHeader=(function(){r.Type=Object.freeze({TRUE:0,SUSTAIN:1,LOOP:2,0:"TRUE",1:"SUSTAIN",2:"LOOP"});function r(e,d,p){this._io=e,this._parent=d,this._root=p,this._debug={},this._read()}r.prototype._read=function(){this._debug.lenSampleHeader={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenSampleHeader=this._io.readU4le(),this._debug.lenSampleHeader.end=this._io.pos,this._debug.idxSamplePerNote={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.idxSamplePerNote.arr=[],this.idxSamplePerNote=[];for(var e=0;e<96;e++)this._debug.idxSamplePerNote.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.idxSamplePerNote.push(this._io.readU1()),this._debug.idxSamplePerNote.arr[e].end=this._io.pos;this._debug.idxSamplePerNote.end=this._io.pos,this._debug.volumePoints={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.volumePoints.arr=[],this.volumePoints=[];for(var e=0;e<12;e++)this._debug.volumePoints.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.volumePoints.push(new s(this._io,this,this._root)),this._debug.volumePoints.arr[e].end=this._io.pos;this._debug.volumePoints.end=this._io.pos,this._debug.panningPoints={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.panningPoints.arr=[],this.panningPoints=[];for(var e=0;e<12;e++)this._debug.panningPoints.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.panningPoints.push(new s(this._io,this,this._root)),this._debug.panningPoints.arr[e].end=this._io.pos;this._debug.panningPoints.end=this._io.pos,this._debug.numVolumePoints={start:this._io.pos,ioOffset:this._io.byteOffset},this.numVolumePoints=this._io.readU1(),this._debug.numVolumePoints.end=this._io.pos,this._debug.numPanningPoints={start:this._io.pos,ioOffset:this._io.byteOffset},this.numPanningPoints=this._io.readU1(),this._debug.numPanningPoints.end=this._io.pos,this._debug.volumeSustainPoint={start:this._io.pos,ioOffset:this._io.byteOffset},this.volumeSustainPoint=this._io.readU1(),this._debug.volumeSustainPoint.end=this._io.pos,this._debug.volumeLoopStartPoint={start:this._io.pos,ioOffset:this._io.byteOffset},this.volumeLoopStartPoint=this._io.readU1(),this._debug.volumeLoopStartPoint.end=this._io.pos,this._debug.volumeLoopEndPoint={start:this._io.pos,ioOffset:this._io.byteOffset},this.volumeLoopEndPoint=this._io.readU1(),this._debug.volumeLoopEndPoint.end=this._io.pos,this._debug.panningSustainPoint={start:this._io.pos,ioOffset:this._io.byteOffset},this.panningSustainPoint=this._io.readU1(),this._debug.panningSustainPoint.end=this._io.pos,this._debug.panningLoopStartPoint={start:this._io.pos,ioOffset:this._io.byteOffset},this.panningLoopStartPoint=this._io.readU1(),this._debug.panningLoopStartPoint.end=this._io.pos,this._debug.panningLoopEndPoint={start:this._io.pos,ioOffset:this._io.byteOffset},this.panningLoopEndPoint=this._io.readU1(),this._debug.panningLoopEndPoint.end=this._io.pos,this._debug.volumeType={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"FasttrackerXmModule.Instrument.ExtraHeader.Type"},this.volumeType=this._io.readU1(),this._debug.volumeType.end=this._io.pos,this._debug.panningType={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"FasttrackerXmModule.Instrument.ExtraHeader.Type"},this.panningType=this._io.readU1(),this._debug.panningType.end=this._io.pos,this._debug.vibratoType={start:this._io.pos,ioOffset:this._io.byteOffset},this.vibratoType=this._io.readU1(),this._debug.vibratoType.end=this._io.pos,this._debug.vibratoSweep={start:this._io.pos,ioOffset:this._io.byteOffset},this.vibratoSweep=this._io.readU1(),this._debug.vibratoSweep.end=this._io.pos,this._debug.vibratoDepth={start:this._io.pos,ioOffset:this._io.byteOffset},this.vibratoDepth=this._io.readU1(),this._debug.vibratoDepth.end=this._io.pos,this._debug.vibratoRate={start:this._io.pos,ioOffset:this._io.byteOffset},this.vibratoRate=this._io.readU1(),this._debug.vibratoRate.end=this._io.pos,this._debug.volumeFadeout={start:this._io.pos,ioOffset:this._io.byteOffset},this.volumeFadeout=this._io.readU2le(),this._debug.volumeFadeout.end=this._io.pos,this._debug.reserved={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved=this._io.readU2le(),this._debug.reserved.end=this._io.pos};var s=r.EnvelopePoint=(function(){function e(d,p,b){this._io=d,this._parent=p,this._root=b,this._debug={},this._read()}return e.prototype._read=function(){this._debug.x={start:this._io.pos,ioOffset:this._io.byteOffset},this.x=this._io.readU2le(),this._debug.x.end=this._io.pos,this._debug.y={start:this._io.pos,ioOffset:this._io.byteOffset},this.y=this._io.readU2le(),this._debug.y.end=this._io.pos},e})();return r})(),i=o.Header=(function(){function r(s,e,d){this._io=s,this._parent=e,this._root=d,this._debug={},this._read()}return r.prototype._read=function(){this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=a.bytesToStr(a.bytesTerminate(this._io.readBytes(22),0,!1),"UTF-8"),this._debug.name.end=this._io.pos,this._debug.type={start:this._io.pos,ioOffset:this._io.byteOffset},this.type=this._io.readU1(),this._debug.type.end=this._io.pos,this._debug.numSamples={start:this._io.pos,ioOffset:this._io.byteOffset},this.numSamples=this._io.readU2le(),this._debug.numSamples.end=this._io.pos,this.numSamples>0&&(this._debug.extraHeader={start:this._io.pos,ioOffset:this._io.byteOffset},this.extraHeader=new t(this._io,this,this._root),this._debug.extraHeader.end=this._io.pos)},r})(),n=o.SampleHeader=(function(){function r(e,d,p){this._io=e,this._parent=d,this._root=p,this._debug={},this._read()}r.prototype._read=function(){this._debug.sampleLength={start:this._io.pos,ioOffset:this._io.byteOffset},this.sampleLength=this._io.readU4le(),this._debug.sampleLength.end=this._io.pos,this._debug.sampleLoopStart={start:this._io.pos,ioOffset:this._io.byteOffset},this.sampleLoopStart=this._io.readU4le(),this._debug.sampleLoopStart.end=this._io.pos,this._debug.sampleLoopLength={start:this._io.pos,ioOffset:this._io.byteOffset},this.sampleLoopLength=this._io.readU4le(),this._debug.sampleLoopLength.end=this._io.pos,this._debug.volume={start:this._io.pos,ioOffset:this._io.byteOffset},this.volume=this._io.readU1(),this._debug.volume.end=this._io.pos,this._debug.fineTune={start:this._io.pos,ioOffset:this._io.byteOffset},this.fineTune=this._io.readS1(),this._debug.fineTune.end=this._io.pos,this._debug.type={start:this._io.pos,ioOffset:this._io.byteOffset},this.type=new s(this._io,this,this._root),this._debug.type.end=this._io.pos,this._debug.panning={start:this._io.pos,ioOffset:this._io.byteOffset},this.panning=this._io.readU1(),this._debug.panning.end=this._io.pos,this._debug.relativeNoteNumber={start:this._io.pos,ioOffset:this._io.byteOffset},this.relativeNoteNumber=this._io.readS1(),this._debug.relativeNoteNumber.end=this._io.pos,this._debug.reserved={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved=this._io.readU1(),this._debug.reserved.end=this._io.pos,this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=a.bytesToStr(a.bytesTerminate(this._io.readBytes(22),0,!1),"UTF-8"),this._debug.name.end=this._io.pos};var s=r.LoopType=(function(){e.LoopType=Object.freeze({NONE:0,FORWARD:1,PING_PONG:2,0:"NONE",1:"FORWARD",2:"PING_PONG"});function e(d,p,b){this._io=d,this._parent=p,this._root=b,this._debug={},this._read()}return e.prototype._read=function(){this._debug.reserved0={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved0=this._io.readBitsIntBe(3),this._debug.reserved0.end=this._io.pos,this._debug.isSampleData16Bit={start:this._io.pos,ioOffset:this._io.byteOffset},this.isSampleData16Bit=this._io.readBitsIntBe(1)!=0,this._debug.isSampleData16Bit.end=this._io.pos,this._debug.reserved1={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved1=this._io.readBitsIntBe(2),this._debug.reserved1.end=this._io.pos,this._debug.loopType={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"FasttrackerXmModule.Instrument.SampleHeader.LoopType.LoopType"},this.loopType=this._io.readBitsIntBe(2),this._debug.loopType.end=this._io.pos},e})();return r})(),h=o.SamplesData=(function(){function r(s,e,d,p){this._io=s,this._parent=e,this._root=d,this.header=p,this._debug={},this._read()}return r.prototype._read=function(){this._debug.data={start:this._io.pos,ioOffset:this._io.byteOffset},this.data=this._io.readBytes(this.header.sampleLength*(this.header.type.isSampleData16Bit?2:1)),this._debug.data.end=this._io.pos},r})();return o})(),c=f.Pattern=(function(){function o(i,n,h){this._io=i,this._parent=n,this._root=h,this._debug={},this._read()}o.prototype._read=function(){this._debug.header={start:this._io.pos,ioOffset:this._io.byteOffset},this.header=new t(this._io,this,this._root),this._debug.header.end=this._io.pos,this._debug.packedData={start:this._io.pos,ioOffset:this._io.byteOffset},this.packedData=this._io.readBytes(this.header.main.lenPackedPattern),this._debug.packedData.end=this._io.pos};var t=o.Header=(function(){function i(h,r,s){this._io=h,this._parent=r,this._root=s,this._debug={},this._read()}i.prototype._read=function(){this._debug.headerLength={start:this._io.pos,ioOffset:this._io.byteOffset},this.headerLength=this._io.readU4le(),this._debug.headerLength.end=this._io.pos,this._debug.main={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_main=this._io.readBytes(this.headerLength-4);var h=new a(this._raw_main);this.main=new n(h,this,this._root),this._debug.main.end=this._io.pos};var n=i.HeaderMain=(function(){function h(r,s,e){this._io=r,this._parent=s,this._root=e,this._debug={},this._read()}return h.prototype._read=function(){switch(this._debug.packingType={start:this._io.pos,ioOffset:this._io.byteOffset},this.packingType=this._io.readU1(),this._debug.packingType.end=this._io.pos,this._debug.numRowsRaw={start:this._io.pos,ioOffset:this._io.byteOffset},this._root.preheader.versionNumber.value){case 258:this.numRowsRaw=this._io.readU1();break;default:this.numRowsRaw=this._io.readU2le();break}this._debug.numRowsRaw.end=this._io.pos,this._debug.lenPackedPattern={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenPackedPattern=this._io.readU2le(),this._debug.lenPackedPattern.end=this._io.pos},Object.defineProperty(h.prototype,"numRows",{get:function(){return this._m_numRows!==void 0?this._m_numRows:(this._debug._m_numRows={},this._m_numRows=this.numRowsRaw+(this._root.preheader.versionNumber.value==258?1:0),this._m_numRows)}}),h})();return i})();return o})(),O=f.Preheader=(function(){function o(i,n,h){this._io=i,this._parent=n,this._root=h,this._debug={},this._read()}o.prototype._read=function(){if(this._debug.signature0={start:this._io.pos,ioOffset:this._io.byteOffset},this.signature0=this._io.readBytes(17),this._debug.signature0.end=this._io.pos,a.byteArrayCompare(this.signature0,new Uint8Array([69,120,116,101,110,100,101,100,32,77,111,100,117,108,101,58,32]))!=0){var i=new a.ValidationNotEqualError(new Uint8Array([69,120,116,101,110,100,101,100,32,77,111,100,117,108,101,58,32]),this.signature0,this._io,"/types/preheader/seq/0");throw this._debug.signature0.validationError=i,i}if(this._debug.moduleName={start:this._io.pos,ioOffset:this._io.byteOffset},this.moduleName=a.bytesToStr(a.bytesTerminate(this._io.readBytes(20),0,!1),"UTF-8"),this._debug.moduleName.end=this._io.pos,this._debug.signature1={start:this._io.pos,ioOffset:this._io.byteOffset},this.signature1=this._io.readBytes(1),this._debug.signature1.end=this._io.pos,a.byteArrayCompare(this.signature1,new Uint8Array([26]))!=0){var i=new a.ValidationNotEqualError(new Uint8Array([26]),this.signature1,this._io,"/types/preheader/seq/2");throw this._debug.signature1.validationError=i,i}this._debug.trackerName={start:this._io.pos,ioOffset:this._io.byteOffset},this.trackerName=a.bytesToStr(a.bytesTerminate(this._io.readBytes(20),0,!1),"UTF-8"),this._debug.trackerName.end=this._io.pos,this._debug.versionNumber={start:this._io.pos,ioOffset:this._io.byteOffset},this.versionNumber=new t(this._io,this,this._root),this._debug.versionNumber.end=this._io.pos,this._debug.headerSize={start:this._io.pos,ioOffset:this._io.byteOffset},this.headerSize=this._io.readU4le(),this._debug.headerSize.end=this._io.pos};var t=o.Version=(function(){function i(n,h,r){this._io=n,this._parent=h,this._root=r,this._debug={},this._read()}return i.prototype._read=function(){this._debug.minor={start:this._io.pos,ioOffset:this._io.byteOffset},this.minor=this._io.readU1(),this._debug.minor.end=this._io.pos,this._debug.major={start:this._io.pos,ioOffset:this._io.byteOffset},this.major=this._io.readU1(),this._debug.major.end=this._io.pos},Object.defineProperty(i.prototype,"value",{get:function(){return this._m_value!==void 0?this._m_value:(this._debug._m_value={},this._m_value=this.major<<8|this.minor,this._m_value)}}),i})();return o})();return f})();_.FasttrackerXmModule=l})}});const S=T(),U={id:"fasttracker_xm_module",title:"Extended Module",ksy:{meta:{id:"fasttracker_xm_module",title:"Extended Module",application:["FastTracker 2","Protracker","MilkyTracker","libmodplug","Mikmod"],"file-extension":"xm",xref:{justsolve:"Extended_Module",pronom:"fmt/323",wikidata:"Q376852"},license:"Unlicense",endian:"le",encoding:"utf-8"},doc:`XM (standing for eXtended Module) is a popular module music file
format, that was introduced in 1994 in FastTracker2 by Triton demo
group. Akin to MOD files, it bundles both digital samples
(instruments) and instructions on which note to play at what time
(patterns), which provides good audio quality with relatively small
file size. Audio is reproducible without relying on the sound of
particular hardware samplers or synths.
`,"doc-ref":`http://sid.ethz.ch/debian/milkytracker/milkytracker-0.90.85%2Bdfsg/resources/reference/xm-form.txt
ftp://ftp.modland.com/pub/documents/format_documentation/FastTracker%202%20v2.04%20(.xm).html
`,seq:[{id:"preheader",type:"preheader"},{id:"header",size:"preheader.header_size - 4",type:"header"},{id:"patterns",type:"pattern",repeat:"expr","repeat-expr":"header.num_patterns"},{id:"instruments",type:"instrument",repeat:"expr","repeat-expr":"header.num_instruments"}],types:{preheader:{seq:[{id:"signature0",contents:"Extended Module: "},{id:"module_name",size:20,type:"strz",doc:"Module name, padded with zeroes"},{id:"signature1",contents:[26]},{id:"tracker_name",size:20,type:"strz",doc:"Tracker name"},{id:"version_number",type:"version",doc:"Format versions below [0x01, 0x04] have a LOT of differences. Check this field!"},{id:"header_size",type:"u4",doc:"Header size << Calculated FROM THIS OFFSET, not from the beginning of the file! >>"}],types:{version:{seq:[{id:"minor",type:"u1",doc:"currently 0x04"},{id:"major",type:"u1",doc:"currently 0x01"}],instances:{value:{value:"(major<<8) | minor"}}}}},header:{seq:[{id:"song_length",type:"u2",doc:"Song length (in pattern order table)"},{id:"restart_position",type:"u2"},{id:"num_channels",type:"u2",doc:"(2,4,6,8,10,...,32)"},{id:"num_patterns",type:"u2",doc:"(max 256)"},{id:"num_instruments",type:"u2",doc:"(max 128)"},{id:"flags",type:"flags"},{id:"default_tempo",type:"u2"},{id:"default_bpm",type:"u2"},{id:"pattern_order_table",type:"u1",doc:"max 256",repeat:"expr","repeat-expr":256}]},flags:{seq:[{id:"reserved",type:"b15"},{id:"freq_table_type",type:"b1",doc:"0 = Amiga frequency table (see below); 1 = Linear frequency table"}]},pattern:{seq:[{id:"header",type:"header"},{id:"packed_data",size:"header.main.len_packed_pattern"}],types:{header:{seq:[{id:"header_length",type:"u4",doc:"Pattern header length"},{id:"main",type:"header_main",size:"header_length - 4"}],types:{header_main:{seq:[{id:"packing_type",type:"u1",doc:"Packing type (always 0)"},{id:"num_rows_raw",type:{"switch-on":"_root.preheader.version_number.value",cases:{258:"u1",_:"u2"}},doc:"Number of rows in pattern (1..256)"},{id:"len_packed_pattern",type:"u2",doc:"Packed pattern data size"}],instances:{num_rows:{value:"num_rows_raw + (_root.preheader.version_number.value == 0x0102 ? 1 : 0)"}}}}}}},instrument:{doc:`XM's notion of "instrument" typically constitutes of a
instrument metadata and one or several samples. Metadata
includes:

* instrument's name
* instruction of which sample to use for which note
* volume and panning envelopes and looping instructions
* vibrato settings
`,seq:[{id:"header_size",type:"u4",doc:`Instrument size << header that is >>
<< "Instrument Size" field tends to be more than the actual size of the structure documented here (it includes also the extended instrument sample header above). So remember to check it and skip the additional bytes before the first sample header >>
`},{id:"header",size:"header_size - 4",type:"header"},{id:"samples_headers",type:"sample_header",repeat:"expr","repeat-expr":"header.num_samples"},{id:"samples",type:"samples_data(samples_headers[_index])",repeat:"expr","repeat-expr":"header.num_samples"}],types:{header:{seq:[{id:"name",size:22,type:"strz"},{id:"type",type:"u1",doc:"Usually zero, but this seems pretty random, don't assume it's zero"},{id:"num_samples",type:"u2"},{id:"extra_header",type:"extra_header",if:"num_samples > 0"}]},extra_header:{seq:[{id:"len_sample_header",type:"u4"},{id:"idx_sample_per_note",type:"u1",repeat:"expr","repeat-expr":96,doc:`Index of sample that should be used for any particular
note. In the simplest case, where it's only one sample
is available, it's an array of full of zeroes.
`},{id:"volume_points",type:"envelope_point",repeat:"expr","repeat-expr":12,doc:"Points for volume envelope. Only `num_volume_points` will be actually used."},{id:"panning_points",type:"envelope_point",repeat:"expr","repeat-expr":12,doc:"Points for panning envelope. Only `num_panning_points` will be actually used."},{id:"num_volume_points",type:"u1"},{id:"num_panning_points",type:"u1"},{id:"volume_sustain_point",type:"u1"},{id:"volume_loop_start_point",type:"u1"},{id:"volume_loop_end_point",type:"u1"},{id:"panning_sustain_point",type:"u1"},{id:"panning_loop_start_point",type:"u1"},{id:"panning_loop_end_point",type:"u1"},{id:"volume_type",type:"u1",enum:"type"},{id:"panning_type",type:"u1",enum:"type"},{id:"vibrato_type",type:"u1"},{id:"vibrato_sweep",type:"u1"},{id:"vibrato_depth",type:"u1"},{id:"vibrato_rate",type:"u1"},{id:"volume_fadeout",type:"u2"},{id:"reserved",type:"u2"}],types:{envelope_point:{doc:`Envelope frame-counters work in range 0..FFFFh (0..65535 dec).
BUT! FT2 only itself supports only range 0..FFh (0..255 dec).
Some other trackers (like SoundTracker for Unix), however, can use the full range 0..FFFF, so it should be supported.
!!TIP: This is also a good way to detect if the module has been made with FT2 or not. (In case the tracker name is brain- deadly left unchanged!)
Of course it does not help if all instruments have the values inside FT2 supported range.
The value-field of the envelope point is ranged between 00..3Fh (0..64 dec).
`,seq:[{id:"x",type:"u2",doc:"Frame number of the point"},{id:"y",type:"u2",doc:"Value of the point"}]}},enums:{type:{0:"on",1:"sustain",2:"loop"}}},samples_data:{doc:`The saved data uses simple delta-encoding to achieve better compression ratios (when compressed with pkzip, etc.)
Pseudocode for converting the delta-coded data to normal data,
old = 0;
for i in range(data_len):
  new = sample[i] + old;
  sample[i] = new;
  old = new;
`,params:[{id:"header",type:"sample_header"}],seq:[{id:"data",size:"header.sample_length * (header.type.is_sample_data_16_bit ? 2 : 1)"}]},sample_header:{seq:[{id:"sample_length",type:"u4"},{id:"sample_loop_start",type:"u4"},{id:"sample_loop_length",type:"u4"},{id:"volume",type:"u1"},{id:"fine_tune",type:"s1",doc:"-16..+15"},{id:"type",type:"loop_type"},{id:"panning",type:"u1",doc:"(0-255)"},{id:"relative_note_number",type:"s1"},{id:"reserved",type:"u1"},{id:"name",size:22,type:"strz"}],types:{loop_type:{seq:[{id:"reserved0",type:"b3"},{id:"is_sample_data_16_bit",type:"b1"},{id:"reserved1",type:"b2"},{id:"loop_type",type:"b2",enum:"loop_type"}],enums:{loop_type:{0:"none",1:"forward",2:"ping_pong"}}}}}}}}}};export{S as default,U as spec};
