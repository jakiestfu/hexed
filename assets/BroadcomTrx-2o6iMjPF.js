import{k as l}from"./index-DQZRlv-R.js";var y=Object.getOwnPropertyNames,m=(a,r)=>function(){return r||(0,a[y(a)[0]])((r={exports:{}}).exports,r),r.exports},v=m({"<stdin>"(a){(function(r,n){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],n):typeof a=="object"&&a!==null&&typeof a.nodeType!="number"?n(a,l.KaitaiStream):n(r.BroadcomTrx||(r.BroadcomTrx={}),r.KaitaiStream)})(typeof self<"u"?self:a,function(r,n){var p=(function(){function _(e,h,s){this._io=e,this._parent=h,this._root=s||this,this._debug={},this._read()}_.prototype._read=function(){};var u=_.Header=(function(){function e(i,t,o){this._io=i,this._parent=t,this._root=o,this._debug={},this._read()}e.prototype._read=function(){if(this._debug.magic={start:this._io.pos,ioOffset:this._io.byteOffset},this.magic=this._io.readBytes(4),this._debug.magic.end=this._io.pos,n.byteArrayCompare(this.magic,new Uint8Array([72,68,82,48]))!=0){var i=new n.ValidationNotEqualError(new Uint8Array([72,68,82,48]),this.magic,this._io,"/types/header/seq/0");throw this._debug.magic.validationError=i,i}this._debug.len={start:this._io.pos,ioOffset:this._io.byteOffset},this.len=this._io.readU4le(),this._debug.len.end=this._io.pos,this._debug.crc32={start:this._io.pos,ioOffset:this._io.byteOffset},this.crc32=this._io.readU4le(),this._debug.crc32.end=this._io.pos,this._debug.version={start:this._io.pos,ioOffset:this._io.byteOffset},this.version=this._io.readU2le(),this._debug.version.end=this._io.pos,this._debug.flags={start:this._io.pos,ioOffset:this._io.byteOffset},this.flags=new h(this._io,this,this._root),this._debug.flags.end=this._io.pos,this._debug.partitions={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.partitions.arr=[],this.partitions=[];var t=0;do{this._debug.partitions.arr[this.partitions.length]={start:this._io.pos,ioOffset:this._io.byteOffset};var o=new s(this._io,this,this._root,t);this.partitions.push(o),this._debug.partitions.arr[this.partitions.length-1].end=this._io.pos,t++}while(!(t>=4||!o.isPresent));this._debug.partitions.end=this._io.pos};var h=e.Flags=(function(){function i(t,o,d){this._io=t,this._parent=o,this._root=d,this._debug={},this._read()}return i.prototype._read=function(){this._debug.flags={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.flags.arr=[],this.flags=[];for(var t=0;t<16;t++)this._debug.flags.arr[t]={start:this._io.pos,ioOffset:this._io.byteOffset},this.flags.push(this._io.readBitsIntLe(1)!=0),this._debug.flags.arr[t].end=this._io.pos;this._debug.flags.end=this._io.pos},i})(),s=e.Partition=(function(){function i(t,o,d,g){this._io=t,this._parent=o,this._root=d,this.idx=g,this._debug={},this._read()}return i.prototype._read=function(){this._debug.ofsBody={start:this._io.pos,ioOffset:this._io.byteOffset},this.ofsBody=this._io.readU4le(),this._debug.ofsBody.end=this._io.pos},Object.defineProperty(i.prototype,"body",{get:function(){if(this._m_body!==void 0)return this._m_body;if(this.isPresent){var t=this._root._io,o=t.pos;t.seek(this.ofsBody),this._debug._m_body={start:t.pos,ioOffset:t.byteOffset},this._m_body=t.readBytes(this.lenBody),this._debug._m_body.end=t.pos,t.seek(o)}return this._m_body}}),Object.defineProperty(i.prototype,"isLast",{get:function(){return this._m_isLast!==void 0?this._m_isLast:(this.isPresent&&(this._debug._m_isLast={},this._m_isLast=this.idx==this._parent.partitions.length-1||!this._parent.partitions[this.idx+1].isPresent),this._m_isLast)}}),Object.defineProperty(i.prototype,"isPresent",{get:function(){return this._m_isPresent!==void 0?this._m_isPresent:(this._debug._m_isPresent={},this._m_isPresent=this.ofsBody!=0,this._m_isPresent)}}),Object.defineProperty(i.prototype,"lenBody",{get:function(){return this._m_lenBody!==void 0?this._m_lenBody:(this.isPresent&&(this._debug._m_lenBody={},this._m_lenBody=this.isLast?this._root._io.size-this.ofsBody:this._parent.partitions[this.idx+1].ofsBody),this._m_lenBody)}}),i})();return e})(),f=_.Revision=(function(){function e(h,s,i){this._io=h,this._parent=s,this._root=i,this._debug={},this._read()}return e.prototype._read=function(){this._debug.major={start:this._io.pos,ioOffset:this._io.byteOffset},this.major=this._io.readU1(),this._debug.major.end=this._io.pos,this._debug.minor={start:this._io.pos,ioOffset:this._io.byteOffset},this.minor=this._io.readU1(),this._debug.minor.end=this._io.pos},e})(),b=_.Tail=(function(){function e(s,i,t){this._io=s,this._parent=i,this._root=t,this._debug={},this._read()}e.prototype._read=function(){this._debug.version={start:this._io.pos,ioOffset:this._io.byteOffset},this.version=new c(this._io,this,this._root),this._debug.version.end=this._io.pos,this._debug.productId={start:this._io.pos,ioOffset:this._io.byteOffset},this.productId=n.bytesToStr(n.bytesTerminate(this._io.readBytes(12),0,!1),"UTF-8"),this._debug.productId.end=this._io.pos,this._debug.compHw={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.compHw.arr=[],this.compHw=[];for(var s=0;s<4;s++)this._debug.compHw.arr[s]={start:this._io.pos,ioOffset:this._io.byteOffset},this.compHw.push(new h(this._io,this,this._root)),this._debug.compHw.arr[s].end=this._io.pos;this._debug.compHw.end=this._io.pos,this._debug.reserved={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved=this._io.readBytes(32),this._debug.reserved.end=this._io.pos};var h=e.HwCompInfo=(function(){function s(i,t,o){this._io=i,this._parent=t,this._root=o,this._debug={},this._read()}return s.prototype._read=function(){this._debug.min={start:this._io.pos,ioOffset:this._io.byteOffset},this.min=new f(this._io,this,this._root),this._debug.min.end=this._io.pos,this._debug.max={start:this._io.pos,ioOffset:this._io.byteOffset},this.max=new f(this._io,this,this._root),this._debug.max.end=this._io.pos},s})();return e})(),c=_.Version=(function(){function e(h,s,i){this._io=h,this._parent=s,this._root=i,this._debug={},this._read()}return e.prototype._read=function(){this._debug.major={start:this._io.pos,ioOffset:this._io.byteOffset},this.major=this._io.readU1(),this._debug.major.end=this._io.pos,this._debug.minor={start:this._io.pos,ioOffset:this._io.byteOffset},this.minor=this._io.readU1(),this._debug.minor.end=this._io.pos,this._debug.patch={start:this._io.pos,ioOffset:this._io.byteOffset},this.patch=this._io.readU1(),this._debug.patch.end=this._io.pos,this._debug.tweak={start:this._io.pos,ioOffset:this._io.byteOffset},this.tweak=this._io.readU1(),this._debug.tweak.end=this._io.pos},e})();return Object.defineProperty(_.prototype,"header",{get:function(){if(this._m_header!==void 0)return this._m_header;var e=this._io.pos;return this._io.seek(0),this._debug._m_header={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_header=new u(this._io,this,this._root),this._debug._m_header.end=this._io.pos,this._io.seek(e),this._m_header}}),Object.defineProperty(_.prototype,"tail",{get:function(){if(this._m_tail!==void 0)return this._m_tail;var e=this._io.pos;return this._io.seek(this._io.size-64),this._debug._m_tail={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_tail=new b(this._io,this,this._root),this._debug._m_tail.end=this._io.pos,this._io.seek(e),this._m_tail}}),_})();r.BroadcomTrx=p})}});const w=v(),x={id:"broadcom_trx",title:"Broadcom devices .trx firmware packaging",ksy:{meta:{id:"broadcom_trx",title:"Broadcom devices .trx firmware packaging","file-extension":"trx",license:"GPL-2.0-or-later","ks-version":.9,"bit-endian":"le",encoding:"utf-8",endian:"le"},"-license":`Copyright (C) 2004  Manuel Novoa III  <mjn3@codepoet.org>

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
USA
`,doc:`.trx file format is widely used for distribution of firmware
updates for Broadcom devices. The most well-known are ASUS routers.

Fundamentally, it includes a footer which acts as a safeguard
against installing a firmware package on a wrong hardware model or
version, and a header which list numerous partitions packaged inside
a single .trx file.

trx files not necessarily contain all these headers.
`,"doc-ref":["https://github.com/openwrt/firmware-utils/blob/a2c80c5/src/trx.c","https://web.archive.org/web/20190127154419/https://openwrt.org/docs/techref/header","https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/Documentation/devicetree/bindings/mtd/partitions/brcm,trx.txt"],instances:{header:{pos:0,type:"header"},tail:{pos:"_io.size - sizeof<tail>",type:"tail"}},types:{revision:{seq:[{id:"major",type:"u1"},{id:"minor",type:"u1"}]},version:{seq:[{id:"major",type:"u1"},{id:"minor",type:"u1"},{id:"patch",type:"u1"},{id:"tweak",type:"u1"}]},tail:{doc:"A safeguard against installation of firmware to an incompatible device",seq:[{id:"version",type:"version",doc:"1.9.2.7 by default"},{id:"product_id",type:"strz",size:12},{id:"comp_hw",type:"hw_comp_info",repeat:"expr","repeat-expr":4,doc:"0.02 - 2.99"},{id:"reserved",size:32}],types:{hw_comp_info:{seq:[{id:"min",type:"revision"},{id:"max",type:"revision"}]}}},header:{seq:[{id:"magic",contents:"HDR0"},{id:"len",type:"u4",doc:"Length of file including header"},{id:"crc32",type:"u4",doc:"CRC from `version` (??? todo: see the original and disambiguate) to end of file"},{id:"version",type:"u2"},{id:"flags",type:"flags"},{id:"partitions",type:"partition(_index)",doc:"Offsets of partitions from start of header",repeat:"until","repeat-until":"_index >= 4 or not _.is_present"}],types:{partition:{params:[{id:"idx",type:"u1"}],seq:[{id:"ofs_body",type:"u4"}],instances:{is_present:{value:"ofs_body != 0"},is_last:{value:"(idx == _parent.partitions.size - 1) or (not _parent.partitions[idx + 1].is_present)",if:"is_present"},len_body:{value:"is_last ? (_root._io.size - ofs_body) : _parent.partitions[idx + 1].ofs_body",if:"is_present"},body:{io:"_root._io",pos:"ofs_body",size:"len_body",if:"is_present"}}},flags:{seq:[{id:"flags",type:"b1",repeat:"expr","repeat-expr":16}]}}}}}};export{w as default,x as spec};
