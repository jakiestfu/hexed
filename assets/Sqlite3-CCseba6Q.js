import{k as v}from"./index-ik_lyK6M.js";var w=Object.getOwnPropertyNames,P=(r,_)=>function(){return _||(0,r[w(r)[0]])((_={exports:{}}).exports,_),_.exports},C=P({"<stdin>"(r){(function(_,a){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream","./VlqBase128Be"],a):typeof r=="object"&&r!==null&&typeof r.nodeType!="number"?a(r,v.KaitaiStream,require("./VlqBase128Be")):a(_.Sqlite3||(_.Sqlite3={}),_.KaitaiStream,_.VlqBase128Be||(_.VlqBase128Be={}))})(typeof self<"u"?self:r,function(_,a,h){var d=(function(){o.Encodings=Object.freeze({UTF_8:1,UTF_16LE:2,UTF_16BE:3,1:"UTF_8",2:"UTF_16LE",3:"UTF_16BE"}),o.Versions=Object.freeze({LEGACY:1,WAL:2,1:"LEGACY",2:"WAL"});function o(e,t,i){this._io=e,this._parent=t,this._root=i||this,this._debug={},this._read()}o.prototype._read=function(){if(this._debug.magic={start:this._io.pos,ioOffset:this._io.byteOffset},this.magic=this._io.readBytes(16),this._debug.magic.end=this._io.pos,a.byteArrayCompare(this.magic,new Uint8Array([83,81,76,105,116,101,32,102,111,114,109,97,116,32,51,0]))!=0){var e=new a.ValidationNotEqualError(new Uint8Array([83,81,76,105,116,101,32,102,111,114,109,97,116,32,51,0]),this.magic,this._io,"/seq/0");throw this._debug.magic.validationError=e,e}this._debug.lenPageMod={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenPageMod=this._io.readU2be(),this._debug.lenPageMod.end=this._io.pos,this._debug.writeVersion={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"Sqlite3.Versions"},this.writeVersion=this._io.readU1(),this._debug.writeVersion.end=this._io.pos,this._debug.readVersion={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"Sqlite3.Versions"},this.readVersion=this._io.readU1(),this._debug.readVersion.end=this._io.pos,this._debug.reservedSpace={start:this._io.pos,ioOffset:this._io.byteOffset},this.reservedSpace=this._io.readU1(),this._debug.reservedSpace.end=this._io.pos,this._debug.maxPayloadFrac={start:this._io.pos,ioOffset:this._io.byteOffset},this.maxPayloadFrac=this._io.readU1(),this._debug.maxPayloadFrac.end=this._io.pos,this._debug.minPayloadFrac={start:this._io.pos,ioOffset:this._io.byteOffset},this.minPayloadFrac=this._io.readU1(),this._debug.minPayloadFrac.end=this._io.pos,this._debug.leafPayloadFrac={start:this._io.pos,ioOffset:this._io.byteOffset},this.leafPayloadFrac=this._io.readU1(),this._debug.leafPayloadFrac.end=this._io.pos,this._debug.fileChangeCounter={start:this._io.pos,ioOffset:this._io.byteOffset},this.fileChangeCounter=this._io.readU4be(),this._debug.fileChangeCounter.end=this._io.pos,this._debug.numPages={start:this._io.pos,ioOffset:this._io.byteOffset},this.numPages=this._io.readU4be(),this._debug.numPages.end=this._io.pos,this._debug.firstFreelistTrunkPage={start:this._io.pos,ioOffset:this._io.byteOffset},this.firstFreelistTrunkPage=this._io.readU4be(),this._debug.firstFreelistTrunkPage.end=this._io.pos,this._debug.numFreelistPages={start:this._io.pos,ioOffset:this._io.byteOffset},this.numFreelistPages=this._io.readU4be(),this._debug.numFreelistPages.end=this._io.pos,this._debug.schemaCookie={start:this._io.pos,ioOffset:this._io.byteOffset},this.schemaCookie=this._io.readU4be(),this._debug.schemaCookie.end=this._io.pos,this._debug.schemaFormat={start:this._io.pos,ioOffset:this._io.byteOffset},this.schemaFormat=this._io.readU4be(),this._debug.schemaFormat.end=this._io.pos,this._debug.defPageCacheSize={start:this._io.pos,ioOffset:this._io.byteOffset},this.defPageCacheSize=this._io.readU4be(),this._debug.defPageCacheSize.end=this._io.pos,this._debug.largestRootPage={start:this._io.pos,ioOffset:this._io.byteOffset},this.largestRootPage=this._io.readU4be(),this._debug.largestRootPage.end=this._io.pos,this._debug.textEncoding={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"Sqlite3.Encodings"},this.textEncoding=this._io.readU4be(),this._debug.textEncoding.end=this._io.pos,this._debug.userVersion={start:this._io.pos,ioOffset:this._io.byteOffset},this.userVersion=this._io.readU4be(),this._debug.userVersion.end=this._io.pos,this._debug.isIncrementalVacuum={start:this._io.pos,ioOffset:this._io.byteOffset},this.isIncrementalVacuum=this._io.readU4be(),this._debug.isIncrementalVacuum.end=this._io.pos,this._debug.applicationId={start:this._io.pos,ioOffset:this._io.byteOffset},this.applicationId=this._io.readU4be(),this._debug.applicationId.end=this._io.pos,this._debug.reserved={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved=this._io.readBytes(20),this._debug.reserved.end=this._io.pos,this._debug.versionValidFor={start:this._io.pos,ioOffset:this._io.byteOffset},this.versionValidFor=this._io.readU4be(),this._debug.versionValidFor.end=this._io.pos,this._debug.sqliteVersionNumber={start:this._io.pos,ioOffset:this._io.byteOffset},this.sqliteVersionNumber=this._io.readU4be(),this._debug.sqliteVersionNumber.end=this._io.pos,this._debug.rootPage={start:this._io.pos,ioOffset:this._io.byteOffset},this.rootPage=new l(this._io,this,this._root),this._debug.rootPage.end=this._io.pos};var l=o.BtreePage=(function(){function e(t,i,s){this._io=t,this._parent=i,this._root=s,this._debug={},this._read()}return e.prototype._read=function(){this._debug.pageType={start:this._io.pos,ioOffset:this._io.byteOffset},this.pageType=this._io.readU1(),this._debug.pageType.end=this._io.pos,this._debug.firstFreeblock={start:this._io.pos,ioOffset:this._io.byteOffset},this.firstFreeblock=this._io.readU2be(),this._debug.firstFreeblock.end=this._io.pos,this._debug.numCells={start:this._io.pos,ioOffset:this._io.byteOffset},this.numCells=this._io.readU2be(),this._debug.numCells.end=this._io.pos,this._debug.ofsCells={start:this._io.pos,ioOffset:this._io.byteOffset},this.ofsCells=this._io.readU2be(),this._debug.ofsCells.end=this._io.pos,this._debug.numFragFreeBytes={start:this._io.pos,ioOffset:this._io.byteOffset},this.numFragFreeBytes=this._io.readU1(),this._debug.numFragFreeBytes.end=this._io.pos,(this.pageType==2||this.pageType==5)&&(this._debug.rightPtr={start:this._io.pos,ioOffset:this._io.byteOffset},this.rightPtr=this._io.readU4be(),this._debug.rightPtr.end=this._io.pos),this._debug.cells={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.cells.arr=[],this.cells=[];for(var t=0;t<this.numCells;t++)this._debug.cells.arr[t]={start:this._io.pos,ioOffset:this._io.byteOffset},this.cells.push(new c(this._io,this,this._root)),this._debug.cells.arr[t].end=this._io.pos;this._debug.cells.end=this._io.pos},e})(),f=o.CellIndexInterior=(function(){function e(t,i,s){this._io=t,this._parent=i,this._root=s,this._debug={},this._read()}return e.prototype._read=function(){this._debug.leftChildPage={start:this._io.pos,ioOffset:this._io.byteOffset},this.leftChildPage=this._io.readU4be(),this._debug.leftChildPage.end=this._io.pos,this._debug.lenPayload={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenPayload=new h.VlqBase128Be(this._io,null,null),this._debug.lenPayload.end=this._io.pos,this._debug.payload={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_payload=this._io.readBytes(this.lenPayload.value);var t=new a(this._raw_payload);this.payload=new n(t,this,this._root),this._debug.payload.end=this._io.pos},e})(),u=o.CellIndexLeaf=(function(){function e(t,i,s){this._io=t,this._parent=i,this._root=s,this._debug={},this._read()}return e.prototype._read=function(){this._debug.lenPayload={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenPayload=new h.VlqBase128Be(this._io,null,null),this._debug.lenPayload.end=this._io.pos,this._debug.payload={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_payload=this._io.readBytes(this.lenPayload.value);var t=new a(this._raw_payload);this.payload=new n(t,this,this._root),this._debug.payload.end=this._io.pos},e})(),n=o.CellPayload=(function(){function e(t,i,s){this._io=t,this._parent=i,this._root=s,this._debug={},this._read()}return e.prototype._read=function(){this._debug.lenHeaderAndLen={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenHeaderAndLen=new h.VlqBase128Be(this._io,null,null),this._debug.lenHeaderAndLen.end=this._io.pos,this._debug.columnSerials={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_columnSerials=this._io.readBytes(this.lenHeaderAndLen.value-1);var t=new a(this._raw_columnSerials);this.columnSerials=new m(t,this,this._root),this._debug.columnSerials.end=this._io.pos,this._debug.columnContents={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.columnContents.arr=[],this.columnContents=[];for(var i=0;i<this.columnSerials.entries.length;i++)this._debug.columnContents.arr[i]={start:this._io.pos,ioOffset:this._io.byteOffset},this.columnContents.push(new g(this._io,this,this._root,this.columnSerials.entries[i])),this._debug.columnContents.arr[i].end=this._io.pos;this._debug.columnContents.end=this._io.pos},e})(),p=o.CellTableInterior=(function(){function e(t,i,s){this._io=t,this._parent=i,this._root=s,this._debug={},this._read()}return e.prototype._read=function(){this._debug.leftChildPage={start:this._io.pos,ioOffset:this._io.byteOffset},this.leftChildPage=this._io.readU4be(),this._debug.leftChildPage.end=this._io.pos,this._debug.rowId={start:this._io.pos,ioOffset:this._io.byteOffset},this.rowId=new h.VlqBase128Be(this._io,null,null),this._debug.rowId.end=this._io.pos},e})(),b=o.CellTableLeaf=(function(){function e(t,i,s){this._io=t,this._parent=i,this._root=s,this._debug={},this._read()}return e.prototype._read=function(){this._debug.lenPayload={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenPayload=new h.VlqBase128Be(this._io,null,null),this._debug.lenPayload.end=this._io.pos,this._debug.rowId={start:this._io.pos,ioOffset:this._io.byteOffset},this.rowId=new h.VlqBase128Be(this._io,null,null),this._debug.rowId.end=this._io.pos,this._debug.payload={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_payload=this._io.readBytes(this.lenPayload.value);var t=new a(this._raw_payload);this.payload=new n(t,this,this._root),this._debug.payload.end=this._io.pos},e})(),g=o.ColumnContent=(function(){function e(t,i,s,O){this._io=t,this._parent=i,this._root=s,this.serialType=O,this._debug={},this._read()}return e.prototype._read=function(){if(this.serialType.code.value>=1&&this.serialType.code.value<=6){switch(this._debug.asInt={start:this._io.pos,ioOffset:this._io.byteOffset},this.serialType.code.value){case 1:this.asInt=this._io.readU1();break;case 2:this.asInt=this._io.readU2be();break;case 3:this.asInt=this._io.readBitsIntBe(24);break;case 4:this.asInt=this._io.readU4be();break;case 5:this.asInt=this._io.readBitsIntBe(48);break;case 6:this.asInt=this._io.readU8be();break}this._debug.asInt.end=this._io.pos}this.serialType.code.value==7&&(this._debug.asFloat={start:this._io.pos,ioOffset:this._io.byteOffset},this.asFloat=this._io.readF8be(),this._debug.asFloat.end=this._io.pos),this.serialType.isBlob&&(this._debug.asBlob={start:this._io.pos,ioOffset:this._io.byteOffset},this.asBlob=this._io.readBytes(this.serialType.lenContent),this._debug.asBlob.end=this._io.pos),this._debug.asStr={start:this._io.pos,ioOffset:this._io.byteOffset},this.asStr=a.bytesToStr(this._io.readBytes(this.serialType.lenContent),"UTF-8"),this._debug.asStr.end=this._io.pos},e})(),c=o.RefCell=(function(){function e(t,i,s){this._io=t,this._parent=i,this._root=s,this._debug={},this._read()}return e.prototype._read=function(){this._debug.ofsBody={start:this._io.pos,ioOffset:this._io.byteOffset},this.ofsBody=this._io.readU2be(),this._debug.ofsBody.end=this._io.pos},Object.defineProperty(e.prototype,"body",{get:function(){if(this._m_body!==void 0)return this._m_body;var t=this._io.pos;switch(this._io.seek(this.ofsBody),this._debug._m_body={start:this._io.pos,ioOffset:this._io.byteOffset},this._parent.pageType){case 10:this._m_body=new u(this._io,this,this._root);break;case 13:this._m_body=new b(this._io,this,this._root);break;case 2:this._m_body=new f(this._io,this,this._root);break;case 5:this._m_body=new p(this._io,this,this._root);break}return this._debug._m_body.end=this._io.pos,this._io.seek(t),this._m_body}}),e})(),y=o.Serial=(function(){function e(t,i,s){this._io=t,this._parent=i,this._root=s,this._debug={},this._read()}return e.prototype._read=function(){this._debug.code={start:this._io.pos,ioOffset:this._io.byteOffset},this.code=new h.VlqBase128Be(this._io,null,null),this._debug.code.end=this._io.pos},Object.defineProperty(e.prototype,"isBlob",{get:function(){return this._m_isBlob!==void 0?this._m_isBlob:(this._debug._m_isBlob={},this._m_isBlob=this.code.value>=12&&a.mod(this.code.value,2)==0,this._m_isBlob)}}),Object.defineProperty(e.prototype,"isString",{get:function(){return this._m_isString!==void 0?this._m_isString:(this._debug._m_isString={},this._m_isString=this.code.value>=13&&a.mod(this.code.value,2)==1,this._m_isString)}}),Object.defineProperty(e.prototype,"lenContent",{get:function(){return this._m_lenContent!==void 0?this._m_lenContent:(this.code.value>=12&&(this._debug._m_lenContent={},this._m_lenContent=Math.floor((this.code.value-12)/2)),this._m_lenContent)}}),e})(),m=o.Serials=(function(){function e(t,i,s){this._io=t,this._parent=i,this._root=s,this._debug={},this._read()}return e.prototype._read=function(){for(this._debug.entries={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.entries.arr=[],this.entries=[];!this._io.isEof();)this._debug.entries.arr[this.entries.length]={start:this._io.pos,ioOffset:this._io.byteOffset},this.entries.push(new y(this._io,this,this._root)),this._debug.entries.arr[this.entries.length-1].end=this._io.pos;this._debug.entries.end=this._io.pos},e})();return Object.defineProperty(o.prototype,"lenPage",{get:function(){return this._m_lenPage!==void 0?this._m_lenPage:(this._debug._m_lenPage={},this._m_lenPage=this.lenPageMod==1?65536:this.lenPageMod,this._m_lenPage)}}),o})();_.Sqlite3=d})}});const F=C(),U={id:"sqlite3",title:"SQLite3 database file",ksy:{meta:{id:"sqlite3",title:"SQLite3 database file","file-extension":["sqlite","db","db3","sqlite3"],xref:{forensicswiki:"sqlite_database_format",justsolve:"SQLite",loc:"fdd000461",pronom:"fmt/729",wikidata:"Q28600453"},license:"CC0-1.0","ks-version":"0.9",imports:["/common/vlq_base128_be"],endian:"be"},doc:`SQLite3 is a popular serverless SQL engine, implemented as a library
to be used within other applications. It keeps its databases as
regular disk files.

Every database file is segmented into pages. First page (starting at
the very beginning) is special: it contains a file-global header
which specifies some data relevant to proper parsing (i.e. format
versions, size of page, etc). After the header, normal contents of
the first page follow.

Each page would be of some type, and generally, they would be
reached via the links starting from the first page. First page type
(\`root_page\`) is always "btree_page".
`,"doc-ref":"https://www.sqlite.org/fileformat.html",seq:[{id:"magic",contents:["SQLite format 3",0]},{id:"len_page_mod",type:"u2",doc:`The database page size in bytes. Must be a power of two between
512 and 32768 inclusive, or the value 1 representing a page size
of 65536.
`},{id:"write_version",type:"u1",enum:"versions"},{id:"read_version",type:"u1",enum:"versions"},{id:"reserved_space",type:"u1",doc:'Bytes of unused "reserved" space at the end of each page. Usually 0.'},{id:"max_payload_frac",type:"u1",doc:"Maximum embedded payload fraction. Must be 64."},{id:"min_payload_frac",type:"u1",doc:"Minimum embedded payload fraction. Must be 32."},{id:"leaf_payload_frac",type:"u1",doc:"Leaf payload fraction. Must be 32."},{id:"file_change_counter",type:"u4"},{id:"num_pages",type:"u4",doc:'Size of the database file in pages. The "in-header database size".'},{id:"first_freelist_trunk_page",type:"u4",doc:"Page number of the first freelist trunk page."},{id:"num_freelist_pages",type:"u4",doc:"Total number of freelist pages."},{id:"schema_cookie",type:"u4"},{id:"schema_format",type:"u4",doc:"The schema format number. Supported schema formats are 1, 2, 3, and 4."},{id:"def_page_cache_size",type:"u4",doc:"Default page cache size."},{id:"largest_root_page",type:"u4",doc:"The page number of the largest root b-tree page when in auto-vacuum or incremental-vacuum modes, or zero otherwise."},{id:"text_encoding",type:"u4",enum:"encodings",doc:"The database text encoding. A value of 1 means UTF-8. A value of 2 means UTF-16le. A value of 3 means UTF-16be."},{id:"user_version",type:"u4",doc:'The "user version" as read and set by the user_version pragma.'},{id:"is_incremental_vacuum",type:"u4",doc:"True (non-zero) for incremental-vacuum mode. False (zero) otherwise."},{id:"application_id",type:"u4",doc:'The "Application ID" set by PRAGMA application_id.'},{id:"reserved",size:20},{id:"version_valid_for",type:"u4"},{id:"sqlite_version_number",type:"u4"},{id:"root_page",type:"btree_page"}],instances:{len_page:{value:"len_page_mod == 1 ? 0x10000 : len_page_mod"}},types:{btree_page:{seq:[{id:"page_type",type:"u1"},{id:"first_freeblock",type:"u2"},{id:"num_cells",type:"u2"},{id:"ofs_cells",type:"u2"},{id:"num_frag_free_bytes",type:"u1"},{id:"right_ptr",type:"u4",if:"page_type == 2 or page_type == 5"},{id:"cells",type:"ref_cell",repeat:"expr","repeat-expr":"num_cells"}]},ref_cell:{seq:[{id:"ofs_body",type:"u2"}],instances:{body:{pos:"ofs_body",type:{"switch-on":"_parent.page_type",cases:{2:"cell_index_interior",5:"cell_table_interior",10:"cell_index_leaf",13:"cell_table_leaf"}}}}},cell_table_leaf:{"doc-ref":"https://www.sqlite.org/fileformat.html#b_tree_pages",seq:[{id:"len_payload",type:"vlq_base128_be"},{id:"row_id",type:"vlq_base128_be"},{id:"payload",size:"len_payload.value",type:"cell_payload"}]},cell_table_interior:{"doc-ref":"https://www.sqlite.org/fileformat.html#b_tree_pages",seq:[{id:"left_child_page",type:"u4"},{id:"row_id",type:"vlq_base128_be"}]},cell_index_leaf:{"doc-ref":"https://www.sqlite.org/fileformat.html#b_tree_pages",seq:[{id:"len_payload",type:"vlq_base128_be"},{id:"payload",size:"len_payload.value",type:"cell_payload"}]},cell_index_interior:{"doc-ref":"https://www.sqlite.org/fileformat.html#b_tree_pages",seq:[{id:"left_child_page",type:"u4"},{id:"len_payload",type:"vlq_base128_be"},{id:"payload",size:"len_payload.value",type:"cell_payload"}]},cell_payload:{"doc-ref":"https://sqlite.org/fileformat2.html#record_format",seq:[{id:"len_header_and_len",type:"vlq_base128_be"},{id:"column_serials",size:"len_header_and_len.value - 1",type:"serials"},{id:"column_contents",repeat:"expr","repeat-expr":"column_serials.entries.size",type:"column_content(column_serials.entries[_index])"}]},serials:{seq:[{id:"entries",type:"serial",repeat:"eos"}]},serial:{seq:[{id:"code",type:"vlq_base128_be"}],instances:{is_blob:{value:"code.value >= 12 and (code.value % 2 == 0)"},is_string:{value:"code.value >= 13 and (code.value % 2 == 1)"},len_content:{value:"(code.value - 12) / 2",if:"code.value >= 12"}}},column_content:{params:[{id:"serial_type",type:"serial"}],seq:[{id:"as_int",type:{"switch-on":"serial_type.code.value",cases:{1:"u1",2:"u2",3:"b24",4:"u4",5:"b48",6:"u8"}},if:"serial_type.code.value >= 1 and serial_type.code.value <= 6"},{id:"as_float",type:"f8",if:"serial_type.code.value == 7"},{id:"as_blob",size:"serial_type.len_content",if:"serial_type.is_blob"},{id:"as_str",type:"str",size:"serial_type.len_content",encoding:"UTF-8"}]}},enums:{versions:{1:"legacy",2:"wal"},encodings:{1:"utf_8",2:"utf_16le",3:"utf_16be"}}}};export{F as default,U as spec};
