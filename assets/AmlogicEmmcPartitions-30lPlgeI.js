import{k as p}from"./index-ik_lyK6M.js";var u=Object.getOwnPropertyNames,c=(s,e)=>function(){return e||(0,s[u(s)[0]])((e={exports:{}}).exports,e),e.exports},m=c({"<stdin>"(s){(function(e,t){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],t):typeof s=="object"&&s!==null&&typeof s.nodeType!="number"?t(s,p.KaitaiStream):t(e.AmlogicEmmcPartitions||(e.AmlogicEmmcPartitions={}),e.KaitaiStream)})(typeof self<"u"?self:s,function(e,t){var d=(function(){function n(i,o,a){this._io=i,this._parent=o,this._root=a||this,this._debug={},this._read()}n.prototype._read=function(){if(this._debug.magic={start:this._io.pos,ioOffset:this._io.byteOffset},this.magic=this._io.readBytes(4),this._debug.magic.end=this._io.pos,t.byteArrayCompare(this.magic,new Uint8Array([77,80,84,0]))!=0){var i=new t.ValidationNotEqualError(new Uint8Array([77,80,84,0]),this.magic,this._io,"/seq/0");throw this._debug.magic.validationError=i,i}if(this._debug.version={start:this._io.pos,ioOffset:this._io.byteOffset},this.version=t.bytesToStr(t.bytesTerminate(this._io.readBytes(12),0,!1),"UTF-8"),this._debug.version.end=this._io.pos,this._debug.numPartitions={start:this._io.pos,ioOffset:this._io.byteOffset},this.numPartitions=this._io.readS4le(),this._debug.numPartitions.end=this._io.pos,!(this.numPartitions>=1)){var i=new t.ValidationLessThanError(1,this.numPartitions,this._io,"/seq/2");throw this._debug.numPartitions.validationError=i,i}if(!(this.numPartitions<=32)){var i=new t.ValidationGreaterThanError(32,this.numPartitions,this._io,"/seq/2");throw this._debug.numPartitions.validationError=i,i}this._debug.checksum={start:this._io.pos,ioOffset:this._io.byteOffset},this.checksum=this._io.readU4le(),this._debug.checksum.end=this._io.pos,this._debug.partitions={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.partitions.arr=[],this.partitions=[];for(var o=0;o<this.numPartitions;o++)this._debug.partitions.arr[o]={start:this._io.pos,ioOffset:this._io.byteOffset},this.partitions.push(new _(this._io,this,this._root)),this._debug.partitions.arr[o].end=this._io.pos;this._debug.partitions.end=this._io.pos};var _=n.Partition=(function(){function i(a,r,h){this._io=a,this._parent=r,this._root=h,this._debug={},this._read()}i.prototype._read=function(){this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=t.bytesToStr(t.bytesTerminate(this._io.readBytes(16),0,!1),"UTF-8"),this._debug.name.end=this._io.pos,this._debug.size={start:this._io.pos,ioOffset:this._io.byteOffset},this.size=this._io.readU8le(),this._debug.size.end=this._io.pos,this._debug.offset={start:this._io.pos,ioOffset:this._io.byteOffset},this.offset=this._io.readU8le(),this._debug.offset.end=this._io.pos,this._debug.flags={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_flags=this._io.readBytes(4);var a=new t(this._raw_flags);this.flags=new o(a,this,this._root),this._debug.flags.end=this._io.pos,this._debug.padding={start:this._io.pos,ioOffset:this._io.byteOffset},this.padding=this._io.readBytes(4),this._debug.padding.end=this._io.pos};var o=i.PartFlags=(function(){function a(r,h,f){this._io=r,this._parent=h,this._root=f,this._debug={},this._read()}return a.prototype._read=function(){this._debug.isCode={start:this._io.pos,ioOffset:this._io.byteOffset},this.isCode=this._io.readBitsIntLe(1)!=0,this._debug.isCode.end=this._io.pos,this._debug.isCache={start:this._io.pos,ioOffset:this._io.byteOffset},this.isCache=this._io.readBitsIntLe(1)!=0,this._debug.isCache.end=this._io.pos,this._debug.isData={start:this._io.pos,ioOffset:this._io.byteOffset},this.isData=this._io.readBitsIntLe(1)!=0,this._debug.isData.end=this._io.pos},a})();return i})();return n})();e.AmlogicEmmcPartitions=d})}});const b=m(),g={id:"amlogic_emmc_partitions",title:"Amlogic proprietary eMMC partition table",ksy:{meta:{id:"amlogic_emmc_partitions",title:"Amlogic proprietary eMMC partition table",license:"CC0-1.0","ks-version":.9,encoding:"UTF-8",endian:"le","bit-endian":"le"},doc:`This is an unnamed and undocumented partition table format implemented by
the bootloader and kernel that Amlogic provides for their Linux SoCs (Meson
series at least, and probably others). They appear to use this rather than GPT,
the industry standard, because their BootROM loads and executes the next stage
loader from offset 512 (0x200) on the eMMC, which is exactly where the GPT
header would have to start. So instead of changing their BootROM, Amlogic
devised this partition table, which lives at an offset of 36MiB (0x240_0000)
on the eMMC and so doesn't conflict. This parser expects as input just the
partition table from that offset. The maximum number of partitions in a table
is 32, which corresponds to a maximum table size of 1304 bytes (0x518).
`,"doc-ref":["http://aml-code.amlogic.com/kernel/common.git/tree/include/linux/mmc/emmc_partitions.h?id=18a4a87072ababf76ea08c8539e939b5b8a440ef","http://aml-code.amlogic.com/kernel/common.git/tree/drivers/amlogic/mmc/emmc_partitions.c?id=18a4a87072ababf76ea08c8539e939b5b8a440ef"],seq:[{id:"magic",contents:["MPT",0]},{id:"version",size:12,type:"strz"},{id:"num_partitions","-orig-id":"part_num",type:"s4",valid:{min:1,max:32}},{id:"checksum",type:"u4",doc:`To calculate this, treat the first (and only the first) partition
descriptor in the table below as an array of unsigned little-endian
32-bit integers. Sum all those integers mod 2^32, then multiply the
result by the total number of partitions, also mod 2^32. Amlogic
likely meant to include all the partition descriptors in the sum,
but their code as written instead repeatedly loops over the first
one, once for each partition in the table.
`},{id:"partitions",type:"partition",repeat:"expr","repeat-expr":"num_partitions"}],types:{partition:{seq:[{id:"name",size:16,type:"strz"},{id:"size",type:"u8"},{id:"offset",type:"u8",doc:`The start of the partition relative to the start of the eMMC, in bytes
`},{id:"flags",size:4,type:"part_flags"},{id:"padding",size:4}],types:{part_flags:{seq:[{id:"is_code","-orig-id":"STORE_CODE",type:"b1"},{id:"is_cache","-orig-id":"STORE_CACHE",type:"b1"},{id:"is_data","-orig-id":"STORE_DATA",type:"b1"}]}}}}}};export{b as default,g as spec};
