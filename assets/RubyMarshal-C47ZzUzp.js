import{k as g}from"./index-C9sUxlHS.js";var v=Object.getOwnPropertyNames,O=(a,r)=>function(){return r||(0,a[v(a)[0]])((r={exports:{}}).exports,r),r.exports},R=O({"<stdin>"(a){(function(r,h){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],h):typeof a=="object"&&a!==null&&typeof a.nodeType!="number"?h(a,g.KaitaiStream):h(r.RubyMarshal||(r.RubyMarshal={}),r.KaitaiStream)})(typeof self<"u"?self:a,function(r,h){var u=(function(){s.Codes=Object.freeze({RUBY_STRING:34,CONST_NIL:48,RUBY_SYMBOL:58,RUBY_SYMBOL_LINK:59,RUBY_OBJECT_LINK:64,CONST_FALSE:70,INSTANCE_VAR:73,RUBY_STRUCT:83,CONST_TRUE:84,RUBY_ARRAY:91,PACKED_INT:105,BIGNUM:108,RUBY_HASH:123,34:"RUBY_STRING",48:"CONST_NIL",58:"RUBY_SYMBOL",59:"RUBY_SYMBOL_LINK",64:"RUBY_OBJECT_LINK",70:"CONST_FALSE",73:"INSTANCE_VAR",83:"RUBY_STRUCT",84:"CONST_TRUE",91:"RUBY_ARRAY",105:"PACKED_INT",108:"BIGNUM",123:"RUBY_HASH"});function s(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._debug={},this._read()}s.prototype._read=function(){if(this._debug.version={start:this._io.pos,ioOffset:this._io.byteOffset},this.version=this._io.readBytes(2),this._debug.version.end=this._io.pos,h.byteArrayCompare(this.version,new Uint8Array([4,8]))!=0){var t=new h.ValidationNotEqualError(new Uint8Array([4,8]),this.version,this._io,"/seq/0");throw this._debug.version.validationError=t,t}this._debug.records={start:this._io.pos,ioOffset:this._io.byteOffset},this.records=new d(this._io,this,this._root),this._debug.records.end=this._io.pos};var c=s.Bignum=(function(){function t(e,i,o){this._io=e,this._parent=i,this._root=o,this._debug={},this._read()}return t.prototype._read=function(){this._debug.sign={start:this._io.pos,ioOffset:this._io.byteOffset},this.sign=this._io.readU1(),this._debug.sign.end=this._io.pos,this._debug.lenDiv2={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenDiv2=new n(this._io,this,this._root),this._debug.lenDiv2.end=this._io.pos,this._debug.body={start:this._io.pos,ioOffset:this._io.byteOffset},this.body=this._io.readBytes(this.lenDiv2.value*2),this._debug.body.end=this._io.pos},t})(),b=s.InstanceVar=(function(){function t(e,i,o){this._io=e,this._parent=i,this._root=o,this._debug={},this._read()}return t.prototype._read=function(){this._debug.obj={start:this._io.pos,ioOffset:this._io.byteOffset},this.obj=new d(this._io,this,this._root),this._debug.obj.end=this._io.pos,this._debug.numVars={start:this._io.pos,ioOffset:this._io.byteOffset},this.numVars=new n(this._io,this,this._root),this._debug.numVars.end=this._io.pos,this._debug.vars={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.vars.arr=[],this.vars=[];for(var e=0;e<this.numVars.value;e++)this._debug.vars.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.vars.push(new _(this._io,this,this._root)),this._debug.vars.arr[e].end=this._io.pos;this._debug.vars.end=this._io.pos},t})(),n=s.PackedInt=(function(){function t(e,i,o){this._io=e,this._parent=i,this._root=o,this._debug={},this._read()}return t.prototype._read=function(){switch(this._debug.code={start:this._io.pos,ioOffset:this._io.byteOffset},this.code=this._io.readU1(),this._debug.code.end=this._io.pos,this._debug.encoded={start:this._io.pos,ioOffset:this._io.byteOffset},this.code){case 1:this.encoded=this._io.readU1();break;case 2:this.encoded=this._io.readU2le();break;case 252:this.encoded=this._io.readU4le();break;case 253:this.encoded=this._io.readU2le();break;case 254:this.encoded=this._io.readU2le();break;case 255:this.encoded=this._io.readU1();break;case 3:this.encoded=this._io.readU2le();break;case 4:this.encoded=this._io.readU4le();break}switch(this._debug.encoded.end=this._io.pos,this._debug.encoded2={start:this._io.pos,ioOffset:this._io.byteOffset},this.code){case 253:this.encoded2=this._io.readU1();break;case 3:this.encoded2=this._io.readU1();break}this._debug.encoded2.end=this._io.pos},Object.defineProperty(t.prototype,"isImmediate",{get:function(){return this._m_isImmediate!==void 0?this._m_isImmediate:(this._debug._m_isImmediate={},this._m_isImmediate=this.code>4&&this.code<252,this._m_isImmediate)}}),Object.defineProperty(t.prototype,"value",{get:function(){return this._m_value!==void 0?this._m_value:(this._debug._m_value={},this._m_value=this.isImmediate?this.code<128?this.code-5:4-(~this.code&127):this.code==0?0:this.code==255?this.encoded-256:this.code==254?this.encoded-65536:this.code==253?(this.encoded2<<16|this.encoded)-16777216:this.code==3?this.encoded2<<16|this.encoded:this.encoded,this._m_value)}}),t})(),_=s.Pair=(function(){function t(e,i,o){this._io=e,this._parent=i,this._root=o,this._debug={},this._read()}return t.prototype._read=function(){this._debug.key={start:this._io.pos,ioOffset:this._io.byteOffset},this.key=new d(this._io,this,this._root),this._debug.key.end=this._io.pos,this._debug.value={start:this._io.pos,ioOffset:this._io.byteOffset},this.value=new d(this._io,this,this._root),this._debug.value.end=this._io.pos},t})(),d=s.Record=(function(){function t(e,i,o){this._io=e,this._parent=i,this._root=o,this._debug={},this._read()}return t.prototype._read=function(){switch(this._debug.code={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"RubyMarshal.Codes"},this.code=this._io.readU1(),this._debug.code.end=this._io.pos,this._debug.body={start:this._io.pos,ioOffset:this._io.byteOffset},this.code){case s.Codes.BIGNUM:this.body=new c(this._io,this,this._root);break;case s.Codes.INSTANCE_VAR:this.body=new b(this._io,this,this._root);break;case s.Codes.PACKED_INT:this.body=new n(this._io,this,this._root);break;case s.Codes.RUBY_ARRAY:this.body=new f(this._io,this,this._root);break;case s.Codes.RUBY_HASH:this.body=new y(this._io,this,this._root);break;case s.Codes.RUBY_OBJECT_LINK:this.body=new n(this._io,this,this._root);break;case s.Codes.RUBY_STRING:this.body=new p(this._io,this,this._root);break;case s.Codes.RUBY_STRUCT:this.body=new l(this._io,this,this._root);break;case s.Codes.RUBY_SYMBOL:this.body=new m(this._io,this,this._root);break;case s.Codes.RUBY_SYMBOL_LINK:this.body=new n(this._io,this,this._root);break}this._debug.body.end=this._io.pos},t})(),f=s.RubyArray=(function(){function t(e,i,o){this._io=e,this._parent=i,this._root=o,this._debug={},this._read()}return t.prototype._read=function(){this._debug.numElements={start:this._io.pos,ioOffset:this._io.byteOffset},this.numElements=new n(this._io,this,this._root),this._debug.numElements.end=this._io.pos,this._debug.elements={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.elements.arr=[],this.elements=[];for(var e=0;e<this.numElements.value;e++)this._debug.elements.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.elements.push(new d(this._io,this,this._root)),this._debug.elements.arr[e].end=this._io.pos;this._debug.elements.end=this._io.pos},t})(),y=s.RubyHash=(function(){function t(e,i,o){this._io=e,this._parent=i,this._root=o,this._debug={},this._read()}return t.prototype._read=function(){this._debug.numPairs={start:this._io.pos,ioOffset:this._io.byteOffset},this.numPairs=new n(this._io,this,this._root),this._debug.numPairs.end=this._io.pos,this._debug.pairs={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.pairs.arr=[],this.pairs=[];for(var e=0;e<this.numPairs.value;e++)this._debug.pairs.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.pairs.push(new _(this._io,this,this._root)),this._debug.pairs.arr[e].end=this._io.pos;this._debug.pairs.end=this._io.pos},t})(),p=s.RubyString=(function(){function t(e,i,o){this._io=e,this._parent=i,this._root=o,this._debug={},this._read()}return t.prototype._read=function(){this._debug.len={start:this._io.pos,ioOffset:this._io.byteOffset},this.len=new n(this._io,this,this._root),this._debug.len.end=this._io.pos,this._debug.body={start:this._io.pos,ioOffset:this._io.byteOffset},this.body=this._io.readBytes(this.len.value),this._debug.body.end=this._io.pos},t})(),l=s.RubyStruct=(function(){function t(e,i,o){this._io=e,this._parent=i,this._root=o,this._debug={},this._read()}return t.prototype._read=function(){this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=new d(this._io,this,this._root),this._debug.name.end=this._io.pos,this._debug.numMembers={start:this._io.pos,ioOffset:this._io.byteOffset},this.numMembers=new n(this._io,this,this._root),this._debug.numMembers.end=this._io.pos,this._debug.members={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.members.arr=[],this.members=[];for(var e=0;e<this.numMembers.value;e++)this._debug.members.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.members.push(new _(this._io,this,this._root)),this._debug.members.arr[e].end=this._io.pos;this._debug.members.end=this._io.pos},t})(),m=s.RubySymbol=(function(){function t(e,i,o){this._io=e,this._parent=i,this._root=o,this._debug={},this._read()}return t.prototype._read=function(){this._debug.len={start:this._io.pos,ioOffset:this._io.byteOffset},this.len=new n(this._io,this,this._root),this._debug.len.end=this._io.pos,this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=h.bytesToStr(this._io.readBytes(this.len.value),"UTF-8"),this._debug.name.end=this._io.pos},t})();return s})();r.RubyMarshal=u})}});const k=R(),x={id:"ruby_marshal",title:"ruby_marshal",ksy:{meta:{id:"ruby_marshal",license:"CC0-1.0",endian:"le"},doc:`Ruby's Marshal module allows serialization and deserialization of
many standard and arbitrary Ruby objects in a compact binary
format. It is relatively fast, available in stdlibs standard and
allows conservation of language-specific properties (such as symbols
or encoding-aware strings).

Feature-wise, it is comparable to other language-specific
implementations, such as:

* Java's
  [Serializable](https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html)
* .NET
  [BinaryFormatter](https://learn.microsoft.com/en-us/dotnet/api/system.runtime.serialization.formatters.binary.binaryformatter?view=net-7.0)
* Python's
  [marshal](https://docs.python.org/3/library/marshal.html),
  [pickle](https://docs.python.org/3/library/pickle.html) and
  [shelve](https://docs.python.org/3/library/shelve.html)

From internal perspective, serialized stream consists of a simple
magic header and a record.
`,"doc-ref":"https://docs.ruby-lang.org/en/2.4.0/marshal_rdoc.html#label-Stream+Format",seq:[{id:"version",contents:[4,8]},{id:"records",type:"record"}],types:{record:{doc:"Each record starts with a single byte that determines its type\n(`code`) and contents. If necessary, additional info as parsed\nas `body`, to be determined by `code`.\n",seq:[{id:"code",type:"u1",enum:"codes"},{id:"body",type:{"switch-on":"code",cases:{"codes::bignum":"bignum","codes::instance_var":"instance_var","codes::packed_int":"packed_int","codes::ruby_array":"ruby_array","codes::ruby_hash":"ruby_hash","codes::ruby_string":"ruby_string","codes::ruby_struct":"ruby_struct","codes::ruby_symbol":"ruby_symbol","codes::ruby_symbol_link":"packed_int","codes::ruby_object_link":"packed_int"}}}]},packed_int:{doc:`Ruby uses sophisticated system to pack integers: first \`code\`
byte either determines packing scheme or carries encoded
immediate value (thus allowing smaller values from -123 to 122
(inclusive) to take only one byte. There are 11 encoding schemes
in total:

* 0 is encoded specially (as 0)
* 1..122 are encoded as immediate value with a shift
* 123..255 are encoded with code of 0x01 and 1 extra byte
* 0x100..0xffff are encoded with code of 0x02 and 2 extra bytes
* 0x10000..0xffffff are encoded with code of 0x03 and 3 extra
  bytes
* 0x1000000..0xffffffff are encoded with code of 0x04 and 4
  extra bytes
* -123..-1 are encoded as immediate value with another shift
* -256..-124 are encoded with code of 0xff and 1 extra byte
* -0x10000..-257 are encoded with code of 0xfe and 2 extra bytes
* -0x1000000..0x10001 are encoded with code of 0xfd and 3 extra
   bytes
* -0x40000000..-0x1000001 are encoded with code of 0xfc and 4
   extra bytes

Values beyond that are serialized as bignum (even if they
technically might be not Bignum class in Ruby implementation,
i.e. if they fit into 64 bits on a 64-bit platform).
`,"doc-ref":"https://docs.ruby-lang.org/en/2.4.0/marshal_rdoc.html#label-Fixnum+and+long",seq:[{id:"code",type:"u1"},{id:"encoded",type:{"switch-on":"code",cases:{1:"u1",2:"u2",3:"u2",4:"u4",252:"u4",253:"u2",254:"u2",255:"u1"}}},{id:"encoded2",type:{"switch-on":"code",cases:{3:"u1",253:"u1"}},doc:"One extra byte for 3-byte integers (0x03 and 0xfd), as\nthere is no standard `u3` type in KS.\n"}],instances:{is_immediate:{value:"code > 4 and code < 0xfc"},value:{value:`is_immediate ? (code < 0x80 ? code - 5 : (4 - (~code & 0x7f))) : code == 0 ? 0 : code == 0xff ? (encoded - 0x100) : code == 0xfe ? (encoded - 0x10000) : code == 0xfd ? ((encoded2 << 16 | encoded) - 0x1000000) : code == 0x03 ? (encoded2 << 16 | encoded) : encoded
`}}},ruby_symbol:{"doc-ref":"https://docs.ruby-lang.org/en/2.4.0/marshal_rdoc.html#label-Symbols+and+Byte+Sequence",seq:[{id:"len",type:"packed_int"},{id:"name",size:"len.value",type:"str",encoding:"UTF-8"}]},ruby_string:{"doc-ref":"https://docs.ruby-lang.org/en/2.4.0/marshal_rdoc.html#label-String",seq:[{id:"len",type:"packed_int"},{id:"body",size:"len.value"}]},ruby_array:{seq:[{id:"num_elements",type:"packed_int"},{id:"elements",type:"record",repeat:"expr","repeat-expr":"num_elements.value"}]},ruby_hash:{"doc-ref":"https://docs.ruby-lang.org/en/2.4.0/marshal_rdoc.html#label-Hash+and+Hash+with+Default+Value",seq:[{id:"num_pairs",type:"packed_int"},{id:"pairs",type:"pair",repeat:"expr","repeat-expr":"num_pairs.value"}]},bignum:{"doc-ref":"https://docs.ruby-lang.org/en/2.4.0/marshal_rdoc.html#label-Bignum",seq:[{id:"sign",type:"u1",doc:"A single byte containing `+` for a positive value or `-` for a negative value."},{id:"len_div_2",type:"packed_int",doc:"Length of bignum body, divided by 2."},{id:"body",size:"len_div_2.value * 2",doc:"Bytes that represent the number, see ruby-lang.org docs for reconstruction algorithm."}]},ruby_struct:{"doc-ref":"https://docs.ruby-lang.org/en/2.4.0/marshal_rdoc.html#label-Struct",seq:[{id:"name",type:"record",doc:"Symbol containing the name of the struct."},{id:"num_members",type:"packed_int",doc:"Number of members in a struct"},{id:"members",type:"pair",repeat:"expr","repeat-expr":"num_members.value"}]},instance_var:{"doc-ref":"https://docs.ruby-lang.org/en/2.4.0/marshal_rdoc.html#label-Instance+Variables",seq:[{id:"obj",type:"record"},{id:"num_vars",type:"packed_int"},{id:"vars",type:"pair",repeat:"expr","repeat-expr":"num_vars.value"}]},pair:{seq:[{id:"key",type:"record"},{id:"value",type:"record"}]}},enums:{codes:{34:"ruby_string",48:"const_nil",58:"ruby_symbol",59:"ruby_symbol_link",64:"ruby_object_link",70:"const_false",73:"instance_var",83:"ruby_struct",84:"const_true",91:"ruby_array",105:"packed_int",108:"bignum",123:"ruby_hash"}}}};export{k as default,x as spec};
