import{k as B}from"./index-COA_x_BK.js";var P=Object.getOwnPropertyNames,M=(a,n)=>function(){return n||(0,a[P(a)[0]])((n={exports:{}}).exports,n),n.exports},w=M({"<stdin>"(a){(function(n,r){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],r):typeof a=="object"&&a!==null&&typeof a.nodeType!="number"?r(a,B.KaitaiStream):r(n.Bmp||(n.Bmp={}),n.KaitaiStream)})(typeof self<"u"?self:a,function(n,r){var l=(function(){t.ColorSpace=Object.freeze({CALIBRATED_RGB:0,PROFILE_LINKED:1279872587,PROFILE_EMBEDDED:1296188740,WINDOWS:1466527264,S_RGB:1934772034,0:"CALIBRATED_RGB",1279872587:"PROFILE_LINKED",1296188740:"PROFILE_EMBEDDED",1466527264:"WINDOWS",1934772034:"S_RGB"}),t.Compressions=Object.freeze({RGB:0,RLE8:1,RLE4:2,BITFIELDS:3,JPEG:4,PNG:5,ALPHA_BITFIELDS:6,0:"RGB",1:"RLE8",2:"RLE4",3:"BITFIELDS",4:"JPEG",5:"PNG",6:"ALPHA_BITFIELDS"}),t.HeaderType=Object.freeze({BITMAP_CORE_HEADER:12,BITMAP_INFO_HEADER:40,BITMAP_V2_INFO_HEADER:52,BITMAP_V3_INFO_HEADER:56,OS2_2X_BITMAP_HEADER:64,BITMAP_V4_HEADER:108,BITMAP_V5_HEADER:124,12:"BITMAP_CORE_HEADER",40:"BITMAP_INFO_HEADER",52:"BITMAP_V2_INFO_HEADER",56:"BITMAP_V3_INFO_HEADER",64:"OS2_2X_BITMAP_HEADER",108:"BITMAP_V4_HEADER",124:"BITMAP_V5_HEADER"}),t.Intent=Object.freeze({BUSINESS:1,GRAPHICS:2,IMAGES:4,ABS_COLORIMETRIC:8,1:"BUSINESS",2:"GRAPHICS",4:"IMAGES",8:"ABS_COLORIMETRIC"}),t.Os2Compressions=Object.freeze({RGB:0,RLE8:1,RLE4:2,HUFFMAN_1D:3,RLE24:4,0:"RGB",1:"RLE8",2:"RLE4",3:"HUFFMAN_1D",4:"RLE24"}),t.Os2Rendering=Object.freeze({NO_HALFTONING:0,ERROR_DIFFUSION:1,PANDA:2,SUPER_CIRCLE:3,0:"NO_HALFTONING",1:"ERROR_DIFFUSION",2:"PANDA",3:"SUPER_CIRCLE"});function t(e,i,s){this._io=e,this._parent=i,this._root=s||this,this._debug={},this._read()}t.prototype._read=function(){this._debug.fileHdr={start:this._io.pos,ioOffset:this._io.byteOffset},this.fileHdr=new O(this._io,this,this._root),this._debug.fileHdr.end=this._io.pos,this._debug.dibInfo={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_dibInfo=this._io.readBytes(this.fileHdr.ofsBitmap-14);var e=new r(this._raw_dibInfo);this.dibInfo=new b(e,this,this._root),this._debug.dibInfo.end=this._io.pos,this._debug.bitmap={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_bitmap=this._io.readBytesFull();var i=new r(this._raw_bitmap);this.bitmap=new m(i,this,this._root),this._debug.bitmap.end=this._io.pos};var m=t.Bitmap=(function(){function e(i,s,o){this._io=i,this._parent=s,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){},e})(),u=t.BitmapHeader=(function(){function e(i,s,o,_){this._io=i,this._parent=s,this._root=o,this.lenHeader=_,this._debug={},this._read()}return e.prototype._read=function(){switch(this._debug.imageWidth={start:this._io.pos,ioOffset:this._io.byteOffset},this.isCoreHeader){case!1:this.imageWidth=this._io.readU4le();break;case!0:this.imageWidth=this._io.readU2le();break}switch(this._debug.imageWidth.end=this._io.pos,this._debug.imageHeightRaw={start:this._io.pos,ioOffset:this._io.byteOffset},this.isCoreHeader){case!1:this.imageHeightRaw=this._io.readS4le();break;case!0:this.imageHeightRaw=this._io.readS2le();break}this._debug.imageHeightRaw.end=this._io.pos,this._debug.numPlanes={start:this._io.pos,ioOffset:this._io.byteOffset},this.numPlanes=this._io.readU2le(),this._debug.numPlanes.end=this._io.pos,this._debug.bitsPerPixel={start:this._io.pos,ioOffset:this._io.byteOffset},this.bitsPerPixel=this._io.readU2le(),this._debug.bitsPerPixel.end=this._io.pos,this.extendsBitmapInfo&&(this._debug.bitmapInfoExt={start:this._io.pos,ioOffset:this._io.byteOffset},this.bitmapInfoExt=new c(this._io,this,this._root),this._debug.bitmapInfoExt.end=this._io.pos),this.isColorMaskHere&&(this._debug.colorMask={start:this._io.pos,ioOffset:this._io.byteOffset},this.colorMask=new f(this._io,this,this._root,this.lenHeader!=t.HeaderType.BITMAP_V2_INFO_HEADER),this._debug.colorMask.end=this._io.pos),this.extendsOs22xBitmap&&(this._debug.os22xBitmapExt={start:this._io.pos,ioOffset:this._io.byteOffset},this.os22xBitmapExt=new v(this._io,this,this._root),this._debug.os22xBitmapExt.end=this._io.pos),this.extendsBitmapV4&&(this._debug.bitmapV4Ext={start:this._io.pos,ioOffset:this._io.byteOffset},this.bitmapV4Ext=new g(this._io,this,this._root),this._debug.bitmapV4Ext.end=this._io.pos),this.extendsBitmapV5&&(this._debug.bitmapV5Ext={start:this._io.pos,ioOffset:this._io.byteOffset},this.bitmapV5Ext=new y(this._io,this,this._root),this._debug.bitmapV5Ext.end=this._io.pos)},Object.defineProperty(e.prototype,"bottomUp",{get:function(){return this._m_bottomUp!==void 0?this._m_bottomUp:(this._debug._m_bottomUp={},this._m_bottomUp=this.imageHeightRaw>0,this._m_bottomUp)}}),Object.defineProperty(e.prototype,"extendsBitmapInfo",{get:function(){return this._m_extendsBitmapInfo!==void 0?this._m_extendsBitmapInfo:(this._debug._m_extendsBitmapInfo={},this._m_extendsBitmapInfo=this.lenHeader>=t.HeaderType.BITMAP_INFO_HEADER,this._m_extendsBitmapInfo)}}),Object.defineProperty(e.prototype,"extendsBitmapV4",{get:function(){return this._m_extendsBitmapV4!==void 0?this._m_extendsBitmapV4:(this._debug._m_extendsBitmapV4={},this._m_extendsBitmapV4=this.lenHeader>=t.HeaderType.BITMAP_V4_HEADER,this._m_extendsBitmapV4)}}),Object.defineProperty(e.prototype,"extendsBitmapV5",{get:function(){return this._m_extendsBitmapV5!==void 0?this._m_extendsBitmapV5:(this._debug._m_extendsBitmapV5={},this._m_extendsBitmapV5=this.lenHeader>=t.HeaderType.BITMAP_V5_HEADER,this._m_extendsBitmapV5)}}),Object.defineProperty(e.prototype,"extendsOs22xBitmap",{get:function(){return this._m_extendsOs22xBitmap!==void 0?this._m_extendsOs22xBitmap:(this._debug._m_extendsOs22xBitmap={},this._m_extendsOs22xBitmap=this.lenHeader==t.HeaderType.OS2_2X_BITMAP_HEADER,this._m_extendsOs22xBitmap)}}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._m_imageHeight!==void 0?this._m_imageHeight:(this._debug._m_imageHeight={},this._m_imageHeight=this.imageHeightRaw<0?-this.imageHeightRaw:this.imageHeightRaw,this._m_imageHeight)}}),Object.defineProperty(e.prototype,"isColorMaskHere",{get:function(){return this._m_isColorMaskHere!==void 0?this._m_isColorMaskHere:(this._debug._m_isColorMaskHere={},this._m_isColorMaskHere=this.lenHeader==t.HeaderType.BITMAP_V2_INFO_HEADER||this.lenHeader==t.HeaderType.BITMAP_V3_INFO_HEADER||this.extendsBitmapV4,this._m_isColorMaskHere)}}),Object.defineProperty(e.prototype,"isCoreHeader",{get:function(){return this._m_isCoreHeader!==void 0?this._m_isCoreHeader:(this._debug._m_isCoreHeader={},this._m_isCoreHeader=this.lenHeader==t.HeaderType.BITMAP_CORE_HEADER,this._m_isCoreHeader)}}),Object.defineProperty(e.prototype,"usesFixedPalette",{get:function(){return this._m_usesFixedPalette!==void 0?this._m_usesFixedPalette:(this._debug._m_usesFixedPalette={},this._m_usesFixedPalette=!(this.bitsPerPixel==16||this.bitsPerPixel==24||this.bitsPerPixel==32)&&!(this.extendsBitmapInfo&&!this.extendsOs22xBitmap&&(this.bitmapInfoExt.compression==t.Compressions.JPEG||this.bitmapInfoExt.compression==t.Compressions.PNG)),this._m_usesFixedPalette)}}),e})(),b=t.BitmapInfo=(function(){function e(i,s,o){this._io=i,this._parent=s,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.lenHeader={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenHeader=this._io.readU4le(),this._debug.lenHeader.end=this._io.pos,this._debug.header={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_header=this._io.readBytes(this.lenHeader-4);var i=new r(this._raw_header);if(this.header=new u(i,this,this._root,this.lenHeader),this._debug.header.end=this._io.pos,this.isColorMaskHere&&(this._debug.colorMask={start:this._io.pos,ioOffset:this._io.byteOffset},this.colorMask=new f(this._io,this,this._root,this.header.bitmapInfoExt.compression==t.Compressions.ALPHA_BITFIELDS),this._debug.colorMask.end=this._io.pos),!this._io.isEof()){this._debug.colorTable={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_colorTable=this._io.readBytesFull();var s=new r(this._raw_colorTable);this.colorTable=new E(s,this,this._root,!this.header.isCoreHeader,this.header.extendsBitmapInfo?this.header.bitmapInfoExt.numColorsUsed:0),this._debug.colorTable.end=this._io.pos}},Object.defineProperty(e.prototype,"colorMaskAlpha",{get:function(){return this._m_colorMaskAlpha!==void 0?this._m_colorMaskAlpha:(this._debug._m_colorMaskAlpha={},this._m_colorMaskAlpha=this.isColorMaskGiven&&this.colorMaskGiven.hasAlphaMask?this.colorMaskGiven.alphaMask:0,this._m_colorMaskAlpha)}}),Object.defineProperty(e.prototype,"colorMaskBlue",{get:function(){return this._m_colorMaskBlue!==void 0?this._m_colorMaskBlue:(this._debug._m_colorMaskBlue={},this._m_colorMaskBlue=this.isColorMaskGiven?this.colorMaskGiven.blueMask:this.header.bitsPerPixel==16?31:this.header.bitsPerPixel==24||this.header.bitsPerPixel==32?255:0,this._m_colorMaskBlue)}}),Object.defineProperty(e.prototype,"colorMaskGiven",{get:function(){return this._m_colorMaskGiven!==void 0?this._m_colorMaskGiven:(this.isColorMaskGiven&&(this._debug._m_colorMaskGiven={},this._m_colorMaskGiven=this.isColorMaskHere?this.colorMask:this.header.colorMask),this._m_colorMaskGiven)}}),Object.defineProperty(e.prototype,"colorMaskGreen",{get:function(){return this._m_colorMaskGreen!==void 0?this._m_colorMaskGreen:(this._debug._m_colorMaskGreen={},this._m_colorMaskGreen=this.isColorMaskGiven?this.colorMaskGiven.greenMask:this.header.bitsPerPixel==16?992:this.header.bitsPerPixel==24||this.header.bitsPerPixel==32?65280:0,this._m_colorMaskGreen)}}),Object.defineProperty(e.prototype,"colorMaskRed",{get:function(){return this._m_colorMaskRed!==void 0?this._m_colorMaskRed:(this._debug._m_colorMaskRed={},this._m_colorMaskRed=this.isColorMaskGiven?this.colorMaskGiven.redMask:this.header.bitsPerPixel==16?31744:this.header.bitsPerPixel==24||this.header.bitsPerPixel==32?16711680:0,this._m_colorMaskRed)}}),Object.defineProperty(e.prototype,"isColorMaskGiven",{get:function(){return this._m_isColorMaskGiven!==void 0?this._m_isColorMaskGiven:(this._debug._m_isColorMaskGiven={},this._m_isColorMaskGiven=this.header.extendsBitmapInfo&&(this.header.bitmapInfoExt.compression==t.Compressions.BITFIELDS||this.header.bitmapInfoExt.compression==t.Compressions.ALPHA_BITFIELDS)&&(this.isColorMaskHere||this.header.isColorMaskHere),this._m_isColorMaskGiven)}}),Object.defineProperty(e.prototype,"isColorMaskHere",{get:function(){return this._m_isColorMaskHere!==void 0?this._m_isColorMaskHere:(this._debug._m_isColorMaskHere={},this._m_isColorMaskHere=!this._io.isEof()&&this.header.lenHeader==t.HeaderType.BITMAP_INFO_HEADER&&(this.header.bitmapInfoExt.compression==t.Compressions.BITFIELDS||this.header.bitmapInfoExt.compression==t.Compressions.ALPHA_BITFIELDS),this._m_isColorMaskHere)}}),e})(),c=t.BitmapInfoExtension=(function(){function e(i,s,o){this._io=i,this._parent=s,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._parent.extendsOs22xBitmap||(this._debug.compression={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"Bmp.Compressions"},this.compression=this._io.readU4le(),this._debug.compression.end=this._io.pos),this._parent.extendsOs22xBitmap&&(this._debug.os2Compression={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"Bmp.Os2Compressions"},this.os2Compression=this._io.readU4le(),this._debug.os2Compression.end=this._io.pos),this._debug.lenImage={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenImage=this._io.readU4le(),this._debug.lenImage.end=this._io.pos,this._debug.xResolution={start:this._io.pos,ioOffset:this._io.byteOffset},this.xResolution=this._io.readU4le(),this._debug.xResolution.end=this._io.pos,this._debug.yResolution={start:this._io.pos,ioOffset:this._io.byteOffset},this.yResolution=this._io.readU4le(),this._debug.yResolution.end=this._io.pos,this._debug.numColorsUsed={start:this._io.pos,ioOffset:this._io.byteOffset},this.numColorsUsed=this._io.readU4le(),this._debug.numColorsUsed.end=this._io.pos,this._debug.numColorsImportant={start:this._io.pos,ioOffset:this._io.byteOffset},this.numColorsImportant=this._io.readU4le(),this._debug.numColorsImportant.end=this._io.pos},e})(),g=t.BitmapV4Extension=(function(){function e(i,s,o){this._io=i,this._parent=s,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.colorSpaceType={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"Bmp.ColorSpace"},this.colorSpaceType=this._io.readU4le(),this._debug.colorSpaceType.end=this._io.pos,this._debug.endpointRed={start:this._io.pos,ioOffset:this._io.byteOffset},this.endpointRed=new h(this._io,this,this._root),this._debug.endpointRed.end=this._io.pos,this._debug.endpointGreen={start:this._io.pos,ioOffset:this._io.byteOffset},this.endpointGreen=new h(this._io,this,this._root),this._debug.endpointGreen.end=this._io.pos,this._debug.endpointBlue={start:this._io.pos,ioOffset:this._io.byteOffset},this.endpointBlue=new h(this._io,this,this._root),this._debug.endpointBlue.end=this._io.pos,this._debug.gammaRed={start:this._io.pos,ioOffset:this._io.byteOffset},this.gammaRed=new d(this._io,this,this._root),this._debug.gammaRed.end=this._io.pos,this._debug.gammaBlue={start:this._io.pos,ioOffset:this._io.byteOffset},this.gammaBlue=new d(this._io,this,this._root),this._debug.gammaBlue.end=this._io.pos,this._debug.gammaGreen={start:this._io.pos,ioOffset:this._io.byteOffset},this.gammaGreen=new d(this._io,this,this._root),this._debug.gammaGreen.end=this._io.pos},e})(),y=t.BitmapV5Extension=(function(){function e(i,s,o){this._io=i,this._parent=s,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.intent={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"Bmp.Intent"},this.intent=this._io.readU4le(),this._debug.intent.end=this._io.pos,this._debug.ofsProfile={start:this._io.pos,ioOffset:this._io.byteOffset},this.ofsProfile=this._io.readU4le(),this._debug.ofsProfile.end=this._io.pos,this._debug.lenProfile={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenProfile=this._io.readU4le(),this._debug.lenProfile.end=this._io.pos,this._debug.reserved={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved=this._io.readU4le(),this._debug.reserved.end=this._io.pos},Object.defineProperty(e.prototype,"hasProfile",{get:function(){return this._m_hasProfile!==void 0?this._m_hasProfile:(this._debug._m_hasProfile={},this._m_hasProfile=this._parent.bitmapV4Ext.colorSpaceType==t.ColorSpace.PROFILE_LINKED||this._parent.bitmapV4Ext.colorSpaceType==t.ColorSpace.PROFILE_EMBEDDED,this._m_hasProfile)}}),Object.defineProperty(e.prototype,"profileData",{get:function(){if(this._m_profileData!==void 0)return this._m_profileData;if(this.hasProfile){var i=this._root._io,s=i.pos;switch(i.seek(14+this.ofsProfile),this._debug._m_profileData={start:i.pos,ioOffset:i.byteOffset},this._parent.bitmapV4Ext.colorSpaceType==t.ColorSpace.PROFILE_LINKED){case!0:this._m_profileData=r.bytesToStr(r.bytesTerminate(i.readBytes(this.lenProfile),0,!1),"windows-1252");break;default:this._m_profileData=i.readBytes(this.lenProfile);break}this._debug._m_profileData.end=i.pos,i.seek(s)}return this._m_profileData}}),e})(),h=t.CieXyz=(function(){function e(i,s,o){this._io=i,this._parent=s,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.x={start:this._io.pos,ioOffset:this._io.byteOffset},this.x=new p(this._io,this,this._root),this._debug.x.end=this._io.pos,this._debug.y={start:this._io.pos,ioOffset:this._io.byteOffset},this.y=new p(this._io,this,this._root),this._debug.y.end=this._io.pos,this._debug.z={start:this._io.pos,ioOffset:this._io.byteOffset},this.z=new p(this._io,this,this._root),this._debug.z.end=this._io.pos},e})(),f=t.ColorMask=(function(){function e(i,s,o,_){this._io=i,this._parent=s,this._root=o,this.hasAlphaMask=_,this._debug={},this._read()}return e.prototype._read=function(){this._debug.redMask={start:this._io.pos,ioOffset:this._io.byteOffset},this.redMask=this._io.readU4le(),this._debug.redMask.end=this._io.pos,this._debug.greenMask={start:this._io.pos,ioOffset:this._io.byteOffset},this.greenMask=this._io.readU4le(),this._debug.greenMask.end=this._io.pos,this._debug.blueMask={start:this._io.pos,ioOffset:this._io.byteOffset},this.blueMask=this._io.readU4le(),this._debug.blueMask.end=this._io.pos,this.hasAlphaMask&&(this._debug.alphaMask={start:this._io.pos,ioOffset:this._io.byteOffset},this.alphaMask=this._io.readU4le(),this._debug.alphaMask.end=this._io.pos)},e})(),E=t.ColorTable=(function(){function e(i,s,o,_,I){this._io=i,this._parent=s,this._root=o,this.hasReservedField=_,this.numColors=I,this._debug={},this._read()}return e.prototype._read=function(){this._debug.colors={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.colors.arr=[],this.colors=[];for(var i=0;i<(this.numColors>0&&this.numColors<this.numColorsPresent?this.numColors:this.numColorsPresent);i++)this._debug.colors.arr[i]={start:this._io.pos,ioOffset:this._io.byteOffset},this.colors.push(new x(this._io,this,this._root,this.hasReservedField)),this._debug.colors.arr[i].end=this._io.pos;this._debug.colors.end=this._io.pos},Object.defineProperty(e.prototype,"numColorsPresent",{get:function(){return this._m_numColorsPresent!==void 0?this._m_numColorsPresent:(this._debug._m_numColorsPresent={},this._m_numColorsPresent=Math.floor(this._io.size/(this.hasReservedField?4:3)),this._m_numColorsPresent)}}),e})(),O=t.FileHeader=(function(){function e(i,s,o){this._io=i,this._parent=s,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){if(this._debug.fileType={start:this._io.pos,ioOffset:this._io.byteOffset},this.fileType=this._io.readBytes(2),this._debug.fileType.end=this._io.pos,r.byteArrayCompare(this.fileType,new Uint8Array([66,77]))!=0){var i=new r.ValidationNotEqualError(new Uint8Array([66,77]),this.fileType,this._io,"/types/file_header/seq/0");throw this._debug.fileType.validationError=i,i}this._debug.lenFile={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenFile=this._io.readU4le(),this._debug.lenFile.end=this._io.pos,this._debug.reserved1={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved1=this._io.readU2le(),this._debug.reserved1.end=this._io.pos,this._debug.reserved2={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved2=this._io.readU2le(),this._debug.reserved2.end=this._io.pos,this._debug.ofsBitmap={start:this._io.pos,ioOffset:this._io.byteOffset},this.ofsBitmap=this._io.readS4le(),this._debug.ofsBitmap.end=this._io.pos},e})(),d=t.FixedPoint16Dot16=(function(){function e(i,s,o){this._io=i,this._parent=s,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.raw={start:this._io.pos,ioOffset:this._io.byteOffset},this.raw=this._io.readU4le(),this._debug.raw.end=this._io.pos},Object.defineProperty(e.prototype,"value",{get:function(){return this._m_value!==void 0?this._m_value:(this._debug._m_value={},this._m_value=(this.raw+0)/65536,this._m_value)}}),e})(),p=t.FixedPoint2Dot30=(function(){function e(i,s,o){this._io=i,this._parent=s,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.raw={start:this._io.pos,ioOffset:this._io.byteOffset},this.raw=this._io.readU4le(),this._debug.raw.end=this._io.pos},Object.defineProperty(e.prototype,"value",{get:function(){return this._m_value!==void 0?this._m_value:(this._debug._m_value={},this._m_value=(this.raw+0)/(1<<30),this._m_value)}}),e})(),v=t.Os22xBitmapExtension=(function(){function e(i,s,o){this._io=i,this._parent=s,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.units={start:this._io.pos,ioOffset:this._io.byteOffset},this.units=this._io.readU2le(),this._debug.units.end=this._io.pos,this._debug.reserved={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved=this._io.readU2le(),this._debug.reserved.end=this._io.pos,this._debug.recording={start:this._io.pos,ioOffset:this._io.byteOffset},this.recording=this._io.readU2le(),this._debug.recording.end=this._io.pos,this._debug.rendering={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"Bmp.Os2Rendering"},this.rendering=this._io.readU2le(),this._debug.rendering.end=this._io.pos,this._debug.size1={start:this._io.pos,ioOffset:this._io.byteOffset},this.size1=this._io.readU4le(),this._debug.size1.end=this._io.pos,this._debug.size2={start:this._io.pos,ioOffset:this._io.byteOffset},this.size2=this._io.readU4le(),this._debug.size2.end=this._io.pos,this._debug.colorEncoding={start:this._io.pos,ioOffset:this._io.byteOffset},this.colorEncoding=this._io.readU4le(),this._debug.colorEncoding.end=this._io.pos,this._debug.identifier={start:this._io.pos,ioOffset:this._io.byteOffset},this.identifier=this._io.readU4le(),this._debug.identifier.end=this._io.pos},e})(),x=t.RgbRecord=(function(){function e(i,s,o,_){this._io=i,this._parent=s,this._root=o,this.hasReservedField=_,this._debug={},this._read()}return e.prototype._read=function(){this._debug.blue={start:this._io.pos,ioOffset:this._io.byteOffset},this.blue=this._io.readU1(),this._debug.blue.end=this._io.pos,this._debug.green={start:this._io.pos,ioOffset:this._io.byteOffset},this.green=this._io.readU1(),this._debug.green.end=this._io.pos,this._debug.red={start:this._io.pos,ioOffset:this._io.byteOffset},this.red=this._io.readU1(),this._debug.red.end=this._io.pos,this.hasReservedField&&(this._debug.reserved={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved=this._io.readU1(),this._debug.reserved.end=this._io.pos)},e})();return t})();n.Bmp=l})}});const R=w(),A={id:"bmp",title:"bmp",ksy:{meta:{id:"bmp","file-extension":"bmp",xref:{forensicswiki:"bmp",justsolve:"BMP",loc:"fdd000189",mime:"image/bmp",pronom:["fmt/114","fmt/115","fmt/116","fmt/117","fmt/118","fmt/119","x-fmt/25","x-fmt/270"],wikidata:"Q192869"},tags:["windows"],license:"CC0-1.0","ks-version":.9,endian:"le"},doc:`The **BMP file format**, also known as **bitmap image file** or **device independent
bitmap (DIB) file format** or simply a **bitmap**, is a raster graphics image file
format used to store bitmap digital images, independently of the display
device (such as a graphics adapter), especially on Microsoft Windows
and OS/2 operating systems.

## Samples

Great collection of various BMP sample files:
[**BMP Suite Image List**](
  http://entropymine.com/jason/bmpsuite/bmpsuite/html/bmpsuite.html
) (by Jason Summers)

If only there was such a comprehensive sample suite for every file format! It's like
a dream for every developer of any binary file format parser. It contains a lot of
different types and variations of BMP files, even the tricky ones, where it's not clear
from the specification how to deal with them (marked there as "**q**uestionable").

If you make a program which will be able to read all the "**g**ood" and "**q**uestionable"
BMP files and won't crash on the "**b**ad" ones, it will definitely have one of the most
extensive support of BMP files in the universe!

## BITMAPV2INFOHEADER and BITMAPV3INFOHEADER

A beneficial discussion on Adobe forum (archived):
[**Invalid BMP Format with Alpha channel**](
  https://web.archive.org/web/20150127132443/https://forums.adobe.com/message/3272950
)

In 2010, someone noticed that Photoshop generated BMP with an odd type of header. There wasn't
any documentation available for this header at the time (and still isn't).
However, Chris Cox (former Adobe employee) claimed that they hadn't invented any type
of proprietary header and everything they were writing was taken directly
from the Microsoft documentation.

It showed up that the unknown header was called BITMAPV3INFOHEADER.
Although Microsoft has apparently requested and verified the use of the header,
the documentation on MSDN has probably got lost and they have probably
forgotten about this type of header.

This is the only source I could find about these structures, so we couldn't rely
on it so much, but I think supporting them as a read-only format won't harm anything.
Due to the fact that it isn't documented anywhere else, most applications don't support it.

All Windows headers at once (including mentioned BITMAPV2INFOHEADER and BITMAPV3INFOHEADER):

![Bitmap headers overview](
  https://web.archive.org/web/20190527043845/https://forums.adobe.com/servlet/JiveServlet/showImage/2-3273299-47801/BMP_Headers.png
)

## Specs
 * [Bitmap Storage (Windows Dev Center)](
     https://learn.microsoft.com/en-us/windows/win32/gdi/bitmap-storage
   )
    * BITMAPFILEHEADER
    * BITMAPINFOHEADER
    * BITMAPV4HEADER
    * BITMAPV5HEADER
 * [OS/2 Bitmap File Format](
      https://www.fileformat.info/format/os2bmp/egff.htm
   )
    * BITMAPFILEHEADER (OS2BMPFILEHEADER)
    * BITMAPCOREHEADER (OS21XBITMAPHEADER)
    * OS22XBITMAPHEADER
 * [Microsoft Windows Bitmap](
      http://netghost.narod.ru/gff/graphics/summary/micbmp.htm
   )
    * BITMAPFILEHEADER (WINBMPFILEHEADER)
    * BITMAPCOREHEADER (WIN2XBITMAPHEADER)
    * BITMAPINFOHEADER (WINNTBITMAPHEADER)
    * BITMAPV4HEADER (WIN4XBITMAPHEADER)
`,seq:[{id:"file_hdr",type:"file_header"},{id:"dib_info",size:"file_hdr.ofs_bitmap - file_hdr._sizeof",type:"bitmap_info"},{id:"bitmap",type:"bitmap","size-eos":!0}],types:{bitmap:{doc:`Replace with an opaque type if you care about the pixels. You can look at
an example of a JavaScript implementation:
<https://github.com/generalmimon/bmptool/blob/master/src/Bitmap.js>

There is a proposal for adding bitmap data type to Kaitai Struct:
<https://github.com/kaitai-io/kaitai_struct/issues/188>
`},file_header:{"-orig-id":"BITMAPFILEHEADER","doc-ref":"https://learn.microsoft.com/en-us/windows/win32/api/wingdi/ns-wingdi-bitmapfileheader",seq:[{id:"file_type","-orig-id":"bfType",contents:"BM"},{id:"len_file","-orig-id":"bfSize",type:"u4",doc:"not reliable, mostly ignored by BMP decoders"},{id:"reserved1","-orig-id":"bfReserved1",type:"u2"},{id:"reserved2","-orig-id":"bfReserved2",type:"u2"},{id:"ofs_bitmap","-orig-id":"bfOffBits",type:"s4",doc:"Offset to actual raw pixel data of the image"}]},bitmap_info:{"-orig-id":"BITMAPINFO","doc-ref":"https://learn.microsoft.com/en-us/windows/win32/api/wingdi/ns-wingdi-bitmapinfo",seq:[{id:"len_header",type:"u4"},{id:"header","-orig-id":"bmciHeader",size:"len_header - len_header._sizeof",type:"bitmap_header(len_header)"},{id:"color_mask",type:"color_mask(header.bitmap_info_ext.compression == compressions::alpha_bitfields)",if:"is_color_mask_here",doc:"Valid only for BITMAPINFOHEADER, in all headers extending it the masks are contained in the header itself."},{id:"color_table","-orig-id":"bmciColors","size-eos":!0,type:"color_table(not header.is_core_header, header.extends_bitmap_info ? header.bitmap_info_ext.num_colors_used : 0)",if:"not _io.eof"}],instances:{is_color_mask_here:{value:"not _io.eof and header.len_header == header_type::bitmap_info_header.to_i and (header.bitmap_info_ext.compression == compressions::bitfields or header.bitmap_info_ext.compression == compressions::alpha_bitfields)"},is_color_mask_given:{value:"header.extends_bitmap_info and (header.bitmap_info_ext.compression == compressions::bitfields or header.bitmap_info_ext.compression == compressions::alpha_bitfields) and (is_color_mask_here or header.is_color_mask_here)"},color_mask_given:{value:`is_color_mask_here
  ? color_mask
  : header.color_mask`,if:"is_color_mask_given"},color_mask_red:{value:`is_color_mask_given
  ? color_mask_given.red_mask
  : header.bits_per_pixel == 16
    ? 0b11111_00000_00000
    : header.bits_per_pixel == 24 or header.bits_per_pixel == 32
      ? 0xff_00_00
      : 0`},color_mask_green:{value:`is_color_mask_given
  ? color_mask_given.green_mask
  : header.bits_per_pixel == 16
    ? 0b00000_11111_00000
    : header.bits_per_pixel == 24 or header.bits_per_pixel == 32
      ? 0x00_ff_00
      : 0`},color_mask_blue:{value:`is_color_mask_given
  ? color_mask_given.blue_mask
  : header.bits_per_pixel == 16
    ? 0b00000_00000_11111
    : header.bits_per_pixel == 24 or header.bits_per_pixel == 32
      ? 0x00_00_ff
      : 0`},color_mask_alpha:{value:`is_color_mask_given and color_mask_given.has_alpha_mask
  ? color_mask_given.alpha_mask
  : 0`}}},bitmap_header:{"-orig-id":["BITMAPCOREHEADER","OS21XBITMAPHEADER"],"doc-ref":["https://learn.microsoft.com/en-us/windows/win32/api/wingdi/ns-wingdi-bitmapcoreheader","https://www.fileformat.info/format/os2bmp/egff.htm#OS2BMP-DMYID.3.1"],params:[{id:"len_header",type:"u4"}],seq:[{id:"image_width","-orig-id":"biWidth",type:{"switch-on":"is_core_header",cases:{true:"u2",false:"u4"}},doc:"Image width, px"},{id:"image_height_raw","-orig-id":"biHeight",type:{"switch-on":"is_core_header",cases:{true:"s2",false:"s4"}},doc:"Image height, px (positive => bottom-up image, negative => top-down image)"},{id:"num_planes","-orig-id":"biPlanes",type:"u2",doc:"Number of planes for target device, must be 1"},{id:"bits_per_pixel","-orig-id":"biBitCount",type:"u2",doc:"Number of bits per pixel that image buffer uses (1, 4, 8, 16, 24 or 32)"},{id:"bitmap_info_ext",type:"bitmap_info_extension",if:"extends_bitmap_info"},{id:"color_mask",type:"color_mask(len_header != header_type::bitmap_v2_info_header.to_i)",if:"is_color_mask_here"},{id:"os2_2x_bitmap_ext",type:"os2_2x_bitmap_extension",if:"extends_os2_2x_bitmap"},{id:"bitmap_v4_ext",type:"bitmap_v4_extension",if:"extends_bitmap_v4"},{id:"bitmap_v5_ext",type:"bitmap_v5_extension",if:"extends_bitmap_v5"}],instances:{is_core_header:{value:"len_header == header_type::bitmap_core_header.to_i"},extends_bitmap_info:{value:"len_header >= header_type::bitmap_info_header.to_i"},extends_os2_2x_bitmap:{value:"len_header == header_type::os2_2x_bitmap_header.to_i"},extends_bitmap_v4:{value:"len_header >= header_type::bitmap_v4_header.to_i"},extends_bitmap_v5:{value:"len_header >= header_type::bitmap_v5_header.to_i"},image_height:{value:"image_height_raw < 0 ? -image_height_raw : image_height_raw"},bottom_up:{value:"image_height_raw > 0"},is_color_mask_here:{value:"len_header == header_type::bitmap_v2_info_header.to_i or len_header == header_type::bitmap_v3_info_header.to_i or extends_bitmap_v4"},uses_fixed_palette:{value:"not (bits_per_pixel == 16 or bits_per_pixel == 24 or bits_per_pixel == 32) and not (extends_bitmap_info and not extends_os2_2x_bitmap and (bitmap_info_ext.compression == compressions::jpeg or bitmap_info_ext.compression == compressions::png))"}}},bitmap_info_extension:{"-orig-id":"BITMAPINFOHEADER","doc-ref":"https://learn.microsoft.com/en-us/previous-versions/dd183376(v=vs.85)",seq:[{id:"compression","-orig-id":"biCompression",type:"u4",enum:"compressions",if:"not _parent.extends_os2_2x_bitmap"},{id:"os2_compression","-orig-id":"Compression",type:"u4",enum:"os2_compressions",if:"_parent.extends_os2_2x_bitmap"},{id:"len_image","-orig-id":"biSizeImage",type:"u4",doc:`If biCompression is BI_JPEG or BI_PNG, indicates the size of the JPEG or PNG image buffer.
This may be set to zero for BI_RGB bitmaps.
`},{id:"x_resolution","-orig-id":"biXPelsPerMeter",type:"u4"},{id:"y_resolution","-orig-id":"biYPelsPerMeter",type:"u4"},{id:"num_colors_used","-orig-id":"biClrUsed",type:"u4"},{id:"num_colors_important","-orig-id":"biClrImportant",type:"u4"}]},os2_2x_bitmap_extension:{"-orig-id":"OS22XBITMAPHEADER","doc-ref":"https://www.fileformat.info/format/os2bmp/egff.htm#OS2BMP-DMYID.3.2",seq:[{id:"units",type:"u2"},{id:"reserved",type:"u2"},{id:"recording",type:"u2",doc:`Specifies how the bitmap scan lines are stored.
The only valid value for this field is 0, indicating that the bitmap is
stored from left to right and from the bottom up.
`},{id:"rendering",type:"u2",enum:"os2_rendering",doc:"Specifies the halftoning algorithm used on the bitmap data."},{id:"size1",type:"u4",doc:`rendering == os2_rendering::error_diffusion
  => error damping as a percentage in the range 0 through 100
rendering == os2_rendering::panda or rendering == os2_rendering::super_circle
  => X dimension of the pattern used in pixels
`},{id:"size2",type:"u4",doc:`rendering == os2_rendering::error_diffusion
  => not used
rendering == os2_rendering::panda or rendering == os2_rendering::super_circle
  => Y dimension of the pattern used in pixels
`},{id:"color_encoding",type:"u4",doc:`Specifies the color model used to describe the bitmap data.
The only valid value is 0, indicating the RGB encoding scheme.
`},{id:"identifier",type:"u4",doc:"Application-specific value"}]},bitmap_v4_extension:{"-orig-id":"BITMAPV4HEADER","doc-ref":"https://learn.microsoft.com/en-us/windows/win32/api/wingdi/ns-wingdi-bitmapv4header",seq:[{id:"color_space_type","-orig-id":"bV4CSType",type:"u4",enum:"color_space"},{id:"endpoint_red",type:"cie_xyz"},{id:"endpoint_green",type:"cie_xyz"},{id:"endpoint_blue",type:"cie_xyz"},{id:"gamma_red","-orig-id":"bV4GammaRed",type:"fixed_point_16_dot_16"},{id:"gamma_blue","-orig-id":"bV4GammaGreen",type:"fixed_point_16_dot_16"},{id:"gamma_green","-orig-id":"bV4GammaBlue",type:"fixed_point_16_dot_16"}]},cie_xyz:{"-orig-id":"CIEXYZ","doc-ref":"https://learn.microsoft.com/en-us/windows/win32/api/wingdi/ns-wingdi-ciexyz",seq:[{id:"x",type:"fixed_point_2_dot_30"},{id:"y",type:"fixed_point_2_dot_30"},{id:"z",type:"fixed_point_2_dot_30"}]},bitmap_v5_extension:{meta:{encoding:"windows-1252"},"-orig-id":"BITMAPV5HEADER","doc-ref":"https://learn.microsoft.com/en-us/windows/win32/api/wingdi/ns-wingdi-bitmapv5header",seq:[{id:"intent","-orig-id":"bV5Intent",type:"u4",enum:"intent"},{id:"ofs_profile","-orig-id":"bV5ProfileData",doc:"The offset, in bytes, from the beginning of the BITMAPV5HEADER structure to the start of the profile data.",type:"u4"},{id:"len_profile","-orig-id":"bV5ProfileSize",type:"u4"},{id:"reserved","-orig-id":"bV5Reserved",type:"u4"}],instances:{has_profile:{value:"_parent.bitmap_v4_ext.color_space_type == color_space::profile_linked or _parent.bitmap_v4_ext.color_space_type == color_space::profile_embedded"},profile_data:{io:"_root._io",pos:"_root.file_hdr._sizeof + ofs_profile",size:"len_profile",type:{"switch-on":"_parent.bitmap_v4_ext.color_space_type == color_space::profile_linked",cases:{true:"strz"}},if:"has_profile","doc-ref":'https://learn.microsoft.com/en-us/windows/win32/wcs/using-structures-in-wcs-1-0 "If the profile is embedded, profile data is the actual profile, and if it is linked, the profile data is the null-terminated file name of the profile. This cannot be a Unicode string. It must be composed exclusively of characters from the Windows character set (code page 1252)."'}}},color_table:{params:[{id:"has_reserved_field",type:"bool"},{id:"num_colors",doc:"If equal to 0, the palette should contain as many colors as can fit into the pixel value\naccording to the `bits_per_pixel` field (if `bits_per_pixel` = 8, then the pixel can\nrepresent 2 ** 8 = 256 values, so exactly 256 colors should be present). For more flexibility,\nit reads as many colors as it can until EOS is reached (and the image data begin).\n",type:"u4"}],seq:[{id:"colors",type:"rgb_record(has_reserved_field)",repeat:"expr","repeat-expr":"num_colors > 0 and num_colors < num_colors_present ? num_colors : num_colors_present"}],instances:{num_colors_present:{value:"_io.size / (has_reserved_field ? 4 : 3)"}}},color_mask:{params:[{id:"has_alpha_mask",type:"bool"}],seq:[{id:"red_mask",type:"u4"},{id:"green_mask",type:"u4"},{id:"blue_mask",type:"u4"},{id:"alpha_mask",type:"u4",if:"has_alpha_mask"}]},rgb_record:{"-orig-id":["RGB_TRIPLE","RGB_QUAD"],params:[{id:"has_reserved_field",type:"bool"}],seq:[{id:"blue",type:"u1"},{id:"green",type:"u1"},{id:"red",type:"u1"},{id:"reserved",type:"u1",if:"has_reserved_field"}],"-webide-representation":"rgb({red:dec}, {green:dec}, {blue:dec})"},fixed_point_2_dot_30:{"-orig-id":"FXPT2DOT30",seq:[{id:"raw",type:"u4"}],instances:{value:{value:"(raw + 0.0) / (1 << 30)"}},"-webide-representation":"{value}"},fixed_point_16_dot_16:{seq:[{id:"raw",type:"u4"}],instances:{value:{value:"(raw + 0.0) / (1 << 16)"}},"-webide-representation":"{value}"}},enums:{compressions:{0:{id:"rgb","-orig-id":"BI_RGB",doc:"Uncompressed RGB format"},1:{id:"rle8","-orig-id":"BI_RLE8",doc:"RLE compression, 8 bits per pixel"},2:{id:"rle4","-orig-id":"BI_RLE4",doc:"RLE compression, 4 bits per pixel"},3:{id:"bitfields","-orig-id":"BI_BITFIELDS"},4:{id:"jpeg","-orig-id":"BI_JPEG",doc:"BMP file includes whole JPEG file in image buffer"},5:{id:"png","-orig-id":"BI_PNG",doc:"BMP file includes whole PNG file in image buffer"},6:{id:"alpha_bitfields","-orig-id":"BI_ALPHABITFIELDS",doc:"only Windows CE 5.0 with .NET 4.0 or later","doc-ref":["https://en.wikipedia.org/wiki/BMP_file_format#DIB_header_(bitmap_information_header) table of compression methods","http://entropymine.com/jason/bmpsuite/bmpsuite/html/bmpsuite.html q/rgba32abf.bmp"]}},os2_compressions:{0:{id:"rgb"},1:{id:"rle8"},2:{id:"rle4"},3:{id:"huffman_1d",doc:"Huffman 1D compression (also known as CCITT Group 3 One-Dimensional (G31D))"},4:{id:"rle24",doc:"RLE compression, 24 bits per pixel"}},os2_rendering:{0:{id:"no_halftoning"},1:{id:"error_diffusion"},2:{id:"panda",doc:"Processing Algorithm for Noncoded Document Acquisition (PANDA)"},3:{id:"super_circle"}},color_space:{0:{id:"calibrated_rgb","-orig-id":"LCS_CALIBRATED_RGB",doc:"This value implies that endpoints and gamma values are given in the appropriate fields."},1279872587:{id:"profile_linked","-orig-id":"PROFILE_LINKED",doc:`This value indicates that bV5ProfileData points to the file name of the profile
to use (gamma and endpoints values are ignored).

If a profile is linked, the path of the profile can be any fully qualified name
(including a network path) that can be opened using the Win32 CreateFile function.
`},1296188740:{id:"profile_embedded","-orig-id":"PROFILE_EMBEDDED",doc:`This value indicates that bV5ProfileData points to a memory buffer that contains
the profile to be used (gamma and endpoints values are ignored).
`},1466527264:{id:"windows","-orig-id":"LCS_WINDOWS_COLOR_SPACE",doc:"This value indicates that the bitmap is in the system default color space, sRGB."},1934772034:{id:"s_rgb","-orig-id":"LCS_sRGB",doc:"Specifies that the bitmap is in sRGB color space."}},intent:{1:{id:"business","-orig-id":"LCS_GM_BUSINESS",doc:"Maintains saturation. Used for business charts and other situations in which undithered colors are required."},2:{id:"graphics","-orig-id":"LCS_GM_GRAPHICS",doc:"Maintains colorimetric match. Used for graphic designs and named colors."},4:{id:"images","-orig-id":"LCS_GM_IMAGES",doc:"Maintains contrast. Used for photographs and natural images."},8:{id:"abs_colorimetric","-orig-id":"LCS_GM_ABS_COLORIMETRIC",doc:"Maintains the white point. Matches the colors to their nearest color in the destination gamut."}},header_type:{12:"bitmap_core_header",40:"bitmap_info_header",52:"bitmap_v2_info_header",56:"bitmap_v3_info_header",64:"os2_2x_bitmap_header",108:"bitmap_v4_header",124:"bitmap_v5_header"}}}};export{R as default,A as spec};
