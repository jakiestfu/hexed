import{k as l}from"./index-DZ3xxA7Z.js";var u=Object.getOwnPropertyNames,p=(o,s)=>function(){return s||(0,o[u(o)[0]])((s={exports:{}}).exports,s),s.exports},m=p({"<stdin>"(o){(function(s,a){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],a):typeof o=="object"&&o!==null&&typeof o.nodeType!="number"?a(o,l.KaitaiStream):a(s.DosMz||(s.DosMz={}),s.KaitaiStream)})(typeof self<"u"?self:o,function(s,a){var r=(function(){function _(e,t,i){this._io=e,this._parent=t,this._root=i||this,this._debug={},this._read()}_.prototype._read=function(){this._debug.header={start:this._io.pos,ioOffset:this._io.byteOffset},this.header=new n(this._io,this,this._root),this._debug.header.end=this._io.pos,this._debug.body={start:this._io.pos,ioOffset:this._io.byteOffset},this.body=this._io.readBytes(this.header.lenBody),this._debug.body.end=this._io.pos};var n=_.ExeHeader=(function(){function e(t,i,h){this._io=t,this._parent=i,this._root=h,this._debug={},this._read()}return e.prototype._read=function(){this._debug.mz={start:this._io.pos,ioOffset:this._io.byteOffset},this.mz=new d(this._io,this,this._root),this._debug.mz.end=this._io.pos,this._debug.restOfHeader={start:this._io.pos,ioOffset:this._io.byteOffset},this.restOfHeader=this._io.readBytes(this.mz.lenHeader-28),this._debug.restOfHeader.end=this._io.pos},Object.defineProperty(e.prototype,"lenBody",{get:function(){return this._m_lenBody!==void 0?this._m_lenBody:(this._debug._m_lenBody={},this._m_lenBody=(this.mz.lastPageExtraBytes==0?this.mz.numPages*512:(this.mz.numPages-1)*512+this.mz.lastPageExtraBytes)-this.mz.lenHeader,this._m_lenBody)}}),e})(),d=_.MzHeader=(function(){function e(t,i,h){this._io=t,this._parent=i,this._root=h,this._debug={},this._read()}return e.prototype._read=function(){if(this._debug.magic={start:this._io.pos,ioOffset:this._io.byteOffset},this.magic=a.bytesToStr(this._io.readBytes(2),"ASCII"),this._debug.magic.end=this._io.pos,!(this.magic=="MZ"||this.magic=="ZM")){var t=new a.ValidationNotAnyOfError(this.magic,this._io,"/types/mz_header/seq/0");throw this._debug.magic.validationError=t,t}this._debug.lastPageExtraBytes={start:this._io.pos,ioOffset:this._io.byteOffset},this.lastPageExtraBytes=this._io.readU2le(),this._debug.lastPageExtraBytes.end=this._io.pos,this._debug.numPages={start:this._io.pos,ioOffset:this._io.byteOffset},this.numPages=this._io.readU2le(),this._debug.numPages.end=this._io.pos,this._debug.numRelocations={start:this._io.pos,ioOffset:this._io.byteOffset},this.numRelocations=this._io.readU2le(),this._debug.numRelocations.end=this._io.pos,this._debug.headerSize={start:this._io.pos,ioOffset:this._io.byteOffset},this.headerSize=this._io.readU2le(),this._debug.headerSize.end=this._io.pos,this._debug.minAllocation={start:this._io.pos,ioOffset:this._io.byteOffset},this.minAllocation=this._io.readU2le(),this._debug.minAllocation.end=this._io.pos,this._debug.maxAllocation={start:this._io.pos,ioOffset:this._io.byteOffset},this.maxAllocation=this._io.readU2le(),this._debug.maxAllocation.end=this._io.pos,this._debug.initialSs={start:this._io.pos,ioOffset:this._io.byteOffset},this.initialSs=this._io.readU2le(),this._debug.initialSs.end=this._io.pos,this._debug.initialSp={start:this._io.pos,ioOffset:this._io.byteOffset},this.initialSp=this._io.readU2le(),this._debug.initialSp.end=this._io.pos,this._debug.checksum={start:this._io.pos,ioOffset:this._io.byteOffset},this.checksum=this._io.readU2le(),this._debug.checksum.end=this._io.pos,this._debug.initialIp={start:this._io.pos,ioOffset:this._io.byteOffset},this.initialIp=this._io.readU2le(),this._debug.initialIp.end=this._io.pos,this._debug.initialCs={start:this._io.pos,ioOffset:this._io.byteOffset},this.initialCs=this._io.readU2le(),this._debug.initialCs.end=this._io.pos,this._debug.ofsRelocations={start:this._io.pos,ioOffset:this._io.byteOffset},this.ofsRelocations=this._io.readU2le(),this._debug.ofsRelocations.end=this._io.pos,this._debug.overlayId={start:this._io.pos,ioOffset:this._io.byteOffset},this.overlayId=this._io.readU2le(),this._debug.overlayId.end=this._io.pos},Object.defineProperty(e.prototype,"lenHeader",{get:function(){return this._m_lenHeader!==void 0?this._m_lenHeader:(this._debug._m_lenHeader={},this._m_lenHeader=this.headerSize*16,this._m_lenHeader)}}),e})(),f=_.Relocation=(function(){function e(t,i,h){this._io=t,this._parent=i,this._root=h,this._debug={},this._read()}return e.prototype._read=function(){this._debug.ofs={start:this._io.pos,ioOffset:this._io.byteOffset},this.ofs=this._io.readU2le(),this._debug.ofs.end=this._io.pos,this._debug.seg={start:this._io.pos,ioOffset:this._io.byteOffset},this.seg=this._io.readU2le(),this._debug.seg.end=this._io.pos},e})();return Object.defineProperty(_.prototype,"relocations",{get:function(){if(this._m_relocations!==void 0)return this._m_relocations;if(this.header.mz.ofsRelocations!=0){var e=this.header._io,t=e.pos;e.seek(this.header.mz.ofsRelocations),this._debug._m_relocations={start:e.pos,ioOffset:e.byteOffset},this._debug._m_relocations.arr=[],this._m_relocations=[];for(var i=0;i<this.header.mz.numRelocations;i++)this._debug._m_relocations.arr[i]={start:e.pos,ioOffset:e.byteOffset},this._m_relocations.push(new f(e,this,this._root)),this._debug._m_relocations.arr[i].end=e.pos;this._debug._m_relocations.end=e.pos,e.seek(t)}return this._m_relocations}}),_})();s.DosMz=r})}});const b=m(),g={id:"dos_mz",title:"DOS MZ executable",ksy:{meta:{id:"dos_mz",title:"DOS MZ executable","file-extension":["exe","ovl"],xref:{justsolve:"MS-DOS_EXE",pronom:"x-fmt/409",wikidata:"Q1882110"},tags:["dos"],license:"CC0-1.0","ks-version":.9,encoding:"ASCII",endian:"le"},doc:`DOS MZ file format is a traditional format for executables in MS-DOS
environment. Many modern formats (i.e. Windows PE) still maintain
compatibility stub with this format.

As opposed to .com file format (which basically sports one 64K code
segment of raw CPU instructions), DOS MZ .exe file format allowed
more flexible memory management, loading of larger programs and
added support for relocations.
`,"doc-ref":"http://www.delorie.com/djgpp/doc/exe/",seq:[{id:"header",type:"exe_header"},{id:"body",size:"header.len_body"}],instances:{relocations:{pos:"header.mz.ofs_relocations",io:"header._io",type:"relocation",repeat:"expr","repeat-expr":"header.mz.num_relocations",if:"header.mz.ofs_relocations != 0"}},types:{exe_header:{seq:[{id:"mz",type:"mz_header"},{id:"rest_of_header",size:"mz.len_header - mz._sizeof"}],instances:{len_body:{value:"(mz.last_page_extra_bytes == 0 ? mz.num_pages * 512 : (mz.num_pages - 1) * 512 + mz.last_page_extra_bytes) - mz.len_header"}}},mz_header:{seq:[{id:"magic",size:2,type:"str",valid:{"any-of":['"MZ"','"ZM"']}},{id:"last_page_extra_bytes",type:"u2"},{id:"num_pages",type:"u2"},{id:"num_relocations",type:"u2"},{id:"header_size",type:"u2"},{id:"min_allocation",type:"u2"},{id:"max_allocation",type:"u2"},{id:"initial_ss",type:"u2"},{id:"initial_sp",type:"u2"},{id:"checksum",type:"u2"},{id:"initial_ip",type:"u2"},{id:"initial_cs",type:"u2"},{id:"ofs_relocations",type:"u2"},{id:"overlay_id",type:"u2"}],instances:{len_header:{value:"header_size * 16"}}},relocation:{seq:[{id:"ofs",type:"u2"},{id:"seg",type:"u2"}]}}}};export{b as default,g as spec};
