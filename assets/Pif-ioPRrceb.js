import{k as f}from"./index-CMEpbKl5.js";var m=Object.getOwnPropertyNames,p=(r,s)=>function(){return s||(0,r[m(r)[0]])((s={exports:{}}).exports,s),s.exports},g=p({"<stdin>"(r){(function(s,o){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],o):typeof r=="object"&&r!==null&&typeof r.nodeType!="number"?o(r,f.KaitaiStream):o(s.Pif||(s.Pif={}),s.KaitaiStream)})(typeof self<"u"?self:r,function(s,o){var _=(function(){i.CompressionType=Object.freeze({NONE:0,RLE:32222,0:"NONE",32222:"RLE"}),i.ImageType=Object.freeze({RGB332:7763,RGB888:17212,INDEXED_RGB332:18754,INDEXED_RGB565:18759,INDEXED_RGB888:18770,BLACK_WHITE:32170,RGB16C:47253,RGB565:58821,7763:"RGB332",17212:"RGB888",18754:"INDEXED_RGB332",18759:"INDEXED_RGB565",18770:"INDEXED_RGB888",32170:"BLACK_WHITE",47253:"RGB16C",58821:"RGB565"});function i(t,e,a){this._io=t,this._parent=e,this._root=a||this,this._debug={},this._read()}i.prototype._read=function(){if(this._debug.fileHeader={start:this._io.pos,ioOffset:this._io.byteOffset},this.fileHeader=new d(this._io,this,this._root),this._debug.fileHeader.end=this._io.pos,this._debug.infoHeader={start:this._io.pos,ioOffset:this._io.byteOffset},this.infoHeader=new h(this._io,this,this._root),this._debug.infoHeader.end=this._io.pos,this.infoHeader.usesIndexedMode){this._debug.colorTable={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_colorTable=this._io.readBytes(this.infoHeader.lenColorTable);var t=new o(this._raw_colorTable);this.colorTable=new l(t,this,this._root),this._debug.colorTable.end=this._io.pos}};var l=i.ColorTableData=(function(){function t(e,a,n){this._io=e,this._parent=a,this._root=n,this._debug={},this._read()}return t.prototype._read=function(){for(this._debug.entries={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.entries.arr=[],this.entries=[];!this._io.isEof();){switch(this._debug.entries.arr[this.entries.length]={start:this._io.pos,ioOffset:this._io.byteOffset},this._root.infoHeader.imageType){case i.ImageType.INDEXED_RGB332:this.entries.push(this._io.readBitsIntLe(8));break;case i.ImageType.INDEXED_RGB565:this.entries.push(this._io.readBitsIntLe(16));break;case i.ImageType.INDEXED_RGB888:this.entries.push(this._io.readBitsIntLe(24));break}this._debug.entries.arr[this.entries.length-1].end=this._io.pos}this._debug.entries.end=this._io.pos},t})(),h=i.InformationHeader=(function(){function t(e,a,n){this._io=e,this._parent=a,this._root=n,this._debug={},this._read()}return t.prototype._read=function(){if(this._debug.imageType={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"Pif.ImageType"},this.imageType=this._io.readU2le(),this._debug.imageType.end=this._io.pos,!(this.imageType==i.ImageType.RGB888||this.imageType==i.ImageType.RGB565||this.imageType==i.ImageType.RGB332||this.imageType==i.ImageType.RGB16C||this.imageType==i.ImageType.BLACK_WHITE||this.imageType==i.ImageType.INDEXED_RGB888||this.imageType==i.ImageType.INDEXED_RGB565||this.imageType==i.ImageType.INDEXED_RGB332)){var e=new o.ValidationNotAnyOfError(this.imageType,this._io,"/types/information_header/seq/0");throw this._debug.imageType.validationError=e,e}this._debug.bitsPerPixel={start:this._io.pos,ioOffset:this._io.byteOffset},this.bitsPerPixel=this._io.readU2le(),this._debug.bitsPerPixel.end=this._io.pos;var a=this.bitsPerPixel;if(!(this.imageType==i.ImageType.RGB888?a==24:this.imageType==i.ImageType.RGB565?a==16:this.imageType==i.ImageType.RGB332?a==8:this.imageType==i.ImageType.RGB16C?a==4:this.imageType==i.ImageType.BLACK_WHITE?a==1:!this.usesIndexedMode||a<=8)){var e=new o.ValidationExprError(this.bitsPerPixel,this._io,"/types/information_header/seq/1");throw this._debug.bitsPerPixel.validationError=e,e}if(this._debug.width={start:this._io.pos,ioOffset:this._io.byteOffset},this.width=this._io.readU2le(),this._debug.width.end=this._io.pos,this._debug.height={start:this._io.pos,ioOffset:this._io.byteOffset},this.height=this._io.readU2le(),this._debug.height.end=this._io.pos,this._debug.lenImageData={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenImageData=this._io.readU4le(),this._debug.lenImageData.end=this._io.pos,!(this.lenImageData<=this._root.fileHeader.lenFile-this._root.fileHeader.ofsImageData)){var e=new o.ValidationGreaterThanError(this._root.fileHeader.lenFile-this._root.fileHeader.ofsImageData,this.lenImageData,this._io,"/types/information_header/seq/4");throw this._debug.lenImageData.validationError=e,e}if(this._debug.lenColorTable={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenColorTable=this._io.readU2le(),this._debug.lenColorTable.end=this._io.pos,!(this.lenColorTable>=(this.usesIndexedMode?this.lenColorTableEntry*1:0))){var e=new o.ValidationLessThanError(this.usesIndexedMode?this.lenColorTableEntry*1:0,this.lenColorTable,this._io,"/types/information_header/seq/5");throw this._debug.lenColorTable.validationError=e,e}if(!(this.lenColorTable<=(this.usesIndexedMode?this.lenColorTableMax<this.lenColorTableFull?this.lenColorTableMax:this.lenColorTableFull:0))){var e=new o.ValidationGreaterThanError(this.usesIndexedMode?this.lenColorTableMax<this.lenColorTableFull?this.lenColorTableMax:this.lenColorTableFull:0,this.lenColorTable,this._io,"/types/information_header/seq/5");throw this._debug.lenColorTable.validationError=e,e}if(this._debug.compression={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"Pif.CompressionType"},this.compression=this._io.readU2le(),this._debug.compression.end=this._io.pos,!(this.compression==i.CompressionType.NONE||this.compression==i.CompressionType.RLE)){var e=new o.ValidationNotAnyOfError(this.compression,this._io,"/types/information_header/seq/6");throw this._debug.compression.validationError=e,e}},Object.defineProperty(t.prototype,"lenColorTableEntry",{get:function(){return this._m_lenColorTableEntry!==void 0?this._m_lenColorTableEntry:(this._debug._m_lenColorTableEntry={},this._m_lenColorTableEntry=this.imageType==i.ImageType.INDEXED_RGB888?3:this.imageType==i.ImageType.INDEXED_RGB565?2:this.imageType==i.ImageType.INDEXED_RGB332?1:0,this._m_lenColorTableEntry)}}),Object.defineProperty(t.prototype,"lenColorTableFull",{get:function(){return this._m_lenColorTableFull!==void 0?this._m_lenColorTableFull:(this._debug._m_lenColorTableFull={},this._m_lenColorTableFull=this.lenColorTableEntry*(1<<this.bitsPerPixel),this._m_lenColorTableFull)}}),Object.defineProperty(t.prototype,"lenColorTableMax",{get:function(){return this._m_lenColorTableMax!==void 0?this._m_lenColorTableMax:(this._debug._m_lenColorTableMax={},this._m_lenColorTableMax=this._root.fileHeader.ofsImageData-this._root.fileHeader.ofsImageDataMin,this._m_lenColorTableMax)}}),Object.defineProperty(t.prototype,"usesIndexedMode",{get:function(){return this._m_usesIndexedMode!==void 0?this._m_usesIndexedMode:(this._debug._m_usesIndexedMode={},this._m_usesIndexedMode=this.lenColorTableEntry!=0,this._m_usesIndexedMode)}}),t})(),d=i.PifHeader=(function(){function t(e,a,n){this._io=e,this._parent=a,this._root=n,this._debug={},this._read()}return t.prototype._read=function(){if(this._debug.magic={start:this._io.pos,ioOffset:this._io.byteOffset},this.magic=this._io.readBytes(4),this._debug.magic.end=this._io.pos,o.byteArrayCompare(this.magic,new Uint8Array([80,73,70,0]))!=0){var e=new o.ValidationNotEqualError(new Uint8Array([80,73,70,0]),this.magic,this._io,"/types/pif_header/seq/0");throw this._debug.magic.validationError=e,e}if(this._debug.lenFile={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenFile=this._io.readU4le(),this._debug.lenFile.end=this._io.pos,!(this.lenFile>=this.ofsImageDataMin)){var e=new o.ValidationLessThanError(this.ofsImageDataMin,this.lenFile,this._io,"/types/pif_header/seq/1");throw this._debug.lenFile.validationError=e,e}if(this._debug.ofsImageData={start:this._io.pos,ioOffset:this._io.byteOffset},this.ofsImageData=this._io.readU4le(),this._debug.ofsImageData.end=this._io.pos,!(this.ofsImageData>=this.ofsImageDataMin)){var e=new o.ValidationLessThanError(this.ofsImageDataMin,this.ofsImageData,this._io,"/types/pif_header/seq/2");throw this._debug.ofsImageData.validationError=e,e}if(!(this.ofsImageData<=this.lenFile)){var e=new o.ValidationGreaterThanError(this.lenFile,this.ofsImageData,this._io,"/types/pif_header/seq/2");throw this._debug.ofsImageData.validationError=e,e}},Object.defineProperty(t.prototype,"ofsImageDataMin",{get:function(){return this._m_ofsImageDataMin!==void 0?this._m_ofsImageDataMin:(this._debug._m_ofsImageDataMin={},this._m_ofsImageDataMin=28,this._m_ofsImageDataMin)}}),t})();return Object.defineProperty(i.prototype,"imageData",{get:function(){if(this._m_imageData!==void 0)return this._m_imageData;var t=this._io.pos;return this._io.seek(this.fileHeader.ofsImageData),this._debug._m_imageData={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_imageData=this._io.readBytes(this.infoHeader.lenImageData),this._debug._m_imageData.end=this._io.pos,this._io.seek(t),this._m_imageData}}),i})();s.Pif=_})}});const u=g(),y={id:"pif",title:"Portable Image Format",ksy:{meta:{id:"pif",title:"Portable Image Format","file-extension":"pif",xref:{justsolve:"PIF_(Portable_Image_Format)"},license:"LGPL-2.1","ks-version":.9,endian:"le","bit-endian":"le"},doc:`The Portable Image Format (PIF) is a basic, bitmap-like image format with the
focus on ease of use (implementation) and small size for embedded
applications.

See <https://github.com/gfcwfzkm/PIF-Image-Format> for more info.
`,"doc-ref":["https://github.com/gfcwfzkm/PIF-Image-Format/blob/4ec261b/Specification/PIF%20Format%20Specification.pdf","https://github.com/gfcwfzkm/PIF-Image-Format/blob/4ec261b/C%20Library/pifdec.c#L300"],seq:[{id:"file_header",type:"pif_header"},{id:"info_header",type:"information_header"},{id:"color_table",size:"info_header.len_color_table",type:"color_table_data",if:"info_header.uses_indexed_mode"}],instances:{image_data:{pos:"file_header.ofs_image_data",size:"info_header.len_image_data"}},types:{pif_header:{seq:[{id:"magic",contents:["PIF",0]},{id:"len_file",type:"u4",valid:{min:"ofs_image_data_min"}},{id:"ofs_image_data",type:"u4",valid:{min:"ofs_image_data_min",max:"len_file"}}],instances:{ofs_image_data_min:{value:"_root.file_header._sizeof + _root.info_header._sizeof"}}},information_header:{seq:[{id:"image_type",type:"u2",enum:"image_type",valid:{"any-of":["image_type::rgb888","image_type::rgb565","image_type::rgb332","image_type::rgb16c","image_type::black_white","image_type::indexed_rgb888","image_type::indexed_rgb565","image_type::indexed_rgb332"]}},{id:"bits_per_pixel",type:"u2",valid:{expr:`image_type == image_type::rgb888 ? _ == 24 :
image_type == image_type::rgb565 ? _ == 16 :
image_type == image_type::rgb332 ? _ == 8 :
image_type == image_type::rgb16c ? _ == 4 :
image_type == image_type::black_white ? _ == 1 :
uses_indexed_mode ? _ <= 8 :
true
`},doc:`See <https://github.com/gfcwfzkm/PIF-Image-Format/blob/4ec261b/Specification/PIF%20Format%20Specification.pdf>:

> Bits per Pixel: Bit size that each Pixel occupies. Bit size for an
> Indexed Image cannot go beyond 8 bits.
`},{id:"width",type:"u2"},{id:"height",type:"u2"},{id:"len_image_data",type:"u4",valid:{max:"_root.file_header.len_file - _root.file_header.ofs_image_data"}},{id:"len_color_table",type:"u2",valid:{min:"uses_indexed_mode ? len_color_table_entry * 1 : 0",max:`uses_indexed_mode ? (
  len_color_table_max < len_color_table_full
    ? len_color_table_max
    : len_color_table_full
) : 0
`},doc:`See <https://github.com/gfcwfzkm/PIF-Image-Format/blob/4ec261b/Specification/PIF%20Format%20Specification.pdf>:

> Color Table Size: (...), only used in Indexed mode, otherwise zero.
---
> **Note**: The presence of the Color Table is mandatory when Bits per
> Pixel <= 8, unless Image Type states RGB332, RGB16C or B/W
---
> **Color Table** (semi-optional)
>
> (...) The amount of Colors has to be same or less than [Bits per
> Pixel] allow, otherwise the image is invalid.
`},{id:"compression",type:"u2",enum:"compression_type",valid:{"any-of":["compression_type::none","compression_type::rle"]}}],instances:{len_color_table_entry:{value:`image_type == image_type::indexed_rgb888 ? 3 :
image_type == image_type::indexed_rgb565 ? 2 :
image_type == image_type::indexed_rgb332 ? 1 :
0
`},len_color_table_full:{value:"len_color_table_entry * (1 << bits_per_pixel)"},len_color_table_max:{value:"_root.file_header.ofs_image_data - _root.file_header.ofs_image_data_min"},uses_indexed_mode:{value:"len_color_table_entry != 0"}}},color_table_data:{seq:[{id:"entries",type:{"switch-on":"_root.info_header.image_type",cases:{"image_type::indexed_rgb888":"b24","image_type::indexed_rgb565":"b16","image_type::indexed_rgb332":"b8"}},repeat:"eos"}]}},enums:{image_type:{7763:"rgb332",17212:"rgb888",18754:"indexed_rgb332",18759:"indexed_rgb565",18770:"indexed_rgb888",32170:{id:"black_white",doc:"0: black, 1: white","doc-ref":"https://github.com/gfcwfzkm/PIF-Image-Format/blob/4ec261b/C%20Library/pifdec.c#L233"},47253:{id:"rgb16c",doc:`Formula to convert the 4-bit color value in RGB16C mode to RGB values
(each in the range from 0 to 255):

\`\`\`
red   = 170 * ((color_value & 0b0100) >> 2) + 85 * ((color_value & 0b1000) >> 3)
green = 170 * ((color_value & 0b0010) >> 1) + 85 * ((color_value & 0b1000) >> 3)
blue  = 170 * ((color_value & 0b0001) >> 0) + 85 * ((color_value & 0b1000) >> 3)
\`\`\`

See also <https://en.wikipedia.org/wiki/Color_Graphics_Adapter#Color_palette>
`},58821:"rgb565"},compression_type:{0:"none",32222:"rle"}}}};export{u as default,y as spec};
