import{k as g}from"./index-LM5QM2-c.js";var m=Object.getOwnPropertyNames,l=(r,_)=>function(){return _||(0,r[m(r)[0]])((_={exports:{}}).exports,_),_.exports},b=l({"<stdin>"(r){(function(_,s){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],s):typeof r=="object"&&r!==null&&typeof r.nodeType!="number"?s(r,g.KaitaiStream):s(_.Cramfs||(_.Cramfs={}),_.KaitaiStream)})(typeof self<"u"?self:r,function(_,s){var d=(function(){function h(e,t,i){this._io=e,this._parent=t,this._root=i||this,this._debug={},this._read()}h.prototype._read=function(){this._debug.superBlock={start:this._io.pos,ioOffset:this._io.byteOffset},this.superBlock=new p(this._io,this,this._root),this._debug.superBlock.end=this._io.pos};var n=h.ChunkedDataInode=(function(){function e(t,i,o){this._io=t,this._parent=i,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.blockEndIndex={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.blockEndIndex.arr=[],this.blockEndIndex=[];for(var t=0;t<Math.floor((this._parent.size+this._root.pageSize-1)/this._root.pageSize);t++)this._debug.blockEndIndex.arr[t]={start:this._io.pos,ioOffset:this._io.byteOffset},this.blockEndIndex.push(this._io.readU4le()),this._debug.blockEndIndex.arr[t].end=this._io.pos;this._debug.blockEndIndex.end=this._io.pos,this._debug.rawBlocks={start:this._io.pos,ioOffset:this._io.byteOffset},this.rawBlocks=this._io.readBytesFull(),this._debug.rawBlocks.end=this._io.pos},e})(),a=h.DirInode=(function(){function e(t,i,o){this._io=t,this._parent=i,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){if(this._io.size>0){for(this._debug.children={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.children.arr=[],this.children=[];!this._io.isEof();)this._debug.children.arr[this.children.length]={start:this._io.pos,ioOffset:this._io.byteOffset},this.children.push(new f(this._io,this,this._root)),this._debug.children.arr[this.children.length-1].end=this._io.pos;this._debug.children.end=this._io.pos}},e})(),u=h.Info=(function(){function e(t,i,o){this._io=t,this._parent=i,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.crc={start:this._io.pos,ioOffset:this._io.byteOffset},this.crc=this._io.readU4le(),this._debug.crc.end=this._io.pos,this._debug.edition={start:this._io.pos,ioOffset:this._io.byteOffset},this.edition=this._io.readU4le(),this._debug.edition.end=this._io.pos,this._debug.blocks={start:this._io.pos,ioOffset:this._io.byteOffset},this.blocks=this._io.readU4le(),this._debug.blocks.end=this._io.pos,this._debug.files={start:this._io.pos,ioOffset:this._io.byteOffset},this.files=this._io.readU4le(),this._debug.files.end=this._io.pos},e})(),f=h.Inode=(function(){e.FileType=Object.freeze({FIFO:1,CHRDEV:2,DIR:4,BLKDEV:6,REG_FILE:8,SYMLINK:10,SOCKET:12,1:"FIFO",2:"CHRDEV",4:"DIR",6:"BLKDEV",8:"REG_FILE",10:"SYMLINK",12:"SOCKET"});function e(t,i,o){this._io=t,this._parent=i,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.mode={start:this._io.pos,ioOffset:this._io.byteOffset},this.mode=this._io.readU2le(),this._debug.mode.end=this._io.pos,this._debug.uid={start:this._io.pos,ioOffset:this._io.byteOffset},this.uid=this._io.readU2le(),this._debug.uid.end=this._io.pos,this._debug.sizeGid={start:this._io.pos,ioOffset:this._io.byteOffset},this.sizeGid=this._io.readU4le(),this._debug.sizeGid.end=this._io.pos,this._debug.namelenOffset={start:this._io.pos,ioOffset:this._io.byteOffset},this.namelenOffset=this._io.readU4le(),this._debug.namelenOffset.end=this._io.pos,this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=s.bytesToStr(this._io.readBytes(this.namelen),"UTF-8"),this._debug.name.end=this._io.pos},Object.defineProperty(e.prototype,"asDir",{get:function(){if(this._m_asDir!==void 0)return this._m_asDir;var t=this._root._io,i=t.pos;t.seek(this.offset),this._debug._m_asDir={start:t.pos,ioOffset:t.byteOffset},this._raw__m_asDir=t.readBytes(this.size);var o=new s(this._raw__m_asDir);return this._m_asDir=new a(o,this,this._root),this._debug._m_asDir.end=t.pos,t.seek(i),this._m_asDir}}),Object.defineProperty(e.prototype,"asRegFile",{get:function(){if(this._m_asRegFile!==void 0)return this._m_asRegFile;var t=this._root._io,i=t.pos;return t.seek(this.offset),this._debug._m_asRegFile={start:t.pos,ioOffset:t.byteOffset},this._m_asRegFile=new n(t,this,this._root),this._debug._m_asRegFile.end=t.pos,t.seek(i),this._m_asRegFile}}),Object.defineProperty(e.prototype,"asSymlink",{get:function(){if(this._m_asSymlink!==void 0)return this._m_asSymlink;var t=this._root._io,i=t.pos;return t.seek(this.offset),this._debug._m_asSymlink={start:t.pos,ioOffset:t.byteOffset},this._m_asSymlink=new n(t,this,this._root),this._debug._m_asSymlink.end=t.pos,t.seek(i),this._m_asSymlink}}),Object.defineProperty(e.prototype,"attr",{get:function(){return this._m_attr!==void 0?this._m_attr:(this._debug._m_attr={},this._m_attr=this.mode>>>9&7,this._m_attr)}}),Object.defineProperty(e.prototype,"gid",{get:function(){return this._m_gid!==void 0?this._m_gid:(this._debug._m_gid={},this._m_gid=this.sizeGid>>>24,this._m_gid)}}),Object.defineProperty(e.prototype,"namelen",{get:function(){return this._m_namelen!==void 0?this._m_namelen:(this._debug._m_namelen={},this._m_namelen=(this.namelenOffset&63)<<2,this._m_namelen)}}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._m_offset!==void 0?this._m_offset:(this._debug._m_offset={},this._m_offset=(this.namelenOffset>>>6&67108863)<<2,this._m_offset)}}),Object.defineProperty(e.prototype,"permG",{get:function(){return this._m_permG!==void 0?this._m_permG:(this._debug._m_permG={},this._m_permG=this.mode>>>3&7,this._m_permG)}}),Object.defineProperty(e.prototype,"permO",{get:function(){return this._m_permO!==void 0?this._m_permO:(this._debug._m_permO={},this._m_permO=this.mode&7,this._m_permO)}}),Object.defineProperty(e.prototype,"permU",{get:function(){return this._m_permU!==void 0?this._m_permU:(this._debug._m_permU={},this._m_permU=this.mode>>>6&7,this._m_permU)}}),Object.defineProperty(e.prototype,"size",{get:function(){return this._m_size!==void 0?this._m_size:(this._debug._m_size={},this._m_size=this.sizeGid&16777215,this._m_size)}}),Object.defineProperty(e.prototype,"type",{get:function(){return this._m_type!==void 0?this._m_type:(this._debug._m_type={enumName:"Cramfs.Inode.FileType"},this._m_type=this.mode>>>12&15,this._m_type)}}),e})(),p=h.SuperBlockStruct=(function(){function e(t,i,o){this._io=t,this._parent=i,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){if(this._debug.magic={start:this._io.pos,ioOffset:this._io.byteOffset},this.magic=this._io.readBytes(4),this._debug.magic.end=this._io.pos,s.byteArrayCompare(this.magic,new Uint8Array([69,61,205,40]))!=0){var t=new s.ValidationNotEqualError(new Uint8Array([69,61,205,40]),this.magic,this._io,"/types/super_block_struct/seq/0");throw this._debug.magic.validationError=t,t}if(this._debug.size={start:this._io.pos,ioOffset:this._io.byteOffset},this.size=this._io.readU4le(),this._debug.size.end=this._io.pos,this._debug.flags={start:this._io.pos,ioOffset:this._io.byteOffset},this.flags=this._io.readU4le(),this._debug.flags.end=this._io.pos,this._debug.future={start:this._io.pos,ioOffset:this._io.byteOffset},this.future=this._io.readU4le(),this._debug.future.end=this._io.pos,this._debug.signature={start:this._io.pos,ioOffset:this._io.byteOffset},this.signature=this._io.readBytes(16),this._debug.signature.end=this._io.pos,s.byteArrayCompare(this.signature,new Uint8Array([67,111,109,112,114,101,115,115,101,100,32,82,79,77,70,83]))!=0){var t=new s.ValidationNotEqualError(new Uint8Array([67,111,109,112,114,101,115,115,101,100,32,82,79,77,70,83]),this.signature,this._io,"/types/super_block_struct/seq/4");throw this._debug.signature.validationError=t,t}this._debug.fsid={start:this._io.pos,ioOffset:this._io.byteOffset},this.fsid=new u(this._io,this,this._root),this._debug.fsid.end=this._io.pos,this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=s.bytesToStr(this._io.readBytes(16),"ASCII"),this._debug.name.end=this._io.pos,this._debug.root={start:this._io.pos,ioOffset:this._io.byteOffset},this.root=new f(this._io,this,this._root),this._debug.root.end=this._io.pos},Object.defineProperty(e.prototype,"flagFsidV2",{get:function(){return this._m_flagFsidV2!==void 0?this._m_flagFsidV2:(this._debug._m_flagFsidV2={},this._m_flagFsidV2=this.flags>>>0&1,this._m_flagFsidV2)}}),Object.defineProperty(e.prototype,"flagHoles",{get:function(){return this._m_flagHoles!==void 0?this._m_flagHoles:(this._debug._m_flagHoles={},this._m_flagHoles=this.flags>>>8&1,this._m_flagHoles)}}),Object.defineProperty(e.prototype,"flagShiftedRootOffset",{get:function(){return this._m_flagShiftedRootOffset!==void 0?this._m_flagShiftedRootOffset:(this._debug._m_flagShiftedRootOffset={},this._m_flagShiftedRootOffset=this.flags>>>10&1,this._m_flagShiftedRootOffset)}}),Object.defineProperty(e.prototype,"flagSortedDirs",{get:function(){return this._m_flagSortedDirs!==void 0?this._m_flagSortedDirs:(this._debug._m_flagSortedDirs={},this._m_flagSortedDirs=this.flags>>>1&1,this._m_flagSortedDirs)}}),Object.defineProperty(e.prototype,"flagWrongSignature",{get:function(){return this._m_flagWrongSignature!==void 0?this._m_flagWrongSignature:(this._debug._m_flagWrongSignature={},this._m_flagWrongSignature=this.flags>>>9&1,this._m_flagWrongSignature)}}),e})();return Object.defineProperty(h.prototype,"pageSize",{get:function(){return this._m_pageSize!==void 0?this._m_pageSize:(this._debug._m_pageSize={},this._m_pageSize=4096,this._m_pageSize)}}),h})();_.Cramfs=d})}});const y=b(),O={id:"cramfs",title:"cramfs",ksy:{meta:{id:"cramfs",xref:{justsolve:"Cramfs",wikidata:"Q747406"},tags:["filesystem","linux"],license:"MIT",endian:"le"},seq:[{id:"super_block",type:"super_block_struct"}],instances:{page_size:{value:4096}},types:{super_block_struct:{seq:[{id:"magic",contents:[69,61,205,40]},{id:"size",type:"u4"},{id:"flags",type:"u4"},{id:"future",type:"u4"},{id:"signature",contents:"Compressed ROMFS"},{id:"fsid",type:"info"},{id:"name",type:"str",size:16,encoding:"ASCII"},{id:"root",type:"inode"}],instances:{flag_fsid_v2:{value:"(flags >>  0) & 1"},flag_sorted_dirs:{value:"(flags >>  1) & 1"},flag_holes:{value:"(flags >>  8) & 1"},flag_wrong_signature:{value:"(flags >>  9) & 1"},flag_shifted_root_offset:{value:"(flags >> 10) & 1"}}},info:{seq:[{id:"crc",type:"u4"},{id:"edition",type:"u4"},{id:"blocks",type:"u4"},{id:"files",type:"u4"}]},inode:{seq:[{id:"mode",type:"u2"},{id:"uid",type:"u2"},{id:"size_gid",type:"u4"},{id:"namelen_offset",type:"u4"},{id:"name",type:"str",size:"namelen",encoding:"utf-8"}],instances:{type:{value:"(mode >> 12) & 0b1111",enum:"file_type"},attr:{value:"(mode >> 9) & 0b0111"},perm_u:{value:"(mode >> 6) & 0b0111"},perm_g:{value:"(mode >> 3) & 0b0111"},perm_o:{value:"mode & 0b0111"},size:{value:"size_gid & 0xFFFFFF"},gid:{value:"size_gid >> 24"},namelen:{value:"(namelen_offset & 0x3F) << 2"},offset:{value:"((namelen_offset >> 6) & 0x3FFFFFF) << 2"},as_reg_file:{io:"_root._io",pos:"offset",type:"chunked_data_inode"},as_symlink:{io:"_root._io",pos:"offset",type:"chunked_data_inode"},as_dir:{io:"_root._io",pos:"offset",size:"size",type:"dir_inode"}},enums:{file_type:{1:"fifo",2:"chrdev",4:"dir",6:"blkdev",8:"reg_file",10:"symlink",12:"socket"}}},chunked_data_inode:{seq:[{id:"block_end_index",type:"u4",repeat:"expr","repeat-expr":"(_parent.size + _root.page_size - 1) / _root.page_size"},{id:"raw_blocks","size-eos":!0}]},dir_inode:{seq:[{id:"children",repeat:"eos",type:"inode",if:"_io.size > 0"}]}}}};export{y as default,O as spec};
