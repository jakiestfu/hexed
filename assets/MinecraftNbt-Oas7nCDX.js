import{k as b}from"./index-LM5QM2-c.js";var y=Object.getOwnPropertyNames,T=(n,o)=>function(){return o||(0,n[y(n)[0]])((o={exports:{}}).exports,o),o.exports},m=T({"<stdin>"(n){(function(o,r){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],r):typeof n=="object"&&n!==null&&typeof n.nodeType!="number"?r(n,b.KaitaiStream):r(o.MinecraftNbt||(o.MinecraftNbt={}),o.KaitaiStream)})(typeof self<"u"?self:n,function(o,r){var f=(function(){t.Tag=Object.freeze({END:0,BYTE:1,SHORT:2,INT:3,LONG:4,FLOAT:5,DOUBLE:6,BYTE_ARRAY:7,STRING:8,LIST:9,COMPOUND:10,INT_ARRAY:11,LONG_ARRAY:12,0:"END",1:"BYTE",2:"SHORT",3:"INT",4:"LONG",5:"FLOAT",6:"DOUBLE",7:"BYTE_ARRAY",8:"STRING",9:"LIST",10:"COMPOUND",11:"INT_ARRAY",12:"LONG_ARRAY"});function t(s,e,i){this._io=s,this._parent=e,this._root=i||this,this._debug={},this._read()}t.prototype._read=function(){this.rootType==t.Tag.END,this._debug.root={start:this._io.pos,ioOffset:this._io.byteOffset},this.root=new _(this._io,this,this._root),this._debug.root.end=this._io.pos};var _=t.NamedTag=(function(){function s(e,i,a){this._io=e,this._parent=i,this._root=a,this._debug={},this._read()}return s.prototype._read=function(){if(this._debug.type={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"MinecraftNbt.Tag"},this.type=this._io.readU1(),this._debug.type.end=this._io.pos,this.isTagEnd||(this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=new h(this._io,this,this._root),this._debug.name.end=this._io.pos),!this.isTagEnd){switch(this._debug.payload={start:this._io.pos,ioOffset:this._io.byteOffset},this.type){case t.Tag.BYTE:this.payload=this._io.readS1();break;case t.Tag.BYTE_ARRAY:this.payload=new d(this._io,this,this._root);break;case t.Tag.COMPOUND:this.payload=new g(this._io,this,this._root);break;case t.Tag.DOUBLE:this.payload=this._io.readF8be();break;case t.Tag.FLOAT:this.payload=this._io.readF4be();break;case t.Tag.INT:this.payload=this._io.readS4be();break;case t.Tag.INT_ARRAY:this.payload=new p(this._io,this,this._root);break;case t.Tag.LIST:this.payload=new c(this._io,this,this._root);break;case t.Tag.LONG:this.payload=this._io.readS8be();break;case t.Tag.LONG_ARRAY:this.payload=new u(this._io,this,this._root);break;case t.Tag.SHORT:this.payload=this._io.readS2be();break;case t.Tag.STRING:this.payload=new h(this._io,this,this._root);break}this._debug.payload.end=this._io.pos}},Object.defineProperty(s.prototype,"isTagEnd",{get:function(){return this._m_isTagEnd!==void 0?this._m_isTagEnd:(this._debug._m_isTagEnd={},this._m_isTagEnd=this.type==t.Tag.END,this._m_isTagEnd)}}),s})(),d=t.TagByteArray=(function(){function s(e,i,a){this._io=e,this._parent=i,this._root=a,this._debug={},this._read()}return s.prototype._read=function(){this._debug.lenData={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenData=this._io.readS4be(),this._debug.lenData.end=this._io.pos,this._debug.data={start:this._io.pos,ioOffset:this._io.byteOffset},this.data=this._io.readBytes(this.lenData),this._debug.data.end=this._io.pos},s})(),g=t.TagCompound=(function(){function s(e,i,a){this._io=e,this._parent=i,this._root=a,this._debug={},this._read()}return s.prototype._read=function(){this._debug.tags={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.tags.arr=[],this.tags=[];do{this._debug.tags.arr[this.tags.length]={start:this._io.pos,ioOffset:this._io.byteOffset};var e=new _(this._io,this,this._root);this.tags.push(e),this._debug.tags.arr[this.tags.length-1].end=this._io.pos}while(!e.isTagEnd);this._debug.tags.end=this._io.pos},Object.defineProperty(s.prototype,"dumpNumTags",{get:function(){return this._m_dumpNumTags!==void 0?this._m_dumpNumTags:(this._debug._m_dumpNumTags={},this._m_dumpNumTags=this.tags.length-(this.tags.length>=1&&this.tags[this.tags.length-1].isTagEnd?1:0),this._m_dumpNumTags)}}),s})(),p=t.TagIntArray=(function(){function s(e,i,a){this._io=e,this._parent=i,this._root=a,this._debug={},this._read()}return s.prototype._read=function(){this._debug.numTags={start:this._io.pos,ioOffset:this._io.byteOffset},this.numTags=this._io.readS4be(),this._debug.numTags.end=this._io.pos,this._debug.tags={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.tags.arr=[],this.tags=[];for(var e=0;e<this.numTags;e++)this._debug.tags.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.tags.push(this._io.readS4be()),this._debug.tags.arr[e].end=this._io.pos;this._debug.tags.end=this._io.pos},Object.defineProperty(s.prototype,"tagsType",{get:function(){return this._m_tagsType!==void 0?this._m_tagsType:(this._debug._m_tagsType={enumName:"MinecraftNbt.Tag"},this._m_tagsType=t.Tag.INT,this._m_tagsType)}}),s})(),c=t.TagList=(function(){function s(e,i,a){this._io=e,this._parent=i,this._root=a,this._debug={},this._read()}return s.prototype._read=function(){this._debug.tagsType={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"MinecraftNbt.Tag"},this.tagsType=this._io.readU1(),this._debug.tagsType.end=this._io.pos,this._debug.numTags={start:this._io.pos,ioOffset:this._io.byteOffset},this.numTags=this._io.readS4be(),this._debug.numTags.end=this._io.pos,this._debug.tags={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.tags.arr=[],this.tags=[];for(var e=0;e<this.numTags;e++){switch(this._debug.tags.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.tagsType){case t.Tag.BYTE:this.tags.push(this._io.readS1());break;case t.Tag.BYTE_ARRAY:this.tags.push(new d(this._io,this,this._root));break;case t.Tag.COMPOUND:this.tags.push(new g(this._io,this,this._root));break;case t.Tag.DOUBLE:this.tags.push(this._io.readF8be());break;case t.Tag.FLOAT:this.tags.push(this._io.readF4be());break;case t.Tag.INT:this.tags.push(this._io.readS4be());break;case t.Tag.INT_ARRAY:this.tags.push(new p(this._io,this,this._root));break;case t.Tag.LIST:this.tags.push(new s(this._io,this,this._root));break;case t.Tag.LONG:this.tags.push(this._io.readS8be());break;case t.Tag.LONG_ARRAY:this.tags.push(new u(this._io,this,this._root));break;case t.Tag.SHORT:this.tags.push(this._io.readS2be());break;case t.Tag.STRING:this.tags.push(new h(this._io,this,this._root));break}this._debug.tags.arr[e].end=this._io.pos}this._debug.tags.end=this._io.pos},s})(),u=t.TagLongArray=(function(){function s(e,i,a){this._io=e,this._parent=i,this._root=a,this._debug={},this._read()}return s.prototype._read=function(){this._debug.numTags={start:this._io.pos,ioOffset:this._io.byteOffset},this.numTags=this._io.readS4be(),this._debug.numTags.end=this._io.pos,this._debug.tags={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.tags.arr=[],this.tags=[];for(var e=0;e<this.numTags;e++)this._debug.tags.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.tags.push(this._io.readS8be()),this._debug.tags.arr[e].end=this._io.pos;this._debug.tags.end=this._io.pos},Object.defineProperty(s.prototype,"tagsType",{get:function(){return this._m_tagsType!==void 0?this._m_tagsType:(this._debug._m_tagsType={enumName:"MinecraftNbt.Tag"},this._m_tagsType=t.Tag.LONG,this._m_tagsType)}}),s})(),h=t.TagString=(function(){function s(e,i,a){this._io=e,this._parent=i,this._root=a,this._debug={},this._read()}return s.prototype._read=function(){this._debug.lenData={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenData=this._io.readU2be(),this._debug.lenData.end=this._io.pos,this._debug.data={start:this._io.pos,ioOffset:this._io.byteOffset},this.data=r.bytesToStr(this._io.readBytes(this.lenData),"UTF-8"),this._debug.data.end=this._io.pos},s})();return Object.defineProperty(t.prototype,"rootType",{get:function(){if(this._m_rootType!==void 0)return this._m_rootType;var s=this._io.pos;if(this._io.seek(0),this._debug._m_rootType={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"MinecraftNbt.Tag"},this._m_rootType=this._io.readU1(),this._debug._m_rootType.end=this._io.pos,this._m_rootType!=t.Tag.COMPOUND){var e=new r.ValidationNotEqualError(t.Tag.COMPOUND,this._m_rootType,this._io,"/instances/root_type");throw this._debug._m_rootType.validationError=e,e}return this._io.seek(s),this._m_rootType}}),t})();o.MinecraftNbt=f})}});const O=m(),N={id:"minecraft_nbt",title:"Minecraft NBT (Named Binary Tag)",ksy:{meta:{id:"minecraft_nbt",title:"Minecraft NBT (Named Binary Tag)",application:"Minecraft","file-extension":["nbt","dat","schematic","schem"],xref:{justsolve:"Minecraft_NBT_format"},tags:["serialization"],license:"CC0-1.0",encoding:"utf-8",endian:"be"},doc:`A structured binary format native to Minecraft for saving game data and transferring
it over the network (in multiplayer), such as player data
([\`<player>.dat\`](https://minecraft.wiki/w/Player.dat_format); contains
e.g. player's inventory and location), saved worlds
([\`level.dat\`](
  https://minecraft.wiki/w/Java_Edition_level_format#level.dat_format
) and [Chunk format](https://minecraft.wiki/w/Chunk_format#NBT_structure)),
list of saved multiplayer servers
([\`servers.dat\`](https://minecraft.wiki/w/Servers.dat_format)) and so on -
see <https://minecraft.wiki/w/NBT_format#Uses>.

The entire file should be _gzip_-compressed (in accordance with the original
specification [NBT.txt](
  https://web.archive.org/web/20110723210920/https://www.minecraft.net/docs/NBT.txt
) by Notch), but can also be compressed with _zlib_ or uncompressed.

This spec can only handle uncompressed NBT data, so be sure to first detect
what type of data you are dealing with. You can use the Unix \`file\` command
to do this (\`file-5.20\` or later is required; older versions do not recognize
_zlib_-compressed data and return \`application/octet-stream\` instead):

\`\`\`shell
file --brief --mime-type input-unknown.nbt
\`\`\`

If it says:

  * \`application/x-gzip\` or \`application/gzip\` (since \`file-5.37\`), you can decompress it by
    * \`gunzip -c input-gzip.nbt > output.nbt\` or
    * \`python3 -c "import sys, gzip; sys.stdout.buffer.write(
      gzip.decompress(sys.stdin.buffer.read()) )" < input-gzip.nbt > output.nbt\`
  * \`application/zlib\`, you can use
    * \`openssl zlib -d -in input-zlib.nbt -out output.nbt\` (does not work on most systems)
    * \`python3 -c "import sys, zlib; sys.stdout.buffer.write(
      zlib.decompress(sys.stdin.buffer.read()) )" < input-zlib.nbt > output.nbt\`
  * something else (especially \`image/x-pcx\` and \`application/octet-stream\`),
    it is most likely already uncompressed.

The file \`output.nbt\` generated by one of the above commands can already be
processed with this Kaitai Struct specification.

This spec **only** implements the Java edition format. There is also
a [Bedrock edition](https://wiki.vg/NBT#Bedrock_edition) NBT format,
which uses little-endian encoding and has a few other differences, but it isn't
as popular as the Java edition format.

**Implementation note:** strings in \`TAG_String\` are incorrectly decoded with
standard UTF-8, while they are encoded in [**Modified UTF-8**](
  https://docs.oracle.com/javase/8/docs/api/java/io/DataInput.html#modified-utf-8
) (MUTF-8). That's because MUTF-8 is not supported natively by most target
languages, and thus one must use external libraries to achieve a fully-compliant
decoder. But decoding in standard UTF-8 is still better than nothing, and
it usually works fine.

All Unicode code points with incompatible representations in MUTF-8 and UTF-8 are
U+0000 (_NUL_), U+D800-U+DFFF (_High_ and _Low Surrogates_) and U+10000-U+10FFFF
(all _Supplementary_ Planes; includes e.g. emoticons, pictograms).
A _MUTF-8_-encoded string containing these code points cannot be successfully
decoded as UTF-8. The behavior in this case depends on the target language -
usually an exception is thrown, or the bytes that are not valid UTF-8
are replaced or ignored.

**Sample files:**

  * <https://wiki.vg/NBT#Download>
  * <https://github.com/twoolie/NBT/blob/f9e892e/tests/world_test/data/scoreboard.dat>
  * <https://github.com/chmod222/cNBT/tree/3f74b69/testdata>
  * <https://github.com/PistonDevelopers/hematite_nbt/tree/0b85f89/tests>
`,"doc-ref":["https://wiki.vg/NBT","https://web.archive.org/web/20110723210920/https://www.minecraft.net/docs/NBT.txt","https://minecraft.wiki/w/NBT_format"],seq:[{id:"root_check",size:0,if:"root_type == tag::end and false"},{id:"root",type:"named_tag"}],instances:{root_type:{pos:0,type:"u1",enum:"tag",valid:"tag::compound"}},types:{named_tag:{"-webide-representation":'TAG_{type}("{name.data}"): {payload:dec}',seq:[{id:"type",type:"u1",enum:"tag"},{id:"name",type:"tag_string",if:"not is_tag_end"},{id:"payload",type:{"switch-on":"type",cases:{"tag::byte":"s1","tag::short":"s2","tag::int":"s4","tag::long":"s8","tag::float":"f4","tag::double":"f8","tag::byte_array":"tag_byte_array","tag::string":"tag_string","tag::list":"tag_list","tag::compound":"tag_compound","tag::int_array":"tag_int_array","tag::long_array":"tag_long_array"}},if:"not is_tag_end"}],instances:{is_tag_end:{value:"type == tag::end"}}},tag_byte_array:{"-webide-representation":"{len_data:dec} bytes",seq:[{id:"len_data",type:"s4"},{id:"data",size:"len_data"}]},tag_string:{"-webide-representation":"{data}",seq:[{id:"len_data",type:"u2",doc:"unsigned according to <https://wiki.vg/NBT#Specification>"},{id:"data",size:"len_data",type:"str"}]},tag_list:{"-webide-representation":"{num_tags:dec} entries of type TAG_{tags_type}",seq:[{id:"tags_type",type:"u1",enum:"tag"},{id:"num_tags",type:"s4"},{id:"tags",type:{"switch-on":"tags_type",cases:{"tag::byte":"s1","tag::short":"s2","tag::int":"s4","tag::long":"s8","tag::float":"f4","tag::double":"f8","tag::byte_array":"tag_byte_array","tag::string":"tag_string","tag::list":"tag_list","tag::compound":"tag_compound","tag::int_array":"tag_int_array","tag::long_array":"tag_long_array"}},repeat:"expr","repeat-expr":"num_tags"}]},tag_compound:{"-webide-representation":"{dump_num_tags:dec} entries",seq:[{id:"tags",type:"named_tag",repeat:"until","repeat-until":"_.is_tag_end"}],instances:{dump_num_tags:{value:"tags.size - ((tags.size >= 1 and tags.last.is_tag_end) ? 1 : 0)"}}},tag_int_array:{"-webide-representation":"{num_tags:dec} entries of type TAG_{tags_type}",seq:[{id:"num_tags",type:"s4"},{id:"tags",type:"s4",repeat:"expr","repeat-expr":"num_tags"}],instances:{tags_type:{value:"tag::int"}}},tag_long_array:{"-webide-representation":"{num_tags:dec} entries of type TAG_{tags_type}",seq:[{id:"num_tags",type:"s4"},{id:"tags",type:"s8",repeat:"expr","repeat-expr":"num_tags"}],instances:{tags_type:{value:"tag::long"}}}},enums:{tag:{0:{id:"end","-affected-by":90,doc:`As of KSC 0.9, this enum key causes a syntax error in Lua. See
<https://github.com/kaitai-io/kaitai_struct/issues/90#issuecomment-766440975>
for more info.
`},1:"byte",2:"short",3:"int",4:"long",5:"float",6:"double",7:"byte_array",8:"string",9:"list",10:"compound",11:"int_array",12:"long_array"}}}};export{O as default,N as spec};
