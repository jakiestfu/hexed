import{k as c}from"./index-DZ3xxA7Z.js";var m=Object.getOwnPropertyNames,b=(r,n)=>function(){return n||(0,r[m(r)[0]])((n={exports:{}}).exports,n),n.exports},y=b({"<stdin>"(r){(function(n,_){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],_):typeof r=="object"&&r!==null&&typeof r.nodeType!="number"?_(r,c.KaitaiStream):_(n.TrDosImage||(n.TrDosImage={}),n.KaitaiStream)})(typeof self<"u"?self:r,function(n,_){var h=(function(){o.DiskType=Object.freeze({TYPE_80_TRACKS_DOUBLE_SIDE:22,TYPE_40_TRACKS_DOUBLE_SIDE:23,TYPE_80_TRACKS_SINGLE_SIDE:24,TYPE_40_TRACKS_SINGLE_SIDE:25,22:"TYPE_80_TRACKS_DOUBLE_SIDE",23:"TYPE_40_TRACKS_DOUBLE_SIDE",24:"TYPE_80_TRACKS_SINGLE_SIDE",25:"TYPE_40_TRACKS_SINGLE_SIDE"});function o(t,e,i){this._io=t,this._parent=e,this._root=i||this,this._debug={},this._read()}o.prototype._read=function(){this._debug.files={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.files.arr=[],this.files=[];do{this._debug.files.arr[this.files.length]={start:this._io.pos,ioOffset:this._io.byteOffset};var t=new d(this._io,this,this._root);this.files.push(t),this._debug.files.arr[this.files.length-1].end=this._io.pos}while(!t.isTerminator);this._debug.files.end=this._io.pos};var d=o.File=(function(){function t(e,i,s){this._io=e,this._parent=i,this._root=s,this._debug={},this._read()}return t.prototype._read=function(){this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw_name=this._io.readBytes(8);var e=new _(this._raw_name);switch(this.name=new a(e,this,this._root),this._debug.name.end=this._io.pos,this._debug.extension={start:this._io.pos,ioOffset:this._io.byteOffset},this.extension=this._io.readU1(),this._debug.extension.end=this._io.pos,this._debug.positionAndLength={start:this._io.pos,ioOffset:this._io.byteOffset},this.extension){case 35:this.positionAndLength=new g(this._io,this,this._root);break;case 66:this.positionAndLength=new f(this._io,this,this._root);break;case 67:this.positionAndLength=new u(this._io,this,this._root);break;default:this.positionAndLength=new p(this._io,this,this._root);break}this._debug.positionAndLength.end=this._io.pos,this._debug.lengthSectors={start:this._io.pos,ioOffset:this._io.byteOffset},this.lengthSectors=this._io.readU1(),this._debug.lengthSectors.end=this._io.pos,this._debug.startingSector={start:this._io.pos,ioOffset:this._io.byteOffset},this.startingSector=this._io.readU1(),this._debug.startingSector.end=this._io.pos,this._debug.startingTrack={start:this._io.pos,ioOffset:this._io.byteOffset},this.startingTrack=this._io.readU1(),this._debug.startingTrack.end=this._io.pos},Object.defineProperty(t.prototype,"contents",{get:function(){if(this._m_contents!==void 0)return this._m_contents;var e=this._io.pos;return this._io.seek(this.startingTrack*256*16+this.startingSector*256),this._debug._m_contents={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_contents=this._io.readBytes(this.lengthSectors*256),this._debug._m_contents.end=this._io.pos,this._io.seek(e),this._m_contents}}),Object.defineProperty(t.prototype,"isDeleted",{get:function(){return this._m_isDeleted!==void 0?this._m_isDeleted:(this._debug._m_isDeleted={},this._m_isDeleted=this.name.firstByte==1,this._m_isDeleted)}}),Object.defineProperty(t.prototype,"isTerminator",{get:function(){return this._m_isTerminator!==void 0?this._m_isTerminator:(this._debug._m_isTerminator={},this._m_isTerminator=this.name.firstByte==0,this._m_isTerminator)}}),t})(),a=o.Filename=(function(){function t(e,i,s){this._io=e,this._parent=i,this._root=s,this._debug={},this._read()}return t.prototype._read=function(){this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=this._io.readBytes(8),this._debug.name.end=this._io.pos},Object.defineProperty(t.prototype,"firstByte",{get:function(){if(this._m_firstByte!==void 0)return this._m_firstByte;var e=this._io.pos;return this._io.seek(0),this._debug._m_firstByte={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_firstByte=this._io.readU1(),this._debug._m_firstByte.end=this._io.pos,this._io.seek(e),this._m_firstByte}}),t})(),f=o.PositionAndLengthBasic=(function(){function t(e,i,s){this._io=e,this._parent=i,this._root=s,this._debug={},this._read()}return t.prototype._read=function(){this._debug.programAndDataLength={start:this._io.pos,ioOffset:this._io.byteOffset},this.programAndDataLength=this._io.readU2le(),this._debug.programAndDataLength.end=this._io.pos,this._debug.programLength={start:this._io.pos,ioOffset:this._io.byteOffset},this.programLength=this._io.readU2le(),this._debug.programLength.end=this._io.pos},t})(),u=o.PositionAndLengthCode=(function(){function t(e,i,s){this._io=e,this._parent=i,this._root=s,this._debug={},this._read()}return t.prototype._read=function(){this._debug.startAddress={start:this._io.pos,ioOffset:this._io.byteOffset},this.startAddress=this._io.readU2le(),this._debug.startAddress.end=this._io.pos,this._debug.length={start:this._io.pos,ioOffset:this._io.byteOffset},this.length=this._io.readU2le(),this._debug.length.end=this._io.pos},t})(),p=o.PositionAndLengthGeneric=(function(){function t(e,i,s){this._io=e,this._parent=i,this._root=s,this._debug={},this._read()}return t.prototype._read=function(){this._debug.reserved={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved=this._io.readU2le(),this._debug.reserved.end=this._io.pos,this._debug.length={start:this._io.pos,ioOffset:this._io.byteOffset},this.length=this._io.readU2le(),this._debug.length.end=this._io.pos},t})(),g=o.PositionAndLengthPrint=(function(){function t(e,i,s){this._io=e,this._parent=i,this._root=s,this._debug={},this._read()}return t.prototype._read=function(){this._debug.extentNo={start:this._io.pos,ioOffset:this._io.byteOffset},this.extentNo=this._io.readU1(),this._debug.extentNo.end=this._io.pos,this._debug.reserved={start:this._io.pos,ioOffset:this._io.byteOffset},this.reserved=this._io.readU1(),this._debug.reserved.end=this._io.pos,this._debug.length={start:this._io.pos,ioOffset:this._io.byteOffset},this.length=this._io.readU2le(),this._debug.length.end=this._io.pos},t})(),l=o.VolumeInfo=(function(){function t(e,i,s){this._io=e,this._parent=i,this._root=s,this._debug={},this._read()}return t.prototype._read=function(){if(this._debug.catalogEnd={start:this._io.pos,ioOffset:this._io.byteOffset},this.catalogEnd=this._io.readBytes(1),this._debug.catalogEnd.end=this._io.pos,_.byteArrayCompare(this.catalogEnd,new Uint8Array([0]))!=0){var e=new _.ValidationNotEqualError(new Uint8Array([0]),this.catalogEnd,this._io,"/types/volume_info/seq/0");throw this._debug.catalogEnd.validationError=e,e}if(this._debug.unused={start:this._io.pos,ioOffset:this._io.byteOffset},this.unused=this._io.readBytes(224),this._debug.unused.end=this._io.pos,this._debug.firstFreeSectorSector={start:this._io.pos,ioOffset:this._io.byteOffset},this.firstFreeSectorSector=this._io.readU1(),this._debug.firstFreeSectorSector.end=this._io.pos,this._debug.firstFreeSectorTrack={start:this._io.pos,ioOffset:this._io.byteOffset},this.firstFreeSectorTrack=this._io.readU1(),this._debug.firstFreeSectorTrack.end=this._io.pos,this._debug.diskType={start:this._io.pos,ioOffset:this._io.byteOffset,enumName:"TrDosImage.DiskType"},this.diskType=this._io.readU1(),this._debug.diskType.end=this._io.pos,this._debug.numFiles={start:this._io.pos,ioOffset:this._io.byteOffset},this.numFiles=this._io.readU1(),this._debug.numFiles.end=this._io.pos,this._debug.numFreeSectors={start:this._io.pos,ioOffset:this._io.byteOffset},this.numFreeSectors=this._io.readU2le(),this._debug.numFreeSectors.end=this._io.pos,this._debug.trDosId={start:this._io.pos,ioOffset:this._io.byteOffset},this.trDosId=this._io.readBytes(1),this._debug.trDosId.end=this._io.pos,_.byteArrayCompare(this.trDosId,new Uint8Array([16]))!=0){var e=new _.ValidationNotEqualError(new Uint8Array([16]),this.trDosId,this._io,"/types/volume_info/seq/7");throw this._debug.trDosId.validationError=e,e}this._debug.unused2={start:this._io.pos,ioOffset:this._io.byteOffset},this.unused2=this._io.readBytes(2),this._debug.unused2.end=this._io.pos,this._debug.password={start:this._io.pos,ioOffset:this._io.byteOffset},this.password=this._io.readBytes(9),this._debug.password.end=this._io.pos,this._debug.unused3={start:this._io.pos,ioOffset:this._io.byteOffset},this.unused3=this._io.readBytes(1),this._debug.unused3.end=this._io.pos,this._debug.numDeletedFiles={start:this._io.pos,ioOffset:this._io.byteOffset},this.numDeletedFiles=this._io.readU1(),this._debug.numDeletedFiles.end=this._io.pos,this._debug.label={start:this._io.pos,ioOffset:this._io.byteOffset},this.label=this._io.readBytes(8),this._debug.label.end=this._io.pos,this._debug.unused4={start:this._io.pos,ioOffset:this._io.byteOffset},this.unused4=this._io.readBytes(3),this._debug.unused4.end=this._io.pos},Object.defineProperty(t.prototype,"numSides",{get:function(){return this._m_numSides!==void 0?this._m_numSides:(this._debug._m_numSides={},this._m_numSides=(this.diskType&8)!=0?1:2,this._m_numSides)}}),Object.defineProperty(t.prototype,"numTracks",{get:function(){return this._m_numTracks!==void 0?this._m_numTracks:(this._debug._m_numTracks={},this._m_numTracks=(this.diskType&1)!=0?40:80,this._m_numTracks)}}),t})();return Object.defineProperty(o.prototype,"volumeInfo",{get:function(){if(this._m_volumeInfo!==void 0)return this._m_volumeInfo;var t=this._io.pos;return this._io.seek(2048),this._debug._m_volumeInfo={start:this._io.pos,ioOffset:this._io.byteOffset},this._m_volumeInfo=new l(this._io,this,this._root),this._debug._m_volumeInfo.end=this._io.pos,this._io.seek(t),this._m_volumeInfo}}),o})();n.TrDosImage=h})}});const k=y(),S={id:"tr_dos_image",title:"TR-DOS flat-file disk image",ksy:{meta:{id:"tr_dos_image",title:"TR-DOS flat-file disk image","file-extension":"trd",xref:{justsolve:"TRD"},license:"CC0-1.0",endian:"le"},doc:`.trd file is a raw dump of TR-DOS (ZX-Spectrum) floppy. .trd files are
headerless and contain consequent "logical tracks", each logical track
consists of 16 256-byte sectors.

Logical tracks are defined the same way as used by TR-DOS: for single-side
floppies it's just a physical track number, for two-side floppies sides are
interleaved, i.e. logical_track_num = (physical_track_num << 1) | side

So, this format definition is more for TR-DOS filesystem than for .trd files,
which are formatless.

Strings (file names, disk label, disk password) are padded with spaces and use
ZX Spectrum character set, including UDGs, block drawing chars and Basic
tokens. ASCII range is mostly standard ASCII, with few characters (^, \`, DEL)
replaced with (up arrow, pound, copyright symbol).

.trd file can be smaller than actual floppy disk, if last logical tracks are
empty (contain no file data) they can be omitted.
`,seq:[{id:"files",type:"file",repeat:"until","repeat-until":"_.is_terminator"}],instances:{volume_info:{pos:2048,type:"volume_info"}},types:{file:{seq:[{id:"name",type:"filename",size:8},{id:"extension",type:"u1"},{id:"position_and_length",type:{"switch-on":"extension",cases:{35:"position_and_length_print",66:"position_and_length_basic",67:"position_and_length_code",_:"position_and_length_generic"}}},{id:"length_sectors",type:"u1"},{id:"starting_sector",type:"u1"},{id:"starting_track",type:"u1"}],instances:{is_deleted:{value:"name.first_byte == 0x01"},is_terminator:{value:"name.first_byte == 0x00"},contents:{pos:"starting_track * 256 * 16 + starting_sector * 256",size:"length_sectors * 256"}}},position_and_length_basic:{seq:[{id:"program_and_data_length",type:"u2"},{id:"program_length",type:"u2"}]},position_and_length_code:{seq:[{id:"start_address",type:"u2",doc:"Default memory address to load this byte array into"},{id:"length",type:"u2"}]},position_and_length_print:{seq:[{id:"extent_no",type:"u1"},{id:"reserved",type:"u1"},{id:"length",type:"u2"}]},position_and_length_generic:{seq:[{id:"reserved",type:"u2"},{id:"length",type:"u2"}]},volume_info:{seq:[{id:"catalog_end",contents:[0]},{id:"unused",size:224},{id:"first_free_sector_sector",type:"u1"},{id:"first_free_sector_track",doc:`track number is logical, for double-sided disks it's
(physical_track << 1) | side, the same way that tracks are stored
sequentially in .trd file
`,type:"u1"},{id:"disk_type",type:"u1",enum:"disk_type"},{id:"num_files",doc:`Number of non-deleted files. Directory can have more than
number_of_files entries due to deleted files
`,type:"u1"},{id:"num_free_sectors",type:"u2"},{id:"tr_dos_id",contents:[16]},{id:"unused_2",size:2},{id:"password",size:9},{id:"unused_3",size:1},{id:"num_deleted_files",type:"u1"},{id:"label",size:8},{id:"unused_4",size:3}],instances:{num_tracks:{value:"disk_type.to_i & 0x01 != 0 ? 40 : 80"},num_sides:{value:"disk_type.to_i & 0x08 != 0 ? 1 : 2"}}},filename:{seq:[{id:"name",size:8}],instances:{first_byte:{pos:0,type:"u1"}}}},enums:{disk_type:{22:"type_80_tracks_double_side",23:"type_40_tracks_double_side",24:"type_80_tracks_single_side",25:"type_40_tracks_single_side"}}}};export{k as default,S as spec};
