import{k as O}from"./index-CMEpbKl5.js";var B=Object.getOwnPropertyNames,v=(f,h)=>function(){return h||(0,f[B(f)[0]])((h={exports:{}}).exports,h),h.exports},A=v({"<stdin>"(f){(function(h,r){typeof define=="function"&&define.amd?define(["exports","kaitai-struct/KaitaiStream"],r):typeof f=="object"&&f!==null&&typeof f.nodeType!="number"?r(f,O.KaitaiStream):r(h.DsStore||(h.DsStore={}),h.KaitaiStream)})(typeof self<"u"?self:f,function(h,r){var l=(function(){function u(s,_,e){this._io=s,this._parent=_,this._root=e||this,this._debug={},this._read()}u.prototype._read=function(){if(this._debug.alignmentHeader={start:this._io.pos,ioOffset:this._io.byteOffset},this.alignmentHeader=this._io.readBytes(4),this._debug.alignmentHeader.end=this._io.pos,r.byteArrayCompare(this.alignmentHeader,new Uint8Array([0,0,0,1]))!=0){var s=new r.ValidationNotEqualError(new Uint8Array([0,0,0,1]),this.alignmentHeader,this._io,"/seq/0");throw this._debug.alignmentHeader.validationError=s,s}this._debug.buddyAllocatorHeader={start:this._io.pos,ioOffset:this._io.byteOffset},this.buddyAllocatorHeader=new k(this._io,this,this._root),this._debug.buddyAllocatorHeader.end=this._io.pos};var y=u.Block=(function(){function s(e,i,t){this._io=e,this._parent=i,this._root=t,this._debug={},this._read()}s.prototype._read=function(){this._debug.mode={start:this._io.pos,ioOffset:this._io.byteOffset},this.mode=this._io.readU4be(),this._debug.mode.end=this._io.pos,this._debug.counter={start:this._io.pos,ioOffset:this._io.byteOffset},this.counter=this._io.readU4be(),this._debug.counter.end=this._io.pos,this._debug.data={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.data.arr=[],this.data=[];for(var e=0;e<this.counter;e++)this._debug.data.arr[e]={start:this._io.pos,ioOffset:this._io.byteOffset},this.data.push(new _(this._io,this,this._root,this.mode)),this._debug.data.arr[e].end=this._io.pos;this._debug.data.end=this._io.pos};var _=s.BlockData=(function(){function e(t,o,d,n){this._io=t,this._parent=o,this._root=d,this.mode=n,this._debug={},this._read()}e.prototype._read=function(){this.mode>0&&(this._debug.blockId={start:this._io.pos,ioOffset:this._io.byteOffset},this.blockId=this._io.readU4be(),this._debug.blockId.end=this._io.pos),this._debug.record={start:this._io.pos,ioOffset:this._io.byteOffset},this.record=new i(this._io,this,this._root),this._debug.record.end=this._io.pos};var i=e.Record=(function(){function t(a,c,b){this._io=a,this._parent=c,this._root=b,this._debug={},this._read()}t.prototype._read=function(){switch(this._debug.filename={start:this._io.pos,ioOffset:this._io.byteOffset},this.filename=new n(this._io,this,this._root),this._debug.filename.end=this._io.pos,this._debug.structureType={start:this._io.pos,ioOffset:this._io.byteOffset},this.structureType=new o(this._io,this,this._root),this._debug.structureType.end=this._io.pos,this._debug.dataType={start:this._io.pos,ioOffset:this._io.byteOffset},this.dataType=r.bytesToStr(this._io.readBytes(4),"UTF-8"),this._debug.dataType.end=this._io.pos,this._debug.value={start:this._io.pos,ioOffset:this._io.byteOffset},this.dataType){case"blob":this.value=new d(this._io,this,this._root);break;case"bool":this.value=this._io.readU1();break;case"comp":this.value=this._io.readU8be();break;case"dutc":this.value=this._io.readU8be();break;case"long":this.value=this._io.readU4be();break;case"shor":this.value=this._io.readU4be();break;case"type":this.value=new o(this._io,this,this._root);break;case"ustr":this.value=new n(this._io,this,this._root);break}this._debug.value.end=this._io.pos};var o=t.FourCharCode=(function(){function a(c,b,p){this._io=c,this._parent=b,this._root=p,this._debug={},this._read()}return a.prototype._read=function(){this._debug.value={start:this._io.pos,ioOffset:this._io.byteOffset},this.value=r.bytesToStr(this._io.readBytes(4),"UTF-8"),this._debug.value.end=this._io.pos},a})(),d=t.RecordBlob=(function(){function a(c,b,p){this._io=c,this._parent=b,this._root=p,this._debug={},this._read()}return a.prototype._read=function(){this._debug.length={start:this._io.pos,ioOffset:this._io.byteOffset},this.length=this._io.readU4be(),this._debug.length.end=this._io.pos,this._debug.value={start:this._io.pos,ioOffset:this._io.byteOffset},this.value=this._io.readBytes(this.length),this._debug.value.end=this._io.pos},a})(),n=t.Ustr=(function(){function a(c,b,p){this._io=c,this._parent=b,this._root=p,this._debug={},this._read()}return a.prototype._read=function(){this._debug.length={start:this._io.pos,ioOffset:this._io.byteOffset},this.length=this._io.readU4be(),this._debug.length.end=this._io.pos,this._debug.value={start:this._io.pos,ioOffset:this._io.byteOffset},this.value=r.bytesToStr(this._io.readBytes(2*this.length),"UTF-16BE"),this._debug.value.end=this._io.pos},a})();return t})();return Object.defineProperty(e.prototype,"block",{get:function(){if(this._m_block!==void 0)return this._m_block;if(this.mode>0){var t=this._root._io,o=t.pos;t.seek(this._root.buddyAllocatorBody.blockAddresses[this.blockId].offset),this._debug._m_block={start:t.pos,ioOffset:t.byteOffset},this._m_block=new s(t,this,this._root),this._debug._m_block.end=t.pos,t.seek(o)}return this._m_block}}),e})();return Object.defineProperty(s.prototype,"rightmostBlock",{get:function(){if(this._m_rightmostBlock!==void 0)return this._m_rightmostBlock;if(this.mode>0){var e=this._root._io,i=e.pos;e.seek(this._root.buddyAllocatorBody.blockAddresses[this.mode].offset),this._debug._m_rightmostBlock={start:e.pos,ioOffset:e.byteOffset},this._m_rightmostBlock=new s(e,this,this._root),this._debug._m_rightmostBlock.end=e.pos,e.seek(i)}return this._m_rightmostBlock}}),s})(),m=u.BuddyAllocatorBody=(function(){function s(t,o,d){this._io=t,this._parent=o,this._root=d,this._debug={},this._read()}s.prototype._read=function(){this._debug.numBlocks={start:this._io.pos,ioOffset:this._io.byteOffset},this.numBlocks=this._io.readU4be(),this._debug.numBlocks.end=this._io.pos,this._debug._unnamed1={start:this._io.pos,ioOffset:this._io.byteOffset},this._unnamed1=this._io.readBytes(4),this._debug._unnamed1.end=this._io.pos,this._debug.blockAddresses={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.blockAddresses.arr=[],this.blockAddresses=[];for(var t=0;t<this.numBlockAddresses;t++)this._debug.blockAddresses.arr[t]={start:this._io.pos,ioOffset:this._io.byteOffset},this.blockAddresses.push(new _(this._io,this,this._root)),this._debug.blockAddresses.arr[t].end=this._io.pos;this._debug.blockAddresses.end=this._io.pos,this._debug.numDirectories={start:this._io.pos,ioOffset:this._io.byteOffset},this.numDirectories=this._io.readU4be(),this._debug.numDirectories.end=this._io.pos,this._debug.directoryEntries={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.directoryEntries.arr=[],this.directoryEntries=[];for(var t=0;t<this.numDirectories;t++)this._debug.directoryEntries.arr[t]={start:this._io.pos,ioOffset:this._io.byteOffset},this.directoryEntries.push(new e(this._io,this,this._root)),this._debug.directoryEntries.arr[t].end=this._io.pos;this._debug.directoryEntries.end=this._io.pos,this._debug.freeLists={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.freeLists.arr=[],this.freeLists=[];for(var t=0;t<this.numFreeLists;t++)this._debug.freeLists.arr[t]={start:this._io.pos,ioOffset:this._io.byteOffset},this.freeLists.push(new i(this._io,this,this._root)),this._debug.freeLists.arr[t].end=this._io.pos;this._debug.freeLists.end=this._io.pos};var _=s.BlockDescriptor=(function(){function t(o,d,n){this._io=o,this._parent=d,this._root=n,this._debug={},this._read()}return t.prototype._read=function(){this._debug.addressRaw={start:this._io.pos,ioOffset:this._io.byteOffset},this.addressRaw=this._io.readU4be(),this._debug.addressRaw.end=this._io.pos},Object.defineProperty(t.prototype,"offset",{get:function(){return this._m_offset!==void 0?this._m_offset:(this._debug._m_offset={},this._m_offset=(this.addressRaw&~this._root.blockAddressMask)+4,this._m_offset)}}),Object.defineProperty(t.prototype,"size",{get:function(){return this._m_size!==void 0?this._m_size:(this._debug._m_size={},this._m_size=1<<(this.addressRaw&this._root.blockAddressMask),this._m_size)}}),t})(),e=s.DirectoryEntry=(function(){function t(o,d,n){this._io=o,this._parent=d,this._root=n,this._debug={},this._read()}return t.prototype._read=function(){this._debug.lenName={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenName=this._io.readU1(),this._debug.lenName.end=this._io.pos,this._debug.name={start:this._io.pos,ioOffset:this._io.byteOffset},this.name=r.bytesToStr(this._io.readBytes(this.lenName),"UTF-8"),this._debug.name.end=this._io.pos,this._debug.blockId={start:this._io.pos,ioOffset:this._io.byteOffset},this.blockId=this._io.readU4be(),this._debug.blockId.end=this._io.pos},t})(),i=s.FreeList=(function(){function t(o,d,n){this._io=o,this._parent=d,this._root=n,this._debug={},this._read()}return t.prototype._read=function(){this._debug.counter={start:this._io.pos,ioOffset:this._io.byteOffset},this.counter=this._io.readU4be(),this._debug.counter.end=this._io.pos,this._debug.offsets={start:this._io.pos,ioOffset:this._io.byteOffset},this._debug.offsets.arr=[],this.offsets=[];for(var o=0;o<this.counter;o++)this._debug.offsets.arr[o]={start:this._io.pos,ioOffset:this._io.byteOffset},this.offsets.push(this._io.readU4be()),this._debug.offsets.arr[o].end=this._io.pos;this._debug.offsets.end=this._io.pos},t})();return Object.defineProperty(s.prototype,"directories",{get:function(){if(this._m_directories!==void 0)return this._m_directories;var t=this._root._io;this._debug._m_directories={start:t.pos,ioOffset:t.byteOffset},this._debug._m_directories.arr=[],this._m_directories=[];for(var o=0;o<this.numDirectories;o++)this._debug._m_directories.arr[o]={start:t.pos,ioOffset:t.byteOffset},this._m_directories.push(new g(t,this,this._root,o)),this._debug._m_directories.arr[o].end=t.pos;return this._debug._m_directories.end=t.pos,this._m_directories}}),Object.defineProperty(s.prototype,"numBlockAddresses",{get:function(){return this._m_numBlockAddresses!==void 0?this._m_numBlockAddresses:(this._debug._m_numBlockAddresses={},this._m_numBlockAddresses=256,this._m_numBlockAddresses)}}),Object.defineProperty(s.prototype,"numFreeLists",{get:function(){return this._m_numFreeLists!==void 0?this._m_numFreeLists:(this._debug._m_numFreeLists={},this._m_numFreeLists=32,this._m_numFreeLists)}}),s})(),k=u.BuddyAllocatorHeader=(function(){function s(_,e,i){this._io=_,this._parent=e,this._root=i,this._debug={},this._read()}return s.prototype._read=function(){if(this._debug.magic={start:this._io.pos,ioOffset:this._io.byteOffset},this.magic=this._io.readBytes(4),this._debug.magic.end=this._io.pos,r.byteArrayCompare(this.magic,new Uint8Array([66,117,100,49]))!=0){var _=new r.ValidationNotEqualError(new Uint8Array([66,117,100,49]),this.magic,this._io,"/types/buddy_allocator_header/seq/0");throw this._debug.magic.validationError=_,_}this._debug.ofsBookkeepingInfoBlock={start:this._io.pos,ioOffset:this._io.byteOffset},this.ofsBookkeepingInfoBlock=this._io.readU4be(),this._debug.ofsBookkeepingInfoBlock.end=this._io.pos,this._debug.lenBookkeepingInfoBlock={start:this._io.pos,ioOffset:this._io.byteOffset},this.lenBookkeepingInfoBlock=this._io.readU4be(),this._debug.lenBookkeepingInfoBlock.end=this._io.pos,this._debug.copyOfsBookkeepingInfoBlock={start:this._io.pos,ioOffset:this._io.byteOffset},this.copyOfsBookkeepingInfoBlock=this._io.readU4be(),this._debug.copyOfsBookkeepingInfoBlock.end=this._io.pos,this._debug._unnamed4={start:this._io.pos,ioOffset:this._io.byteOffset},this._unnamed4=this._io.readBytes(16),this._debug._unnamed4.end=this._io.pos},s})(),g=u.MasterBlockRef=(function(){function s(e,i,t,o){this._io=e,this._parent=i,this._root=t,this.idx=o,this._debug={},this._read()}s.prototype._read=function(){};var _=s.MasterBlock=(function(){function e(i,t,o){this._io=i,this._parent=t,this._root=o,this._debug={},this._read()}return e.prototype._read=function(){this._debug.blockId={start:this._io.pos,ioOffset:this._io.byteOffset},this.blockId=this._io.readU4be(),this._debug.blockId.end=this._io.pos,this._debug.numInternalNodes={start:this._io.pos,ioOffset:this._io.byteOffset},this.numInternalNodes=this._io.readU4be(),this._debug.numInternalNodes.end=this._io.pos,this._debug.numRecords={start:this._io.pos,ioOffset:this._io.byteOffset},this.numRecords=this._io.readU4be(),this._debug.numRecords.end=this._io.pos,this._debug.numNodes={start:this._io.pos,ioOffset:this._io.byteOffset},this.numNodes=this._io.readU4be(),this._debug.numNodes.end=this._io.pos,this._debug._unnamed4={start:this._io.pos,ioOffset:this._io.byteOffset},this._unnamed4=this._io.readU4be(),this._debug._unnamed4.end=this._io.pos},Object.defineProperty(e.prototype,"rootBlock",{get:function(){if(this._m_rootBlock!==void 0)return this._m_rootBlock;var i=this._root._io,t=i.pos;return i.seek(this._root.buddyAllocatorBody.blockAddresses[this.blockId].offset),this._debug._m_rootBlock={start:i.pos,ioOffset:i.byteOffset},this._m_rootBlock=new y(i,this,this._root),this._debug._m_rootBlock.end=i.pos,i.seek(t),this._m_rootBlock}}),e})();return Object.defineProperty(s.prototype,"masterBlock",{get:function(){if(this._m_masterBlock!==void 0)return this._m_masterBlock;var e=this._io.pos;this._io.seek(this._parent.blockAddresses[this._parent.directoryEntries[this.idx].blockId].offset),this._debug._m_masterBlock={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw__m_masterBlock=this._io.readBytes(this._parent.blockAddresses[this._parent.directoryEntries[this.idx].blockId].size);var i=new r(this._raw__m_masterBlock);return this._m_masterBlock=new _(i,this,this._root),this._debug._m_masterBlock.end=this._io.pos,this._io.seek(e),this._m_masterBlock}}),s})();return Object.defineProperty(u.prototype,"blockAddressMask",{get:function(){return this._m_blockAddressMask!==void 0?this._m_blockAddressMask:(this._debug._m_blockAddressMask={},this._m_blockAddressMask=31,this._m_blockAddressMask)}}),Object.defineProperty(u.prototype,"buddyAllocatorBody",{get:function(){if(this._m_buddyAllocatorBody!==void 0)return this._m_buddyAllocatorBody;var s=this._io.pos;this._io.seek(this.buddyAllocatorHeader.ofsBookkeepingInfoBlock+4),this._debug._m_buddyAllocatorBody={start:this._io.pos,ioOffset:this._io.byteOffset},this._raw__m_buddyAllocatorBody=this._io.readBytes(this.buddyAllocatorHeader.lenBookkeepingInfoBlock);var _=new r(this._raw__m_buddyAllocatorBody);return this._m_buddyAllocatorBody=new m(_,this,this._root),this._debug._m_buddyAllocatorBody.end=this._io.pos,this._io.seek(s),this._m_buddyAllocatorBody}}),u})();h.DsStore=l})}});const U=A(),D={id:"ds_store",title:"macOS '.DS_Store' format",ksy:{meta:{id:"ds_store",title:"macOS '.DS_Store' format","file-extension":"DS_Store",xref:{justsolve:"Desktop_Services_Store",pronom:"fmt/394",wikidata:"Q307271"},license:"MIT","ks-version":.9,encoding:"UTF-8",endian:"be"},doc:`Apple macOS '.DS_Store' file format.
`,"doc-ref":["https://en.wikipedia.org/wiki/.DS_Store","https://metacpan.org/dist/Mac-Finder-DSStore/view/DSStoreFormat.pod","https://0day.work/parsing-the-ds_store-file-format/"],seq:[{id:"alignment_header",contents:[0,0,0,1]},{id:"buddy_allocator_header",type:"buddy_allocator_header"}],instances:{buddy_allocator_body:{pos:"buddy_allocator_header.ofs_bookkeeping_info_block + 4",size:"buddy_allocator_header.len_bookkeeping_info_block",type:"buddy_allocator_body"},block_address_mask:{value:31,doc:`Bitmask used to calculate the position and the size of each block
of the B-tree from the block addresses.
`}},types:{buddy_allocator_header:{seq:[{id:"magic",contents:["Bud1"],doc:"Magic number 'Bud1'."},{id:"ofs_bookkeeping_info_block",type:"u4"},{id:"len_bookkeeping_info_block",type:"u4"},{id:"copy_ofs_bookkeeping_info_block",type:"u4",doc:"Needs to match 'offset_bookkeeping_info_block'."},{size:16,doc:`Unused field which might simply be the unused space at the end of the block,
since the minimum allocation size is 32 bytes.
`}]},buddy_allocator_body:{seq:[{id:"num_blocks",type:"u4",doc:"Number of blocks in the allocated-blocks list."},{size:4,doc:"Unknown field which appears to always be 0."},{id:"block_addresses",type:"block_descriptor",repeat:"expr","repeat-expr":"num_block_addresses",doc:"Addresses of the different blocks."},{id:"num_directories",type:"u4",doc:"Indicates the number of directory entries."},{id:"directory_entries",type:"directory_entry",repeat:"expr","repeat-expr":"num_directories",doc:"Each directory is an independent B-tree."},{id:"free_lists",type:"free_list",repeat:"expr","repeat-expr":"num_free_lists"}],types:{block_descriptor:{seq:[{id:"address_raw",type:"u4"}],instances:{offset:{value:"(address_raw & ~_root.block_address_mask) + 4"},size:{value:"1 << (address_raw & _root.block_address_mask)"}}},directory_entry:{seq:[{id:"len_name",type:"u1"},{id:"name",size:"len_name",type:"str"},{id:"block_id",type:"u4"}]},free_list:{seq:[{id:"counter",type:"u4"},{id:"offsets",type:"u4",repeat:"expr","repeat-expr":"counter"}]}},instances:{num_block_addresses:{value:256},num_free_lists:{value:32},directories:{io:"_root._io",type:"master_block_ref(_index)",repeat:"expr","repeat-expr":"num_directories",doc:"Master blocks of the different B-trees."}}},master_block_ref:{params:[{id:"idx",type:"u8"}],instances:{master_block:{pos:"_parent.block_addresses[_parent.directory_entries[idx].block_id].offset",size:"_parent.block_addresses[_parent.directory_entries[idx].block_id].size",type:"master_block"}},types:{master_block:{seq:[{id:"block_id",type:"u4",doc:"Block number of the B-tree's root node."},{id:"num_internal_nodes",type:"u4",doc:"Number of internal node levels."},{id:"num_records",type:"u4",doc:"Number of records in the tree."},{id:"num_nodes",type:"u4",doc:"Number of nodes in the tree."},{type:"u4",doc:"Always 0x1000, probably the B-tree node page size."}],instances:{root_block:{io:"_root._io",pos:"_root.buddy_allocator_body.block_addresses[block_id].offset",type:"block"}}}}},block:{seq:[{id:"mode",type:"u4",doc:"If mode is 0, this is a leaf node, otherwise it is an internal node."},{id:"counter",type:"u4",doc:"Number of records or number of block id + record pairs."},{id:"data",type:"block_data(mode)",repeat:"expr","repeat-expr":"counter"}],types:{block_data:{params:[{id:"mode",type:"u4"}],seq:[{id:"block_id",type:"u4",if:"mode > 0"},{id:"record",type:"record"}],instances:{block:{io:"_root._io",pos:"_root.buddy_allocator_body.block_addresses[block_id.as<u4>].offset",type:"block",if:"mode > 0"}},types:{record:{seq:[{id:"filename",type:"ustr"},{id:"structure_type",type:"four_char_code",doc:"Description of the entry's property."},{id:"data_type",size:4,type:"str",doc:"Data type of the value."},{id:"value",type:{"switch-on":"data_type",cases:{'"long"':"u4",'"shor"':"u4",'"bool"':"u1",'"blob"':"record_blob",'"type"':"four_char_code",'"ustr"':"ustr",'"comp"':"u8",'"dutc"':"u8"}}}],types:{record_blob:{seq:[{id:"length",type:"u4"},{id:"value",size:"length"}]},ustr:{seq:[{id:"length",type:"u4"},{id:"value",size:"2 * length",type:"str",encoding:"UTF-16BE"}]},four_char_code:{seq:[{id:"value",size:4,type:"str"}]}}}}}},instances:{rightmost_block:{io:"_root._io",pos:"_root.buddy_allocator_body.block_addresses[mode].offset",type:"block",if:"mode > 0",doc:"Rightmost child block pointer."}}}}}};export{U as default,D as spec};
